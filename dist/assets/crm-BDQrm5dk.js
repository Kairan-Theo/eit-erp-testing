import{r as X,a as p,j as e,R as Sa}from"./index-BHXMZ0-J.js";import{c as H,a as xt,f as me,s as Ta,X as $t,C as Bt,A as fe,N as Ia}from"./navigation-B0IDt7ps.js";import{L as Aa}from"./language-context-DF7eV6qf.js";import{n as Ma,i as zt,a as Ot,s as Ra,e as La,b as Pa,C as mt,c as Ea,p as Lt}from"./parseISO-BxmDVPrG.js";import{C as $a,a as Ba}from"./chevron-right-D7Tnoq0l.js";import{C as za}from"./check-CiAOFjR6.js";import{C as Oa}from"./clock-D2XSz8_e.js";import{B as _a,A as Ha}from"./briefcase-BO3pe571.js";import{T as ut}from"./trash-2-BkAS_2wL.js";import{T as Fa}from"./toaster-CI8ohmio.js";import{F as Ka}from"./file-text-6k7I-qzz.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=H("AlignCenter",[["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 18H5",key:"18s9l3"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=H("AlignLeft",[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=H("AlignRight",[["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 18H7",key:"1ygte8"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=H("Baseline",[["path",{d:"M4 20h16",key:"14thso"}],["path",{d:"m6 16 6-12 6 12",key:"1b4byz"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=H("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=H("IndentIncrease",[["path",{d:"M21 12H11",key:"wd7e0v"}],["path",{d:"M21 18H11",key:"4wu86t"}],["path",{d:"M21 6H11",key:"6dy1d6"}],["path",{d:"m3 8 4 4-4 4",key:"1a3j6y"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=H("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=H("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=H("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=H("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=H("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=H("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=H("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=H("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=H("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=H("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=H("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=H("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=H("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=H("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);function ls(u){return xt(u,Date.now())}function rs(u,D){const{start:M,end:K}=Ma(D==null?void 0:D.in,u);let G=+M>+K;const te=G?+M:+K,R=G?K:M;R.setHours(0,0,0,0);let _=1;const C=[];for(;+R<=te;)C.push(xt(M,R)),R.setDate(R.getDate()+_),R.setHours(0,0,0,0);return G?C.reverse():C}function is(u,D){return zt(xt(u,u),ls(u))}function cs(u,D,M){return Ot(u,-1,M)}function ds({deals:u=[],onDeleteDeals:D}){const[M,K]=X.useState(""),[G,te]=X.useState({}),[R,_]=X.useState([]),C=u.filter(g=>{const x=M.toLowerCase(),L=(g.customer||g.company||"").toLowerCase(),z=(g.salesperson||g.salespersonName||"").toLowerCase();return L.includes(x)||z.includes(x)});p.useEffect(()=>{const g=new Set(u.map(x=>x.id));_(x=>x.filter(L=>g.has(L)))},[u]);const S=g=>{g.target.checked?_(C.map(x=>x.id)):_([])},Ce=g=>{_(x=>x.includes(g)?x.filter(L=>L!==g):[...x,g])},$=()=>{D&&R.length>0&&D(R)},J=[{id:"index",label:"Index",width:"w-16"},{id:"company",label:"Company Name"},{id:"email",label:"Email"},{id:"phone",label:"Phone"},{id:"address",label:"Address",defaultClass:"max-w-xs truncate"},{id:"contact",label:"Contact Person"},{id:"taxId",label:"Tax ID",defaultClass:"font-mono text-sm"},{id:"poNumber",label:"PO Number"},{id:"title",label:"Opportunity Name",defaultClass:"font-medium"},{id:"salesperson",label:"Sales Person"},{id:"amount",label:"Amount",defaultClass:"font-mono"},{id:"stagesTotal",label:"Stages Total"}],ce=(g,x)=>{te(L=>({...L,[g]:L[g]===x?void 0:x}))},w=(g,x,L)=>{if(G[g.id]==="folded")return e.jsx("span",{className:"text-gray-300",children:"•"});switch(g.id){case"index":return e.jsx("span",{className:"font-medium text-gray-800",children:L+1});case"company":return e.jsx("span",{className:"font-medium text-gray-800",children:x.customer||x.company||"-"});case"salesperson":const z=x.salesperson||x.salespersonName;return z?e.jsxs("div",{className:"flex items-center gap-1.5",title:z,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-400 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),z]}):"-";case"amount":return x.amount?`${x.amount.toLocaleString()} ${x.currency||"฿"}`:"-";case"address":return x.address||"-";case"email":return x.email||"-";case"phone":return x.phone||"-";case"contact":return x.contact||"-";case"taxId":return x.taxId||"-";case"poNumber":return x.poNumber||"-";case"title":return x.title||"-";case"stagesTotal":return x.stageName?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-slate-700",children:x.stageName}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Total: ",x.stageCount]})]}):"-";default:return"-"}};return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Customers (Pipeline Data)"}),e.jsxs("div",{className:"flex items-center gap-6",children:[R.length>0&&e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("span",{className:"font-medium",children:["Delete (",R.length,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by Company or Salesperson...",className:"pl-10 pr-10 py-2 border border-slate-300 rounded-lg text-sm w-80 focus:outline-none focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] transition-all",value:M,onChange:g=>K(g.target.value)}),e.jsx("svg",{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),M&&e.jsx("button",{onClick:()=>K(""),className:"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600 transition-colors",title:"Clear Search",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"text-slate-500 font-medium text-sm",children:M?e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"text-slate-900 font-bold",children:C.length})," of ",e.jsx("span",{className:"text-slate-900 font-bold",children:u.length})," customers"]}):e.jsxs("span",{children:["Total: ",e.jsx("span",{className:"text-slate-900 font-bold",children:u.length})," customers"]})})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 border-b w-10",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:S,checked:C.length>0&&R.length===C.length,ref:g=>{g&&(g.indeterminate=R.length>0&&R.length<C.length)}})}),J.map(g=>{const x=G[g.id];return e.jsx("th",{className:`p-4 border-b transition-all duration-300 group relative align-top ${x==="folded"?"w-12 max-w-[3rem]":x==="expanded"?"min-w-[300px]":"whitespace-nowrap"}`,children:e.jsxs("div",{className:`flex items-center justify-between gap-2 ${x==="folded"?"justify-center":""}`,children:[x!=="folded"&&e.jsx("span",{children:g.label}),e.jsxs("div",{className:`flex items-center gap-1 bg-white rounded-md shadow-md border border-gray-300 opacity-0 group-hover:opacity-100 transition-opacity z-10 ${x==="folded"?"opacity-100 absolute left-1/2 -translate-x-1/2 top-2":""}`,children:[x!=="folded"&&e.jsx("button",{onClick:()=>ce(g.id,"folded"),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Fold Column",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})]})}),x!=="expanded"?e.jsx("button",{onClick:()=>ce(g.id,"expanded"),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Fully Expand",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 01-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12a1 1 0 01-1-1z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M16 16a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L13.586 13.586V12a1 1 0 012 0v4zM4 12a1 1 0 011 1v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 13.586H8a1 1 0 010 2H4a1 1 0 01-1-1v-4a1 1 0 011-1z",clipRule:"evenodd"})]})}):e.jsx("button",{onClick:()=>ce(g.id,void 0),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Reset to Default",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})},g.id)})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[C.map((g,x)=>e.jsxs("tr",{className:`transition border-b border-gray-100 ${R.includes(g.id)?"bg-blue-200 hover:bg-blue-300":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:()=>Ce(g.id),checked:R.includes(g.id)})}),J.map(L=>{const z=G[L.id];return e.jsx("td",{className:`p-4 transition-all duration-300 align-top ${z==="folded"?"w-12 max-w-[3rem] text-center overflow-hidden p-2":z==="expanded"?"min-w-[300px] whitespace-normal break-words text-gray-600":`whitespace-nowrap text-gray-600 ${L.defaultClass||""}`}`,children:w(L,g,x)},L.id)})]},g.id||x)),C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:J.length+1,className:"p-8 text-center text-gray-400",children:M?"No matching customers found.":"No data found in Sales Pipeline."})})]})]})})]})}function ms({deals:u=[],onDeleteActivity:D,onActivityUpdate:M}){const[K,G]=X.useState(new Date),[te,R]=X.useState({}),[_,C]=X.useState(!1),[S,Ce]=X.useState(null),[$,J]=X.useState({activityName:"",startAt:"",dueAt:"",dealId:""});X.useEffect(()=>{_&&J(S?{activityName:S.activityName||"",startAt:S.startAt||(S.date?me(S.date,"yyyy-MM-dd'T'HH:mm"):""),dueAt:S.date?me(S.date,"yyyy-MM-dd'T'HH:mm"):"",dealId:S.dealId||""}:{activityName:"",startAt:me(new Date,"yyyy-MM-dd'T'HH:mm"),dueAt:me(new Date,"yyyy-MM-dd'T'HH:mm"),dealId:""})},[_,S]);const ce=b=>{Ce(b),C(!0)},w=async b=>{b.preventDefault(),S&&R(P=>({...P,[S.id]:!0}));try{const P=localStorage.getItem("authToken"),q={"Content-Type":"application/json",...P?{Authorization:`Token ${P}`}:{}},W=S?`${fe}/api/activity_schedules/${S.id}/`:`${fe}/api/activity_schedules/`,ne=S?"PATCH":"POST",oe={activity_name:$.activityName,start_at:$.startAt||null,due_at:$.dueAt,deal:$.dealId,...S?{completed:!0}:{}},A=await fetch(W,{method:ne,headers:q,body:JSON.stringify(oe)});if(A.status===401){localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),window.location.href="/";return}A.ok?(C(!1),M&&M()):console.error("Failed to save activity")}catch(P){console.error("Error saving activity",P)}},g=u.flatMap(b=>(b.activitySchedules||[]).map(P=>({...P,dealId:b.id,startAt:P.startAt||"",date:P.dueAt?new Date(P.dueAt):null,completed:te[P.id]!==void 0?te[P.id]:P.completed}))).filter(b=>b.date&&!isNaN(b.date.getTime())),x=b=>b instanceof Date&&!isNaN(b.getTime()),L=()=>G(Ot(K,1)),z=()=>G(cs(K)),Z=Ra(K),He=La(Z),ue=Ta(Z),f=Pa(He),F=rs({start:ue,end:f}),m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],B=b=>{var W;const P=["bg-orange-50 text-orange-700 border-l-4 border-orange-300","bg-blue-50 text-blue-700 border-l-4 border-blue-300","bg-green-50 text-green-700 border-l-4 border-green-300","bg-purple-50 text-purple-700 border-l-4 border-purple-300","bg-pink-50 text-pink-700 border-l-4 border-pink-300","bg-yellow-50 text-yellow-700 border-l-4 border-yellow-300"],q=(b.id||0)+(((W=b.activityName)==null?void 0:W.length)||0);return P[q%P.length]},h=async(b,P)=>{P.stopPropagation();const q=!b.completed;R(W=>({...W,[b.id]:q}));try{const W=localStorage.getItem("authToken"),ne={"Content-Type":"application/json",...W?{Authorization:`Token ${W}`}:{}},oe=await fetch(`${fe}/api/activity_schedules/${b.id}/`,{method:"PATCH",headers:ne,body:JSON.stringify({completed:q})});if(oe.status===401){localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),window.location.href="/";return}oe.ok?M&&M():(console.error("Failed to toggle activity status"),R(A=>{const he={...A};return delete he[b.id],he}))}catch(W){console.error("Error toggling activity status",W),R(ne=>{const oe={...ne};return delete oe[b.id],oe})}};return e.jsxs("div",{className:"flex flex-col h-full bg-white font-sans",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between px-6 py-6 border-b border-gray-100 gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-gray-50 rounded-lg",children:e.jsx(mt,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:z,className:"p-1.5 hover:bg-gray-100 rounded-full text-gray-400 hover:text-gray-700 transition-colors",children:e.jsx($a,{className:"w-6 h-6"})}),e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 select-none",children:[me(K,"MMMM")," ",e.jsx("span",{className:"text-gray-400 font-normal text-xl ml-2",children:me(K,"yyyy")})]}),e.jsx("button",{onClick:L,className:"p-1.5 hover:bg-gray-100 rounded-full text-gray-400 hover:text-gray-700 transition-colors",children:e.jsx(Ba,{className:"w-6 h-6"})})]})]})}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-100",children:m.map(b=>e.jsx("div",{className:"py-4 text-center text-sm font-semibold text-gray-400 uppercase tracking-wider",children:b},b))}),e.jsx("div",{className:"flex-1 grid grid-cols-7 auto-rows-fr bg-gray-50/30",children:F.map((b,P)=>{const q=g.filter(A=>zt(A.date,b));q.sort((A,he)=>{var xe,de;return(((xe=A.date)==null?void 0:xe.getTime())||0)-(((de=he.date)==null?void 0:de.getTime())||0)});const W=Ea(b,Z),ne=is(b),oe=q.filter(A=>!A.completed).length;return e.jsxs("div",{className:`
                        border-b border-r border-gray-100 p-2 min-h-[120px] flex flex-col gap-1 relative group transition-colors hover:bg-white
                        ${W?"bg-white":"bg-gray-50/50 text-gray-400"}
                        ${P%7===6?"border-r-0":""}
                    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:`
                                text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full transition-all
                                ${ne?"bg-[#2D4485] text-white shadow-md transform scale-110":W?"text-gray-700 group-hover:bg-gray-100":"text-gray-300"}
                            `,children:me(b,"d")}),oe>0&&e.jsx("span",{className:"text-[10px] font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded-full",children:oe})]}),e.jsx("div",{className:"flex flex-col gap-1.5 overflow-y-auto max-h-[150px] custom-scrollbar",children:q.map((A,he)=>e.jsxs("div",{className:`
                                    group/item text-xs px-2 py-1.5 rounded-md flex flex-col gap-0.5 transition-all hover:shadow-md cursor-pointer border border-transparent hover:border-gray-100
                                    ${B(A)}
                                    ${A.completed?"opacity-50":""}
                                `,title:`${A.activityName} - ${me(A.date,"p")} - ${A.customer}`,onClick:xe=>ce(A),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:`w-4 h-4 rounded-[4px] border border-current flex items-center justify-center shrink-0 ${A.completed?"bg-current":"bg-white/50"} cursor-pointer hover:scale-110 transition-transform focus:outline-none focus:ring-1 focus:ring-current`,onClick:xe=>h(A,xe),children:e.jsx(za,{className:`w-3 h-3 pointer-events-none ${A.completed?"text-white":"text-current"} ${A.completed?"":"opacity-0 group-hover/item:opacity-100"}`,strokeWidth:3})}),e.jsx("span",{className:`truncate font-medium flex-1 ${A.completed?"line-through opacity-70":""}`,children:A.activityName||"Untitled"})]}),e.jsx("div",{className:"flex items-center gap-2 pl-6 opacity-75"})]},he))})]},b.toString())})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"relative w-full max-w-lg",children:[e.jsx("div",{className:"absolute -top-20 -left-20 w-60 h-60 bg-blue-500/20 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-20 -right-20 w-60 h-60 bg-purple-500/20 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"relative p-[1px] rounded-[2.5rem] bg-gradient-to-br from-white/80 via-white/40 to-white/60 shadow-2xl backdrop-blur-3xl overflow-hidden",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-3xl rounded-[2.5rem] overflow-hidden relative h-full flex flex-col",children:[e.jsx("div",{className:"px-8 py-8 bg-gradient-to-b from-gray-50/50 to-transparent",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-[#2D4485] to-[#3D56A6] flex items-center justify-center shadow-lg shadow-blue-900/20 text-white",children:S?e.jsx(Qa,{className:"w-6 h-6"}):e.jsx(ss,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:S?"Edit Activity":"New Activity"}),e.jsx("p",{className:"text-sm font-medium text-gray-500 mt-1",children:S?"Update the details below":"Schedule something amazing"})]})]}),e.jsx("button",{onClick:()=>C(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx($t,{className:"w-6 h-6"})})]})}),e.jsxs("form",{onSubmit:w,className:"px-8 pb-8 space-y-6 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider ml-1",children:"Activity Name"}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-[#2D4485] transition-colors",children:e.jsx(_t,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",required:!0,className:"w-full pl-12 pr-4 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-[#2D4485]/20 focus:ring-4 focus:ring-[#2D4485]/10 transition-all font-semibold text-gray-900 placeholder-gray-400",placeholder:"e.g. Call with John Doe",value:$.activityName,onChange:b=>J({...$,activityName:b.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-blue-600 uppercase tracking-wider ml-1 flex items-center gap-1",children:[e.jsx(mt,{className:"w-3 h-3"})," Assign Date"]}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"datetime-local",required:!0,className:"w-full px-4 py-3.5 rounded-2xl bg-blue-50/50 border-2 border-blue-100 focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all text-sm font-bold text-blue-900",value:$.startAt,onChange:b=>J({...$,startAt:b.target.value})})}),$.startAt&&(()=>{const b=Lt($.startAt);return x(b)?e.jsxs("p",{className:"text-[10px] text-blue-600 font-medium mt-1 ml-1 flex items-center gap-1.5 animate-in slide-in-from-top-1 fade-in duration-200",children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-blue-500"}),me(b,"EEE, MMM d, h:mm a")]}):null})()]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-bold text-red-600 uppercase tracking-wider ml-1 flex items-center gap-1",children:[e.jsx(Oa,{className:"w-3 h-3"})," Due Date"]}),e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"datetime-local",required:!0,className:"w-full px-4 py-3.5 rounded-2xl bg-red-50/50 border-2 border-red-100 focus:bg-white focus:border-red-500 focus:ring-4 focus:ring-red-500/10 transition-all text-sm font-bold text-red-900",value:$.dueAt,onChange:b=>J({...$,dueAt:b.target.value})})}),$.dueAt&&(()=>{const b=Lt($.dueAt);return x(b)?e.jsxs("p",{className:"text-[10px] text-red-600 font-medium mt-1 ml-1 flex items-center gap-1.5 animate-in slide-in-from-top-1 fade-in duration-200",children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-red-500"}),me(b,"EEE, MMM d, h:mm a")]}):null})()]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider ml-1",children:"Related Deal"}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-[#2D4485] transition-colors",children:e.jsx(_a,{className:"w-5 h-5"})}),e.jsxs("select",{required:!0,className:"w-full pl-12 pr-10 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-[#2D4485]/20 focus:ring-4 focus:ring-[#2D4485]/10 transition-all font-semibold text-gray-900 appearance-none cursor-pointer",value:$.dealId,onChange:b=>J({...$,dealId:b.target.value}),disabled:!!S,children:[e.jsx("option",{value:"",children:"Select a deal..."}),u.map(b=>e.jsx("option",{value:b.id,children:b.title},b.id))]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400",children:e.jsx(Bt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"pt-4 flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"px-6 py-3 rounded-xl text-sm font-bold text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-8 py-3 rounded-xl bg-[#2D4485] text-white text-sm font-bold shadow-lg shadow-blue-900/20 hover:shadow-blue-900/40 hover:scale-[1.02] active:scale-95 transition-all",children:S?"Done":"Create Activity"})]})]})]})})]})})]})}const us=()=>{const[u,D]=X.useState("emails"),[M,K]=X.useState([]),[G,te]=X.useState([]),[R,_]=X.useState(!0),[C,S]=X.useState("");X.useEffect(()=>{Ce()},[u]);const Ce=async()=>{_(!0);try{const w=u==="emails"?`${fe}/api/email_logs/`:`${fe}/api/deal_history/`,g=await fetch(w);if(g.ok){const x=await g.json();u==="emails"?K(x):te(x)}}catch(w){console.error("Error fetching history:",w)}finally{_(!1)}},$=async(w,g)=>{try{const x=g==="email"?`${fe}/api/email_logs/${w}/`:`${fe}/api/deal_history/${w}/`;(await fetch(x,{method:"DELETE"})).ok?g==="email"?K(z=>z.filter(Z=>Z.id!==w)):te(z=>z.filter(Z=>Z.id!==w)):console.error("Failed to delete item")}catch(x){console.error("Error deleting item:",x)}},J=M.filter(w=>w.recipient&&w.recipient.toLowerCase().includes(C.toLowerCase())||w.subject&&w.subject.toLowerCase().includes(C.toLowerCase())),ce=G.filter(w=>w.deal_title&&w.deal_title.toLowerCase().includes(C.toLowerCase())||w.from_stage&&w.from_stage.toLowerCase().includes(C.toLowerCase())||w.to_stage&&w.to_stage.toLowerCase().includes(C.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2 bg-slate-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>D("emails"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${u==="emails"?"bg-white text-blue-600 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"w-4 h-4"}),"Sent Emails"]})}),e.jsx("button",{onClick:()=>D("movements"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${u==="movements"?"bg-white text-blue-600 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ha,{className:"w-4 h-4"}),"Pipeline Movements"]})})]}),u==="emails"&&e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:C,onChange:w=>S(w.target.value),className:"pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-64"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:R?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Loading..."}):u==="emails"?e.jsxs("div",{className:"flex flex-col gap-4 p-4 bg-slate-50/50",children:[J.map(w=>e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col gap-3 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-start border-b border-slate-100 pb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:w.subject}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"To:"})," ",w.recipient]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-400 font-medium whitespace-nowrap bg-slate-50 px-2 py-1 rounded-full border border-slate-100",children:[e.jsx(mt,{className:"w-3.5 h-3.5"}),new Date(w.sent_at).toLocaleString()]}),e.jsx("button",{onClick:()=>$(w.id,"email"),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Email Log",children:e.jsx(ut,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"bg-slate-50 p-4 rounded-lg text-sm text-slate-600 leading-relaxed whitespace-pre-wrap border border-slate-100 font-mono",children:w.body.replace(/<[^>]*>?/gm,"").replace(/&nbsp;/g," ")}),w.attachments&&w.attachments.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:w.attachments.map(g=>e.jsxs("a",{href:g.file,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-white hover:bg-slate-50 text-slate-700 rounded-lg text-xs font-medium transition-colors border border-slate-200 shadow-sm hover:shadow group",children:[e.jsx(ht,{className:"w-3.5 h-3.5 text-slate-400 group-hover:text-blue-500 transition-colors"}),e.jsx("span",{className:"truncate max-w-[200px]",children:g.filename.split("/").pop()})]},g.id))})]},w.id)),J.length===0&&e.jsxs("div",{className:"p-12 text-center text-slate-500 bg-white rounded-xl border-2 border-slate-100 border-dashed",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(Et,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{children:"No email logs found"})]})]}):e.jsxs("div",{className:"flex flex-col gap-3 p-4 bg-slate-50/50",children:[ce.map(w=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-start gap-4 transition-all hover:shadow-md group",children:[e.jsx("div",{className:"mt-1.5 w-2.5 h-2.5 rounded-full bg-blue-600 flex-shrink-0 shadow-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-slate-800 font-medium text-sm leading-relaxed",children:["CRM: Moved ",e.jsxs("span",{className:"font-bold text-slate-900",children:['"',w.deal_title||`Deal #${w.deal}`,'"']})," from ",e.jsx("span",{className:"text-slate-600",children:w.from_stage})," ",e.jsx("span",{className:"text-slate-400 px-1",children:"-->"})," ",e.jsx("span",{className:"text-blue-600 font-semibold",children:w.to_stage})]}),e.jsx("p",{className:"text-slate-400 text-xs mt-1.5 font-medium",children:new Date(w.changed_at).toLocaleString()})]}),e.jsx("button",{onClick:()=>$(w.id,"history"),className:"p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"Delete History Log",children:e.jsx(ut,{className:"w-4 h-4"})})]},w.id)),ce.length===0&&e.jsxs("div",{className:"p-12 text-center text-slate-500 bg-white rounded-xl border-2 border-slate-100 border-dashed",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(ts,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{children:"No history found"})]})]})})]})},dt={"Appointment Schedule":[{id:1,title:"Discussing Goods Price",customer:"Big C Supercenter PLC",amount:0,currency:"฿",priority:"none",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],activitySchedules:[{id:101,dueAt:new Date().toISOString(),activityName:"Initial Meeting",salesperson:"Sales Team",customer:"Big C Supercenter PLC"},{id:102,dueAt:new Date(Date.now()+2*24*60*60*1e3).toISOString(),activityName:"Follow up Email",salesperson:"Sales Team",customer:"Big C Supercenter PLC"}]}],"Presentation Schedule":[{id:2,title:"Selling New Machines",customer:"SIANGHAI EITING TRADING COMPANY",amount:5e4,currency:"฿",priority:"high",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+45*24*60*60*1e3).toISOString().split("T")[0],activitySchedules:[{id:201,dueAt:new Date(Date.now()+5*24*60*60*1e3).toISOString(),activityName:"Product Demo",salesperson:"Sales Team",customer:"SIANGHAI EITING"}]}],Quotation:[{id:3,title:"Introduced New Plan about Manufacturing",customer:"METRO MACHINERY",amount:100,currency:"฿",priority:"medium",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+20*24*60*60*1e3).toISOString().split("T")[0]}],Demo:[],Decision:[],Connection:[],"Contract Sent":[],"Close Won":[{id:4,title:"Negotiated and made contract",customer:"Konvy",amount:8e4,currency:"฿",priority:"low",contact:"",email:"",phone:"",notes:"",createdAt:new Date().toISOString(),expectedClose:new Date(Date.now()+10*24*60*60*1e3).toISOString().split("T")[0]}]},Me=[{name:"EIT LASERTECHNIK (Einstein Industrie Technik)",contact:"Sales Team",email:"sales@eitlaser.com",phone:"02-052-9544",address:"1/120 Ramkamhaeng Soi 184, Minburi, Minburi, Bangkok 10510",taxId:""},{name:"PTT Public Company Limited",contact:"Auttapol Rerkpiboon",email:"auttapol.r@pttplc.com",phone:"02-537-2000",address:"555 Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900",taxId:"0107544000108"},{name:"SCG (Siam Cement Group)",contact:"Roongrote Rangsiyopash",email:"roongrote.r@scg.com",phone:"02-586-3333",address:"1 Siam Cement Rd, Bang Sue, Bangkok 10800",taxId:"0107537000114"},{name:"CP All Public Company Limited",contact:"Korsak Chairasmisak",email:"korsak.c@cpall.co.th",phone:"02-071-9000",address:"313 C.P. Tower, Silom Rd, Bang Rak, Bangkok 10500",taxId:"0107542000011"},{name:"Advanced Info Service (AIS)",contact:"Somchai Lertsutiwong",email:"somchai.l@ais.co.th",phone:"02-029-5000",address:"414 Phaholyothin Rd, Phaya Thai, Bangkok 10400",taxId:"0107535000265"},{name:"Kasikornbank",contact:"Kattiya Indaravijaya",email:"kattiya.i@kasikornbank.com",phone:"02-888-8888",address:"400/22 Phahon Yothin Rd, Phaya Thai, Bangkok 10400",taxId:"0107536000315"},{name:"Siam Commercial Bank",contact:"Arthid Nanthawithaya",email:"arthid.n@scb.co.th",phone:"02-777-7777",address:"9 Ratchadapisek Rd, Chatuchak, Bangkok 10900",taxId:"0107536000102"},{name:"Bangkok Bank",contact:"Chartsiri Sophonpanich",email:"chartsiri.s@bangkokbank.com",phone:"1333",address:"333 Silom Rd, Bang Rak, Bangkok 10500",taxId:"0107536000374"},{name:"True Corporation",contact:"Manat Manavutiveth",email:"manat.m@truecorp.co.th",phone:"1242",address:"18 True Tower, Ratchadaphisek Rd, Huai Khwang, Bangkok 10310",taxId:"0107536000081"},{name:"Thai Beverage",contact:"Thapana Sirivadhanabhakdi",email:"thapana.s@thaibev.com",phone:"02-785-5555",address:"14 Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900",taxId:"0107546000342"},{name:"Central Retail Corporation",contact:"Yol Phokasub",email:"yol.p@central.co.th",phone:"02-650-3600",address:"22 Soi Somkid, Ploenchit Rd, Pathum Wan, Bangkok 10330",taxId:"0107562000386"},{name:"Charoen Pokphand Foods",contact:"Prasit Boondoungprasert",email:"prasit.b@cpf.co.th",phone:"02-766-8000",address:"313 C.P. Tower, Silom Rd, Bang Rak, Bangkok 10500",taxId:"0107537000246"},{name:"PTT Exploration and Production",contact:"Montri Rawanchaikul",email:"montri.r@pttep.com",phone:"02-537-4000",address:"555/1 Energy Complex, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900",taxId:"0107535000206"},{name:"Airports of Thailand",contact:"Nitinai Sirismatthakarn",email:"nitinai.s@aot.co.th",phone:"02-535-1111",address:"333 Cherdwutagard Rd, Don Mueang, Bangkok 10210",taxId:"0107545000292"},{name:"Energy Absolute",contact:"Somphote Ahunai",email:"somphote.a@energyabsolute.co.th",phone:"02-248-2455",address:"89 AIA Capital Center, Ratchadaphisek Rd, Din Daeng, Bangkok 10400",taxId:"0107551000061"},{name:"Gulf Energy Development",contact:"Sarath Ratanavadi",email:"sarath.r@gulf.co.th",phone:"02-080-4499",address:"87 M. Thai Tower, All Seasons Place, Wireless Rd, Pathum Wan, Bangkok 10330"},{name:"Intouch Holdings",contact:"Kim Siritaweechai",email:"kim.s@intouchcompany.com",phone:"02-118-6900",address:"87 M. Thai Tower, All Seasons Place, Wireless Rd, Pathum Wan, Bangkok 10330"},{name:"Minor International",contact:"William Heinecke",email:"william.h@minor.com",phone:"02-365-7500",address:"88 The Parq Building, Ratchadaphisek Rd, Khlong Toei, Bangkok 10110"},{name:"Indorama Ventures",contact:"Aloke Lohia",email:"aloke.l@indorama.net",phone:"02-661-6661",address:"75/102 Ocean Tower 2, Sukhumvit Soi 19, Watthana, Bangkok 10110"},{name:"Bangkok Dusit Medical Services",contact:"Poramaporn Prasarttong-Osoth",email:"poramaporn.p@bdms.co.th",phone:"02-310-3000",address:"2 Soi Soonvijai 7, New Phetchaburi Rd, Huai Khwang, Bangkok 10310"},{name:"Electricity Generating Public Company",contact:"Thepparat Theppitak",email:"thepparat.t@egco.com",phone:"02-998-5000",address:"222 Vibhavadi Rangsit Rd, Lak Si, Bangkok 10210"},{name:"Delta Electronics (Thailand)",contact:"Jackie Chang",email:"info@deltathailand.com",phone:"02-709-2800",address:"909 Soi 9, Bangpoo Ind. Estate, Samut Prakan 10280"},{name:"Global Power Synergy (GPSC)",contact:"Worawat Pitayasiri",email:"gpsc@gpscgroup.com",phone:"02-140-4600",address:"555/2 Energy Complex B, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Thai Oil",contact:"Wirat Uanarumit",email:"thayoil@thaioilgroup.com",phone:"02-797-2999",address:"555/1 Energy Complex A, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Ratch Group",contact:"Choosri Kietkajornkul",email:"ratch@ratch.co.th",phone:"02-794-9999",address:"72 Ngam Wong Wan Rd, Nonthaburi 11000"},{name:"Krung Thai Bank",contact:"Payong Srivanich",email:"call.center@krungthai.com",phone:"02-111-1111",address:"35 Sukhumvit Rd, Watthana, Bangkok 10110"},{name:"TMBThanachart Bank (TTB)",contact:"Piti Tantakasem",email:"ttb@ttbbank.com",phone:"1428",address:"3000 Phahon Yothin Rd, Chatuchak, Bangkok 10900"},{name:"PTT Global Chemical (GC)",contact:"Kongkrapan Intarajang",email:"gc@pttgcgroup.com",phone:"02-265-8400",address:"555/1 Energy Complex A, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Osotspa",contact:"Wannipa Bhakdibutr",email:"osotspa@osotspa.com",phone:"02-351-1000",address:"348 Ramkhamhaeng Rd, Bang Kapi, Bangkok 10240"},{name:"Carabao Group",contact:"Sathien Setthasit",email:"carabao@carabaogroup.com",phone:"02-636-6111",address:"393 Silom Rd, Bang Rak, Bangkok 10500"},{name:"B.Grimm Power",contact:"Harald Link",email:"bgrimm@bgrimmpower.com",phone:"02-710-3000",address:"5 Krungthepkreetha Rd, Bang Kapi, Bangkok 10240"},{name:"Banpu",contact:"Somruedee Chaimongkol",email:"banpu@banpu.co.th",phone:"02-694-6600",address:"1550 Thanapoom Tower, Phetchaburi Rd, Ratchathewi, Bangkok 10400"},{name:"Berli Jucker (BJC)",contact:"Aswin Techajareonvikul",email:"bjc@bjc.co.th",phone:"02-367-1111",address:"99 Soi Rubia, Sukhumvit 42, Khlong Toei, Bangkok 10110"},{name:"Home Product Center (HomePro)",contact:"Khunawut Thumpomkul",email:"contact@homepro.co.th",phone:"1284",address:"96/27 Moo 9 Bang Khen, Mueang Nonthaburi, Nonthaburi 11000"},{name:"Land and Houses",contact:"Naporn Sunthornchitcharoen",email:"lh@lh.co.th",phone:"1198",address:"1 Q. House Lumpini, Sathon Tai Rd, Sathon, Bangkok 10120"},{name:"Supalai",contact:"Prateep Tangmatitham",email:"supalai@supalai.com",phone:"1720",address:"1011 Supalai Grand Tower, Rama 3 Rd, Yan Nawa, Bangkok 10120"},{name:"AP (Thailand)",contact:"Anuphong Assavabhokhin",email:"ap@apthai.com",phone:"1623",address:"170/57 Ocean Tower 1, Ratchadaphisek Rd, Khlong Toei, Bangkok 10110"},{name:"Sansiri",contact:"Apichet Bunyakiet",email:"sansiri@sansiri.com",phone:"1685",address:"475 Siripinyo Bldg, Si Ayutthaya Rd, Ratchathewi, Bangkok 10400"},{name:"Central Pattana (CPN)",contact:"Wallaya Chirathivat",email:"cpn@centralpattana.co.th",phone:"02-667-5555",address:"999/9 Rama 1 Rd, Pathum Wan, Bangkok 10330"},{name:"MK Restaurant Group",contact:"Rit Thirakomen",email:"mk@mkrestaurantgroup.com",phone:"02-836-1000",address:"1200 Debaratna Rd, Bang Na, Bangkok 10260"},{name:"Siam Makro (CP Axtra)",contact:"Saowaluck Thithapant",email:"cpaxtra@cpaxtra.co.th",phone:"02-067-8999",address:"1468 Phatthanakan Rd, Suan Luang, Bangkok 10250"},{name:"Thai Union Group",contact:"Thiraphong Chansiri",email:"tu@thaiunion.com",phone:"02-298-0024",address:"72/1 Moo 7 Sethakit 1 Rd, Mueang Samut Sakhon, Samut Sakhon 74000"},{name:"Sri Trang Agro-Industry",contact:"Viyavood Sincharoenkul",email:"sta@sritranggroup.com",phone:"02-207-4500",address:"10 Soi 10, Phetkasem Rd, Hat Yai, Songkhla 90110"},{name:"KCE Electronics",contact:"Bancha Ongkosit",email:"kce@kce.co.th",phone:"02-326-0196",address:"72-72/1-3 Lat Krabang Ind. Estate, Lat Krabang, Bangkok 10520"},{name:"Hana Microelectronics",contact:"Richard Han",email:"hana@hanagroup.com",phone:"02-551-1297",address:"10/4 Moo 3, Vibhavadi Rangsit Rd, Lak Si, Bangkok 10210"},{name:"Muangthai Capital",contact:"Chuchat Petaumpai",email:"mtc@muangthaicap.com",phone:"02-483-8888",address:"32/1 Charan Sanitwong Rd, Bang Phlat, Bangkok 10700"},{name:"Srisawad Corporation",contact:"Chatchai Kaewbootta",email:"sawad@srisawad.com",phone:"1652",address:"99/392 Chaeng Watthana Rd, Lak Si, Bangkok 10210"},{name:"VGI",contact:"Nelson Leung",email:"vgi@vgi.co.th",phone:"02-273-8884",address:"21 TST Tower, Vibhavadi Rangsit Rd, Chatuchak, Bangkok 10900"},{name:"Plan B Media",contact:"Palin Lojanagosin",email:"planb@planbmedia.co.th",phone:"02-530-8053",address:"1213/420 Soi Lat Phrao 94, Wang Thonglang, Bangkok 10310"},{name:"BTS Group Holdings",contact:"Keeree Kanjanapas",email:"bts@bts.co.th",phone:"02-617-7300",address:"21 Phahon Yothin Rd, Chatuchak, Bangkok 10900"},{name:"Bangkok Expressway and Metro (BEM)",contact:"Sombat Kitjalaksana",email:"bem@bemplc.co.th",phone:"02-641-4611",address:"587 Sutthisan Winitchai Rd, Din Daeng, Bangkok 10400"}],E=`${fe}/api`;function hs(){var Rt;const[u,D]=p.useState(Object.keys(dt).map((t,a)=>({id:a+1,name:t,deals:dt[t]}))),[M,K]=p.useState("Deals"),[G,te]=p.useState(null),[R,_]=p.useState(!1),[C,S]=p.useState(null),[Ce,$]=p.useState([]),J=async()=>{try{const a={Authorization:`Token ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"},s=await fetch(`${E}/users/`,{headers:a});if(s.ok){const o=await s.json();$(o)}}catch(t){console.error("Error fetching users:",t)}},ce=async()=>{try{const t=localStorage.getItem("authToken"),a=t?{Authorization:`Token ${t}`}:{},s=await fetch(`${E}/stages/`,{headers:a});if(s.ok){const o=await s.json();if(o.length>0)return D(o.map(r=>({...r,deals:[]}))),!0}return!1}catch(t){return console.error("Error fetching stages:",t),!1}},w=async()=>{try{const t=localStorage.getItem("authToken"),a={"Content-Type":"application/json",...t?{Authorization:`Token ${t}`}:{}},s=Object.keys(dt);for(let o=0;o<s.length;o++)await fetch(`${E}/stages/`,{method:"POST",headers:a,body:JSON.stringify({name:s[o],order:o})})}catch(t){console.error("Error seeding stages:",t)}};p.useEffect(()=>{(async()=>{await ce()||(await w(),await ce()),g(),J()})()},[]);const g=async()=>{try{const t=localStorage.getItem("authToken"),a=t?{Authorization:`Token ${t}`}:{},s=await fetch(`${E}/deals/`,{headers:a});if(!s.ok)throw new Error("Failed to fetch deals");const o=await s.json();D(r=>{const n=r.map(i=>({...i,deals:[]}));return o.forEach(i=>{const l={id:i.id,title:i.title,customer:i.customer_name||"",amount:Number(i.amount),currency:i.currency,priority:i.priority,contact:i.contact,email:i.email,phone:i.phone,address:i.address,taxId:i.tax_id,notes:i.notes,createdAt:i.created_at,expectedClose:i.expected_close,poNumber:i.po_number||"",salesperson:i.salesperson||"",salespersonName:i.salesperson_name||"",activitySchedules:(i.activity_schedules||[]).map(d=>({id:d.id,startAt:d.start_at?d.start_at.slice(0,16):"",dueAt:d.due_at?d.due_at.slice(0,16):"",activityName:d.activity_name||"",salesperson:d.salesperson||"",customer:d.customer||"",completed:d.completed||!1,linked_task:d.linked_task,linked_task_title:d.linked_task_title,linked_task_due_date:d.linked_task_due_date}))},c=n.findIndex(d=>d.name===i.stage);c>=0?n[c].deals.push(l):n.length>0&&n[0].deals.push(l)}),n})}catch(t){console.error("Error loading deals:",t)}},[x,L]=p.useState(null),[z,Z]=p.useState(null),He=t=>t&&t!=="none"?t.charAt(0).toUpperCase()+t.slice(1):"Set Priority",ue={company:"",contact:"",opportunity:"",email:"",phone:"",address:"",taxId:"",poNumber:"",amount:0,currency:"฿",priority:"none",stageIndex:0,salesperson:""},[f,F]=p.useState(ue),[m,B]=p.useState(ue),[h,b]=p.useState(null),[P,q]=p.useState(""),[W,ne]=p.useState(""),[oe,A]=p.useState(""),[he,xe]=p.useState(""),[de,Fe]=p.useState(null),[ye,Xe]=p.useState(null),[Ht,Ke]=p.useState(null),Ze=p.useRef(null),[Ft,Qe]=p.useState(!1),[ve,et]=p.useState(null),[le,Kt]=p.useState(null),[xs,pt]=p.useState({show:!1,message:""}),[Wt,gt]=p.useState(!1),[Ut,ps]=p.useState(null),[Vt,gs]=p.useState(!1),[tt,re]=p.useState(!1),[Re,De]=p.useState(null),[bt,We]=p.useState(""),[Se,Te]=p.useState(""),[Le,at]=p.useState([]),[pe,Pe]=p.useState(0),we=p.useRef(null),[st,Gt]=p.useState(!1),U=p.useRef(null),[nt,Ue]=p.useState(null),[y,Q]=p.useState(ue),[ft,vt]=p.useState(!1),[je,Ve]=p.useState(()=>{try{return JSON.parse(localStorage.getItem("email_config"))||{serviceId:"",templateId:"",publicKey:""}}catch{return{serviceId:"",templateId:"",publicKey:""}}}),[yt,wt]=p.useState(!1),ot=p.useRef(!1),[Ne,Ge]=p.useState([]),jt=p.useRef(null),[Nt,Je]=p.useState(!1),[ae,Ee]=p.useState({text:"",url:""}),qe=p.useRef(null),[Y,Ie]=p.useState(null),[kt,Jt]=p.useState({top:0,left:0}),[lt,$e]=p.useState(!1),qt=t=>{Ve(t),localStorage.setItem("email_config",JSON.stringify(t)),wt(!1),ie("Email settings saved")},Be=(t,a=!1)=>{a&&(ot.current=!0),Te(t),we.current&&clearTimeout(we.current),we.current=setTimeout(()=>{at(s=>{const o=s.slice(0,pe+1);return o.push(t),o}),Pe(s=>s+1)},700)},Ct=()=>{if(pe>0){const t=pe-1;Pe(t),Te(Le[t]),we.current&&clearTimeout(we.current)}},rt=()=>{if(pe<Le.length-1){const t=pe+1;Pe(t),Te(Le[t]),we.current&&clearTimeout(we.current)}},ee=(t,a=null)=>{document.execCommand(t,!1,a),U.current&&(U.current.focus(),Be(U.current.innerHTML,!0))},Yt=()=>{Ie(null);const t=window.getSelection();t.rangeCount>0?(qe.current=t.getRangeAt(0),Ee({text:t.toString(),url:""})):(qe.current=null,Ee({text:"",url:""})),Je(!0)},Dt=()=>{if(Je(!1),!!ae.url&&U.current){if(U.current.focus(),Y){Y.href=ae.url,Y.textContent=ae.text,Be(U.current.innerHTML,!0),Ie(null);return}if(qe.current){const t=window.getSelection();t.removeAllRanges(),t.addRange(qe.current)}if(ae.text)if(window.getSelection().toString()===ae.text)ee("createLink",ae.url);else{const s=`<a href="${ae.url}" target="_blank" rel="noopener noreferrer" style="color: blue; text-decoration: underline; cursor: pointer;">${ae.text}</a>`;document.execCommand("insertHTML",!1,s),Be(U.current.innerHTML,!0)}else ee("createLink",ae.url)}},Xt=t=>{if(t.target.tagName==="A"){const a=t.target.getBoundingClientRect(),o=U.current.parentElement.getBoundingClientRect();Jt({top:a.bottom-o.top+U.current.scrollTop+5,left:a.left-o.left}),Ie(t.target),(t.ctrlKey||t.metaKey)&&window.open(t.target.href,"_blank")}else Ie(null)},Zt=t=>{if(t.target.files&&t.target.files.length>0){const a=Array.from(t.target.files).map(s=>(s.preview=URL.createObjectURL(s),s));Ge(s=>[...s,...a])}t.target.value=""},Qt=t=>{Ge(a=>a.filter((s,o)=>o!==t))};p.useEffect(()=>()=>{Ne.forEach(t=>{t.preview&&URL.revokeObjectURL(t.preview)})},[Ne]),p.useEffect(()=>{if(ot.current){ot.current=!1;return}if(U.current&&U.current.innerHTML!==Se)if(document.activeElement!==U.current)U.current.innerHTML=Se;else{const t=window.getSelection();t.rangeCount>0&&t.getRangeAt(0),U.current.innerHTML=Se}},[Se]);const ie=t=>{pt({show:!0,message:t}),setTimeout(()=>pt({show:!1,message:""}),3e3)},St=(t,a="info",s="",o="")=>{try{const r=JSON.parse(localStorage.getItem("notifications")||"[]"),n=Array.isArray(r)?r:[];n.unshift({id:Date.now(),message:t,timestamp:new Date().toISOString(),unread:!0,type:a,company:s||"",source:o||""}),n.length>50&&(n.length=50),localStorage.setItem("notifications",JSON.stringify(n)),window.dispatchEvent(new Event("storage"))}catch{}},ea=t=>t.reduce((a,s)=>a+(s.amount||0),0),ta=t=>{const a=(t.activitySchedules||[]).map(n=>new Date(n.dueAt??n.startAt).getTime()).filter(n=>Number.isFinite(n));if(!a.length)return null;const s=Date.now(),o=a.filter(n=>n>=s),r=o.length?o:a;return Math.min(...r)},Tt=t=>{const a=(t.activitySchedules||[]).filter(l=>!l.completed).map(l=>({s:l,t:new Date(l.dueAt??l.startAt).getTime()})).filter(l=>Number.isFinite(l.t));if(!a.length)return null;const s=Date.now(),o=a.filter(l=>l.t>=s),r=o.length?o:a,n=Math.min(...r.map(l=>l.t)),i=r.find(l=>l.t===n)||a.find(l=>l.t===n);return i?i.s:null},aa=t=>{const a=(t.activitySchedules||[]).map(s=>new Date(s.dueAt??s.startAt).getTime()).filter(s=>Number.isFinite(s));return a.length?Math.max(...a):null},sa=t=>{const a=t.createdAt?new Date(t.createdAt).getTime():null;return Number.isFinite(a)?a:null},na=t=>{const a=t.expectedClose?new Date(t.expectedClose).getTime():null;return Number.isFinite(a)?a:null},oa=(t,a,s)=>{if(!a)return t;const o=n=>a==="createdAt"?sa(n):a==="lastActivity"?aa(n):a==="expectedClose"?na(n):null,r=t.map(n=>({d:n,k:o(n)}));return r.sort((n,i)=>{const l=n.k??(s?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),c=i.k??(s?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY);return s?l-c:c-l}),r.map(n=>n.d)},la=t=>{if(!t)return!1;const a=new Date(t),s=new Date,o=new Date(s);o.setHours(0,0,0,0);const n=(o.getDay()+6)%7,i=new Date(o);i.setDate(o.getDate()-n);const l=new Date(i);return l.setDate(i.getDate()+6),a>=i&&a<=l},it=t=>{if(!t)return"";const a=String(t).trim();return a?a.charAt(0).toUpperCase()+a.slice(1):""},ze=(t,a,s)=>{D(o=>o.map((r,n)=>{if(n!==t)return r;const i=r.deals.map((l,c)=>c===a?s(l):l);return{...r,deals:i}}))},ra=async(t,a,s,o,r,n)=>{const i=u[t].deals[a],l=Date.now(),c=r||i.salesperson||i.salespersonName||"",d=n||i.customer||i.customer_name||"",N={id:l,dueAt:s,activityName:o,salesperson:c,customer:d};D(k=>k.map((v,I)=>{if(I!==t)return v;const j=v.deals.map((T,O)=>O===a?{...T,activitySchedules:[...T.activitySchedules||[],N]}:T);return{...v,deals:j}}));try{const k=localStorage.getItem("authToken"),v={"Content-Type":"application/json",...k?{Authorization:`Token ${k}`}:{}},I=JSON.stringify({deal:i.id,due_at:s,activity_name:o,salesperson:c,customer:d});let j=await fetch(`${E}/activity_schedules/`,{method:"POST",headers:v,body:I});if(j.status===401&&k&&(j=await fetch(`${E}/activity_schedules/`,{method:"POST",headers:{"Content-Type":"application/json"},body:I})),!j.ok){const O=await j.text();throw new Error(`Server error ${j.status}: ${O}`)}const T=await j.json();D(O=>O.map((V,ge)=>{if(ge!==t)return V;const be=V.deals.map((se,_e)=>{if(_e!==a)return se;const Ae=(se.activitySchedules||[]).map(ke=>ke.id===l?{...ke,id:T.id,salesperson:T.salesperson||ke.salesperson,customer:T.customer||ke.customer}:ke);return{...se,activitySchedules:Ae}});return{...V,deals:be}}))}catch(k){console.error("Failed to add schedule",k),alert(`Failed to save schedule: ${k.message}`)}},It=async(t,a,s,o)=>{const n=u[t].deals[a].activitySchedules[s];if(n.id){D(i=>i.map((l,c)=>{if(c!==t)return l;const d=l.deals.map((N,k)=>{if(k!==a)return N;const v=N.activitySchedules.map((I,j)=>j===s?{...I,...o}:I);return{...N,activitySchedules:v}});return{...l,deals:d}}));try{const i=localStorage.getItem("authToken"),l={"Content-Type":"application/json",...i?{Authorization:`Token ${i}`}:{}},c={};o.dueAt!==void 0&&(c.due_at=o.dueAt),o.activityName!==void 0&&(c.activity_name=o.activityName);let d=await fetch(`${E}/activity_schedules/${n.id}/`,{method:"PATCH",headers:l,body:JSON.stringify(c)});d.status===401&&i&&(d=await fetch(`${E}/activity_schedules/${n.id}/`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}))}catch(i){console.error("Failed to update schedule",i)}}},At=async(t,a,s)=>{const r=u[t].deals[a].activitySchedules[s];if(r.id){D(n=>n.map((i,l)=>{if(l!==t)return i;const c=i.deals.map((d,N)=>{if(N!==a)return d;const k=d.activitySchedules.filter((v,I)=>I!==s);return{...d,activitySchedules:k}});return{...i,deals:c}}));try{const n=localStorage.getItem("authToken"),i={"Content-Type":"application/json",...n?{Authorization:`Token ${n}`}:{}};console.log(`Attempting to delete schedule ${r.id} at ${E}/activity_schedules/${r.id}/`);let l=await fetch(`${E}/activity_schedules/${r.id}/`,{method:"DELETE",headers:i});if(l.status===401&&n&&(l=await fetch(`${E}/activity_schedules/${r.id}/`,{method:"DELETE",headers:{"Content-Type":"application/json"}})),l.status===404){console.warn("Schedule not found on server, considering deleted.");return}if(!l.ok){const c=await l.text();throw new Error(`Server returned ${l.status}: ${c}`)}}catch(n){console.error("Failed to delete schedule",n),alert(`Failed to delete schedule: ${n.message}`),g()}}},ia=(t,a)=>{for(let s=0;s<u.length;s++){const o=u[s],r=o.deals.findIndex(n=>n.id===t);if(r!==-1){const i=(o.deals[r].activitySchedules||[]).findIndex(l=>l.id===a);if(i!==-1){window.confirm("Delete this activity schedule?")&&At(s,r,i);return}}}console.warn("Could not find activity to delete",t,a)},ca=(t,a,s,o)=>{s===o||s==null||o==null||ze(t,a,r=>{const n=[...r.activitySchedules||[]],[i]=n.splice(s,1);return n.splice(o,0,i),{...r,activitySchedules:n}})},da=(t,a,s)=>{ze(t,a,o=>{const r=[...o.activitySchedules||[]];if(s<=0)return o;const n=r[s-1];return r[s-1]=r[s],r[s]=n,{...o,activitySchedules:r}})},ma=(t,a,s)=>{ze(t,a,o=>{const r=[...o.activitySchedules||[]];if(s>=r.length-1)return o;const n=r[s+1];return r[s+1]=r[s],r[s]=n,{...o,activitySchedules:r}})},ua=(t,a)=>{const s=u[t].deals[a];B({company:s.customer||s.customer_name||"",contact:s.contact||"",opportunity:s.title||"",email:s.email||"",phone:s.phone||"",address:s.address||"",taxId:s.taxId||"",poNumber:s.poNumber||"",amount:s.amount||0,currency:s.currency||"฿",priority:s.priority||"none",stageIndex:t,notes:s.notes||"",salesperson:s.salesperson||s.salespersonName||""}),L({stageIndex:t,cardIndex:a})},ha=async()=>{if(!x)return;const{stageIndex:t,cardIndex:a}=x,s=u[t].deals[a].id,o=`

──────────────────────────
`;let n=(m.notes||"").split(o);n=n.map(l=>{const c=/^\[(\d{1,2}\/\d{1,2}\/\d{4}, \d{1,2}:\d{2}(?:\s?[a-zA-Z]{2})?)\]\s*/;let N=l.match(c)?l.replace(c,""):l;const k=/[\r\n]*(<<Attachment:([^:]+):([^:]+):(.+?)>>)/g;let v=!1,I,j=N;for(;(I=k.exec(N))!==null;)v=!0,j=j.replace(I[0],"");return!(j.trim().length>0)&&!v?"":l});const i=n.join(o);D(l=>l.map((c,d)=>{if(d!==t)return c;const N=c.deals.map((k,v)=>v===a?{...k,customer:m.company,customer_name:m.company,title:m.opportunity,amount:m.amount,currency:m.currency,priority:m.priority,contact:m.contact,email:m.email,phone:m.phone,address:m.address,taxId:m.taxId,poNumber:m.poNumber,notes:i,salesperson:m.salesperson,salespersonName:m.salesperson}:k);return{...c,deals:N}})),L(null);try{const l=localStorage.getItem("authToken"),c=l?{Authorization:`Token ${l}`,"Content-Type":"application/json"}:{"Content-Type":"application/json"},d=u[t].name,N={title:m.opportunity,customer_name:m.company,amount:m.amount,currency:m.currency,priority:m.priority,contact:m.contact,email:m.email,phone:m.phone,address:m.address,tax_id:m.taxId,po_number:m.poNumber,notes:i,stage:d,salesperson:m.salesperson};await fetch(`${E}/deals/${s}/`,{method:"PATCH",headers:c,body:JSON.stringify(N)})}catch(l){console.error("Failed to update deal details",l),ie("Failed to update deal details")}},[ct,Oe]=p.useState(null),xa=(t,a)=>{const s=u[t].deals[a];B({...ue,notes:s.notes||""}),Oe({stageIndex:t,cardIndex:a})},pa=async()=>{if(!ct)return;const{stageIndex:t,cardIndex:a}=ct,s=u[t].deals[a].id,o=`

──────────────────────────
`;let n=(m.notes||"").split(o);n=n.map(l=>{const c=/^\[(\d{1,2}\/\d{1,2}\/\d{4}, \d{1,2}:\d{2}(?:\s?[a-zA-Z]{2})?)\]\s*/;let N=l.match(c)?l.replace(c,""):l;const k=/[\r\n]*(<<Attachment:([^:]+):([^:]+):(.+?)>>)/g;let v=!1,I,j=N;for(;(I=k.exec(N))!==null;)v=!0,j=j.replace(I[0],"");return!(j.trim().length>0)&&!v?"":l});const i=n.join(o);D(l=>l.map((c,d)=>{if(d!==t)return c;const N=c.deals.map((k,v)=>v===a?{...k,notes:i}:k);return{...c,deals:N}})),Oe(null);try{const l=localStorage.getItem("authToken"),c=l?{Authorization:`Token ${l}`,"Content-Type":"application/json"}:{"Content-Type":"application/json"},d={notes:i};await fetch(`${E}/deals/${s}/`,{method:"PATCH",headers:c,body:JSON.stringify(d)})}catch(l){console.error("Failed to update deal notes",l),ie("Failed to update deal notes")}},ga=(t,a)=>{const s=u[t].deals[a];De({stageIndex:t,cardIndex:a,to:s.email||""}),We(`Regarding: ${s.title}`);const o="";Te(o),at([o]),Pe(0)},ba=(t,a,s)=>{s.dataTransfer.setData("card",JSON.stringify({stageIndex:t,cardIndex:a}))},fa=async(t,a)=>{const s=a.dataTransfer.getData("card");if(!s)return;const{stageIndex:o,cardIndex:r}=JSON.parse(s);if(o===t)return;const n=u[o].deals[r];if(n){const i=u[o].name,l=u[t].name,c=String(l||"").toLowerCase(),d=c.includes("close")&&c.includes("won"),N=`CRM: Moved "${n.title}" from ${i} --> ${l}`,k=d?`${N} — Create PO or Receive PO`:N;ie(k),St(k,d?"success":"info",n.customer||"","CRM"),window.dispatchEvent(new Event("notificationUpdated"));try{const v=localStorage.getItem("authToken");await fetch(`${E}/deals/${n.id}/`,{method:"PATCH",headers:{"Content-Type":"application/json",...v?{Authorization:`Token ${v}`}:{}},body:JSON.stringify({stage:l})}),window.dispatchEvent(new Event("notificationUpdated"))}catch(v){console.error("Failed to persist stage change",v)}}D(i=>{const l=i.map(d=>({...d,deals:[...d.deals]})),[c]=l[o].deals.splice(r,1);return l[t].deals.push(c),l})},Mt=(t,a)=>{try{a.dataTransfer.setDragImage(a.currentTarget,40,20)}catch{}a.dataTransfer.setData("stage",String(t))},va=async(t,a)=>{const s=a.dataTransfer.getData("stage");if(s==="")return;const o=Number(s);if(o===t)return;let r=[];D(n=>{const i=n.map(c=>({...c,deals:[...c.deals]})),[l]=i.splice(o,1);return i.splice(t,0,l),r=i,i});try{const n=localStorage.getItem("authToken"),i={"Content-Type":"application/json",...n?{Authorization:`Token ${n}`}:{}};await Promise.all(r.map((l,c)=>fetch(`${E}/stages/${l.id}/`,{method:"PATCH",headers:i,body:JSON.stringify({order:c})})))}catch(n){console.error("Error reordering stages:",n)}},ya=async t=>{const a=u[t],s=a.name,o=window.prompt("Edit stage name",s);if(!(!o||o===s)){D(r=>r.map((n,i)=>i===t?{...n,name:o}:n)),te(null);try{const r=localStorage.getItem("authToken"),n={"Content-Type":"application/json",...r?{Authorization:`Token ${r}`}:{}};await fetch(`${E}/stages/${a.id}/`,{method:"PATCH",headers:n,body:JSON.stringify({name:o})}),a.deals&&a.deals.length>0&&await Promise.all(a.deals.map(i=>fetch(`${E}/deals/${i.id}/`,{method:"PATCH",headers:n,body:JSON.stringify({stage:o})})))}catch(r){console.error("Error editing stage:",r),ie("Error updating stage name")}}},wa=async t=>{if(u.length<=1||!window.confirm("Delete this stage? Deals inside will be removed."))return;const s=u[t];D(o=>o.filter((r,n)=>n!==t)),te(null);try{const o=localStorage.getItem("authToken"),r=o?{Authorization:`Token ${o}`}:{};await fetch(`${E}/stages/${s.id}/`,{method:"DELETE",headers:r}),s.deals&&s.deals.length>0&&await Promise.all(s.deals.map(n=>fetch(`${E}/deals/${n.id}/`,{method:"DELETE",headers:r})))}catch(o){console.error("Error deleting stage:",o),ie("Error deleting stage")}},ja=async()=>{const t=window.prompt("New stage name");if(!t)return;const a=Date.now();D(s=>[...s,{id:a,name:t,deals:[]}]);try{const s=localStorage.getItem("authToken"),o={"Content-Type":"application/json",...s?{Authorization:`Token ${s}`}:{}},r=u.length,n=await fetch(`${E}/stages/`,{method:"POST",headers:o,body:JSON.stringify({name:t,order:r})});if(n.ok){const i=await n.json();D(l=>l.map(c=>c.id===a?{...c,id:i.id,deals:[]}:c))}else console.error("Failed to add stage"),D(i=>i.filter(l=>l.id!==a))}catch(s){console.error("Error adding stage:",s),D(o=>o.filter(r=>r.id!==a))}},Ye=async(t,a,s)=>{const o=u[t].deals[a];D(r=>r.map((n,i)=>{if(i!==t)return n;const l=n.deals.map((c,d)=>d===a?{...c,priority:s}:c);return{...n,deals:l}})),Z(null);try{const r=localStorage.getItem("authToken"),n={"Content-Type":"application/json",...r?{Authorization:`Token ${r}`}:{}};await fetch(`${E}/deals/${o.id}/`,{method:"PATCH",headers:n,body:JSON.stringify({priority:s})})}catch(r){console.error("Failed to update priority",r)}},Na=async()=>{if(!nt)return;const{stageIndex:t,cardIndex:a}=nt,s=y.stageIndex,o=u[t].deals[a].id,r={title:y.opportunity||y.company||"Untitled",customer:y.company||"",amount:Number(y.amount)||0,currency:y.currency||"฿",priority:y.priority||"none",contact:y.contact||"",email:y.email||"",phone:y.phone||"",address:y.address||"",taxId:y.taxId||"",poNumber:y.poNumber||"",salesperson:y.salesperson||""};D(n=>{if(t!==s){const i=n[t],l=i.deals[a],c=[...n];c[t]={...i,deals:i.deals.filter((N,k)=>k!==a)};const d={...l,...r};return c[s]={...c[s],deals:[...c[s].deals,d]},c}else return n.map((i,l)=>{if(l!==t)return i;const c=i.deals.map((d,N)=>N===a?{...d,...r}:d);return{...i,deals:c}})}),Ue(null);try{const n=localStorage.getItem("authToken"),i={"Content-Type":"application/json",...n?{Authorization:`Token ${n}`}:{}},l=u[s].name,c={title:r.title,customer_name:r.customer,amount:r.amount,currency:r.currency,priority:r.priority,contact:r.contact,email:r.email,phone:r.phone,address:r.address,tax_id:r.taxId,po_number:r.poNumber,stage:l,salesperson:r.salesperson};await fetch(`${E}/deals/${o}/`,{method:"PATCH",headers:i,body:JSON.stringify(c)})}catch(n){console.error("Failed to update deal",n),ie("Failed to update deal")}},ka=(t,a)=>{S({stageIndex:t,cardIndex:a})},Ca=t=>{S({ids:t})},Da=async()=>{if(!C)return;if(C.type==="schedule"){const{stageIndex:o,cardIndex:r,scheduleIdx:n}=C;At(o,r,n),S(null);return}let t=[];if(C.ids)t=C.ids;else if(C.stageIndex!==void 0){const{stageIndex:o,cardIndex:r}=C;u[o]&&u[o].deals[r]&&(t=[u[o].deals[r].id])}if(t.length===0){S(null);return}D(o=>o.map(r=>({...r,deals:r.deals.filter(n=>!t.includes(n.id))}))),S(null);const a=localStorage.getItem("authToken"),s=a?{Authorization:`Token ${a}`}:{};for(const o of t)try{await fetch(`${E}/deals/${o}/`,{method:"DELETE",headers:s})}catch(r){console.error("Failed to delete deal",o,r)}};return e.jsxs("main",{className:"min-h-screen bg-white font-sans text-gray-900",children:[e.jsx(Ia,{}),e.jsx("div",{className:"border-b border-slate-200 bg-white px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2 cursor-pointer",children:"CRM"}),e.jsx("div",{className:"h-6 w-px bg-slate-200 hidden sm:block"}),e.jsx("div",{className:"flex items-center gap-2",children:["Deals","Customers","Activities","History"].map(t=>e.jsx("button",{onClick:()=>K(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${M===t?"bg-slate-100 text-slate-900":"text-slate-600 hover:bg-slate-100 hover:text-slate-900"}`,children:t==="Deals"?"Sales Pipeline":t},t))})]}),M==="Deals"&&e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:()=>{F(ue),_(!0)},className:"px-5 py-2 text-sm font-medium text-white bg-[#2D4485] rounded-lg hover:bg-[#3D56A6] shadow-md transition-all hover:shadow-lg transform hover:-translate-y-0.5",children:"+ Create deal"})})]})}),M==="Deals"?e.jsxs("section",{className:"w-full overflow-x-auto h-[calc(100vh-140px)] bg-slate-50",children:[e.jsxs("div",{className:"flex h-full p-6 gap-6",children:[u.map((t,a)=>{const s=ea(t.deals),o=Math.round((a+1)/u.length*100),r=oa(t.deals,Ut,Vt);return e.jsxs("div",{className:"w-80 min-w-[20rem] flex flex-col h-full bg-slate-100/50 rounded-2xl border border-slate-200/60 group",draggable:!0,onDragStart:n=>Mt(a,n),onDragOver:n=>n.preventDefault(),onDrop:n=>{n.dataTransfer.getData("card")?fa(a,n):n.dataTransfer.getData("stage")!==""&&va(a,n)},children:[e.jsxs("div",{className:"p-4 text-center border-b border-slate-200/60 cursor-grab active:cursor-grabbing bg-transparent group/header relative",draggable:!0,onDragStart:n=>Mt(a,n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-bold text-slate-700 uppercase text-xs tracking-wider",children:[e.jsxs("span",{className:"mr-1 opacity-60",children:[a+1,"."]})," ",t.name,e.jsx("span",{className:"ml-2 text-slate-500 font-normal normal-case bg-slate-200 px-1.5 py-0.5 rounded-full text-[10px]",children:t.deals.length})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{className:"text-slate-400 hover:text-slate-600 opacity-0 group-hover/header:opacity-100 transition-opacity",onClick:n=>{n.stopPropagation(),te(G===a?null:a)},children:"⋯"})})]}),G===a&&e.jsxs("div",{className:"absolute right-2 top-8 bg-white border border-slate-200 rounded-lg shadow-xl z-30 w-32 text-left py-1",children:[e.jsx("button",{className:"block w-full text-left px-3 py-1.5 text-sm hover:bg-slate-50",onClick:()=>ya(a),children:"Edit Stage"}),e.jsx("button",{className:"block w-full text-left px-3 py-1.5 text-sm hover:bg-slate-50 text-red-600",onClick:()=>wa(a),children:"Delete Stage"})]}),e.jsx("div",{className:"h-1 w-full bg-slate-200 rounded-full overflow-hidden mt-3",children:e.jsx("div",{className:"h-full bg-[#2D4485]/60",style:{width:`${o}%`}})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[r.map((n,i)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-slate-200 p-4 mb-3 hover:shadow-md hover:ring-[#2D4485]/30 transition-all cursor-grab relative group/card",draggable:!0,onDragStart:l=>ba(a,i,l),children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1 min-w-0 flex flex-col items-start gap-1.5",children:e.jsx("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-blue-50 text-[#2D4485] text-sm font-semibold border border-blue-100 cursor-pointer hover:bg-blue-100 transition-colors max-w-full",onClick:l=>{l.stopPropagation(),ua(a,i)},title:"View company details",children:e.jsx("span",{className:"truncate text-xs leading-tight",children:n.customer||n.customer_name||n.contact||n.email||n.title})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full border border-blue-100 bg-blue-50 text-[#2D4485] hover:bg-blue-100 transition-colors",onClick:l=>{l.stopPropagation(),ga(a,i)},title:"Send email",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[e.jsx("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),e.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]})}),e.jsx("button",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full border border-red-100 bg-red-50 text-red-500 hover:bg-red-100 transition-colors",onClick:l=>{l.stopPropagation(),ka(a,i)},title:"Delete deal",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]})})]})]}),e.jsx("div",{className:"flex justify-between items-start gap-2 mb-3",children:e.jsx("h4",{className:"font-semibold text-slate-800 text-sm leading-snug",children:n.title})}),e.jsx("div",{className:"space-y-2 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-900 font-bold text-sm",children:[e.jsx("span",{className:"text-xs font-normal text-slate-400",children:n.currency}),n.amount.toLocaleString()]}),(n.salesperson||n.salespersonName)&&e.jsxs("span",{className:"text-xs text-slate-600 font-medium px-1 flex items-center gap-1.5",title:`Salesperson: ${n.salesperson||n.salespersonName}`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),n.salesperson||n.salespersonName]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 relative",children:[e.jsx("div",{className:`inline-flex items-center gap-1 px-2.5 h-6 rounded-full text-[11px] text-white font-bold shadow-sm ${n.priority==="high"?"bg-red-500 ring-2 ring-red-100":n.priority==="medium"?"bg-orange-400 ring-2 ring-orange-100":n.priority==="low"?"bg-[#2D4485] ring-2 ring-blue-100":"bg-slate-400 ring-2 ring-slate-200"} cursor-pointer hover:scale-110 transition-transform`,onClick:l=>{l.stopPropagation();const c=z&&z.stageIndex===a&&z.cardIndex===i;Z(c?null:{stageIndex:a,cardIndex:i})},title:`Priority: ${He(n.priority)}`,children:He(n.priority)}),z&&z.stageIndex===a&&z.cardIndex===i&&e.jsxs("div",{className:"absolute left-0 bottom-8 bg-white border border-slate-200 rounded-lg shadow-xl z-20 w-32 py-1",children:[e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:l=>{l.stopPropagation(),Ye(a,i,"low"),Z(null)},children:"Low"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:l=>{l.stopPropagation(),Ye(a,i,"medium"),Z(null)},children:"Medium"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:l=>{l.stopPropagation(),Ye(a,i,"high"),Z(null)},children:"High"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:l=>{l.stopPropagation(),Ye(a,i,"none"),Z(null)},children:"None"})]}),e.jsx("div",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-slate-50 rounded px-1.5 py-0.5 transition-colors",onClick:l=>{l.stopPropagation(),b(h&&h.stageIndex===a&&h.cardIndex===i?null:{stageIndex:a,cardIndex:i})},title:(()=>{const l=Tt(n);if(!l)return"No upcoming activity";const c=it(l.text||"Activity"),d=l.dueAt?new Date(l.dueAt).toLocaleString():"";return d?`${c} — ${d}`:c})(),children:(()=>{const l=Tt(n);return l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium truncate max-w-[80px]",children:it(l.text||"Activity")})]}):e.jsx(e.Fragment,{children:e.jsx("svg",{className:"w-3.5 h-3.5 text-slate-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})})()})]}),e.jsxs("div",{className:"flex items-center gap-1.5 max-w-[120px] cursor-pointer group/note",onClick:l=>{l.stopPropagation(),xa(a,i)},title:n.notes||"Add note",children:[e.jsx(Ka,{className:`w-3.5 h-3.5 shrink-0 transition-colors ${n.notes?"text-[#2D4485]":"text-slate-300 group-hover/note:text-[#2D4485]"}`}),e.jsx("span",{className:`text-[11px] truncate transition-colors ${n.notes?"text-[#2D4485] font-medium":"text-slate-400 group-hover/note:text-[#2D4485]"}`,children:(()=>{if(!n.notes)return"Notes";const l=n.notes.split(`

──────────────────────────
`);let c=!1,d=null;if(l.forEach(N=>{const k=N.match(/^\[(\d{1,2}\/\d{1,2}\/\d{4}.*?)\]\s*/);let v=k?N.replace(/^\[(\d{1,2}\/\d{1,2}\/\d{4}.*?)\]\s*/,""):N;const I=/[\r\n]*(<<Attachment:([^:]+):([^:]+):(.+?)>>)/g,j=v.replace(I,"").trim(),T=v.match(I);(j.length>0||T&&T.length>0)&&(c=!0,k&&!d&&(d=k))}),!c)return"Notes";if(d){const N=d[1].split(",")[0].trim();if(!N)return"Notes";const[k,v,I]=N.split("/").map(Number);if(!k||!v||!I)return N;const j=new Date(I,v-1,k),T=new Date;T.setHours(0,0,0,0);const O=new Date(T);return O.setDate(O.getDate()-1),j.getTime()===T.getTime()?"Today":j.getTime()===O.getTime()?"Yesterday":N}return"Notes"})()})]})]})]},n.id)),e.jsxs("button",{onClick:()=>{F({...ue,stageIndex:a}),_(!0)},className:"w-full py-2.5 mt-2 text-sm font-medium text-slate-500 hover:text-[#2D4485] hover:bg-slate-200/50 rounded-lg border border-transparent hover:border-slate-200 transition-all flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg leading-none",children:"+"})," New deal"]})]}),e.jsx("div",{className:"p-3 border-t border-slate-200/60 bg-slate-50/50 rounded-b-2xl",children:e.jsx("div",{className:"flex flex-col items-center justify-center text-center",children:e.jsxs("div",{className:"text-sm text-slate-700 font-semibold",children:["Total: ",s.toLocaleString()," ฿"]})})})]},t.id)}),e.jsx("div",{className:"w-80 shrink-0 p-4",children:e.jsx("button",{onClick:ja,className:"w-full py-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-500 font-medium hover:border-[#2D4485] hover:text-[#2D4485] hover:bg-[#2D4485]/5 transition-all",children:"+ Add Stage"})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-40 transition-opacity",onClick:()=>b(null),children:e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-full max-w-3xl px-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 w-full",tabIndex:0,ref:t=>{t&&(Ze.current=t)},onKeyDown:t=>{const a=t.target&&t.target.tagName;if(a==="INPUT"||a==="TEXTAREA")return;const s=de&&h&&de.stageIndex===h.stageIndex&&de.cardIndex===h.cardIndex?de.idx:null;if(s!=null){if(t.key==="ArrowUp")t.preventDefault(),s>0&&(da(h.stageIndex,h.cardIndex,s),Fe({stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s-1}));else if(t.key==="ArrowDown"){t.preventDefault();const o=(u[h.stageIndex].deals[h.cardIndex].activitySchedules||[]).length;s<o-1&&(ma(h.stageIndex,h.cardIndex,s),Fe({stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s+1}))}}},children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Next Activity"}),(()=>{const t=u[h.stageIndex].deals[h.cardIndex],a=ta(t);return la(a)?e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-blue-50 text-[#2D4485] text-xs font-medium border border-blue-100",children:"This week"}):null})(),e.jsx("span",{className:"px-2.5 py-1 rounded-full bg-slate-100 text-slate-600 text-xs font-medium border border-slate-200",children:(()=>{const t=u[h.stageIndex].deals[h.cardIndex];return(t.activitySchedules||[]).length?`${(t.activitySchedules||[]).length} scheduled`:"No schedules"})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-slate-200 bg-white text-slate-600 hover:bg-slate-50 hover:border-slate-300 transition-colors",onClick:()=>{const t=u[h.stageIndex].deals[h.cardIndex];Qe(!0),q(""),ne(""),A(""),xe(t.customer||t.customer_name||"")},title:"Add schedule",children:"+"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>b(null),children:"✕"})]})]}),e.jsx("div",{className:"p-6 space-y-4",children:(()=>{const t=u[h.stageIndex].deals[h.cardIndex];return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[(t.activitySchedules||[]).map((a,s)=>e.jsxs("div",{className:`flex flex-wrap items-center gap-3 bg-white border border-slate-200 rounded-xl p-3 shadow-sm ${de&&h&&de.stageIndex===h.stageIndex&&de.cardIndex===h.cardIndex&&de.idx===s?"ring-2 ring-[#2D4485]/20 border-[#2D4485]":""} ${Ht===s?"ring-2 ring-blue-300":""} ${le&&le.stageIndex===h.stageIndex&&le.cardIndex===h.cardIndex&&le.idx===s?"cursor-default":"cursor-grab active:cursor-grabbing hover:border-slate-300"}`,onClick:o=>{const r=o.target&&o.target.tagName;r==="INPUT"||r==="TEXTAREA"||r==="BUTTON"||(Fe({stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s}),Ze.current&&Ze.current.focus())},title:`${it(a.activityName||"Activity")}${a.dueAt?` — ${new Date(a.dueAt).toLocaleString()}`:""}`,draggable:!0,onDragStart:o=>{const r=o.target,n=r&&r.tagName,i=n==="INPUT"||n==="TEXTAREA"||n==="BUTTON",l=!!(le&&le.stageIndex===h.stageIndex&&le.cardIndex===h.cardIndex&&le.idx===s);if(i||l){o.preventDefault();return}Xe({stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s}),Ke(s),o.dataTransfer.effectAllowed="move"},onDragOver:o=>{o.preventDefault(),ye&&ye.stageIndex===h.stageIndex&&ye.cardIndex===h.cardIndex&&Ke(s)},onDrop:o=>{o.preventDefault(),ye&&ye.stageIndex===h.stageIndex&&ye.cardIndex===h.cardIndex&&(ca(h.stageIndex,h.cardIndex,ye.idx,s),Fe({stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s})),Xe(null),Ke(null)},onDragEnd:()=>{Xe(null),Ke(null)},children:[e.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Due"}),(()=>{const o=!!(le&&le.stageIndex===h.stageIndex&&le.cardIndex===h.cardIndex&&le.idx===s);return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"datetime-local",value:a.dueAt||"",onChange:r=>{const{stageIndex:n,cardIndex:i}=h;ze(n,i,l=>({...l,activitySchedules:(l.activitySchedules||[]).map((c,d)=>d===s?{...c,dueAt:r.target.value}:c)}))},onBlur:r=>{const{stageIndex:n,cardIndex:i}=h;It(n,i,s,{dueAt:r.target.value})},disabled:!o,className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 w-[220px] text-sm disabled:bg-slate-50 disabled:text-slate-500 disabled:border-transparent focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"}),e.jsx("input",{type:"text",value:a.activityName||"",onChange:r=>{const{stageIndex:n,cardIndex:i}=h;ze(n,i,l=>({...l,activitySchedules:(l.activitySchedules||[]).map((c,d)=>d===s?{...c,activityName:r.target.value}:c)}))},onBlur:r=>{const{stageIndex:n,cardIndex:i}=h;It(n,i,s,{activityName:r.target.value})},placeholder:"Details",className:"flex-1 min-w-[120px] rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-1.5 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-colors",onClick:()=>{const r=ve&&ve.stageIndex===h.stageIndex&&ve.cardIndex===h.cardIndex&&ve.idx===s;et(r?null:{stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s})},title:"Options",children:"⋮"}),ve&&ve.stageIndex===h.stageIndex&&ve.cardIndex===h.cardIndex&&ve.idx===s&&e.jsxs("div",{className:"absolute right-0 mt-1 bg-white border border-slate-200 rounded-lg shadow-xl z-10 overflow-hidden w-32",children:[e.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors",onClick:()=>{Kt({stageIndex:h.stageIndex,cardIndex:h.cardIndex,idx:s}),et(null)},children:"Edit"}),e.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm hover:bg-red-50 text-red-600 transition-colors",onClick:()=>{const{stageIndex:r,cardIndex:n}=h;S({type:"schedule",stageIndex:r,cardIndex:n,scheduleIdx:s}),et(null)},children:"Delete"})]})]})]})})()]},s)),Ft&&e.jsxs("div",{className:"mt-4 animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 bg-slate-50 border border-slate-200 rounded-xl p-4 shadow-inner",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Due"}),e.jsx("input",{type:"datetime-local",value:P,onChange:a=>q(a.target.value),className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 w-[220px] text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),e.jsx("input",{type:"text",value:W,onChange:a=>ne(a.target.value),placeholder:"Scheduled activity details",autoFocus:!0,className:"flex-1 min-w-[120px] rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),e.jsx("input",{type:"text",value:he,readOnly:!0,title:"Customer is automatically set from the deal",className:"w-[110px] rounded-lg border border-slate-300 bg-slate-100 px-3 py-1.5 text-sm text-slate-500 cursor-not-allowed outline-none"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>{Qe(!1),q(""),ne(""),A(""),xe("")},children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:()=>{const a=P;if(!a)return;const{stageIndex:s,cardIndex:o}=h;ra(s,o,a,W||"",oe,he),Qe(!1),q(""),ne(""),A(""),xe("")},children:"Add Schedule"})]})]})]})})})()})]})})}),nt&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-40 transition-opacity",onClick:()=>Ue(null),children:e.jsx("div",{className:"absolute left-1/2 top-16 -translate-x-1/2 w-[640px] z-50 transition-all",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Edit Deal"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>Ue(null),children:"✕"})]}),e.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Sales Person"}),e.jsx("input",{type:"text",value:y.salesperson,onChange:t=>Q({...y,salesperson:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Enter sales person name"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Company"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Company"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:y.company,onChange:t=>{Q({...y,company:t.target.value}),re(!0)},onFocus:()=>re(!0),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Search or enter company name..."}),tt&&y.company&&e.jsxs("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg z-20 max-h-60 overflow-y-auto",children:[Me.filter(t=>t.name.toLowerCase().includes(y.company.toLowerCase())).map((t,a)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-slate-700",onClick:()=>{Q({...y,company:t.name,contact:t.contact,email:t.email||"",phone:t.phone||"",address:t.address||"",taxId:t.taxId||""}),re(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Contact: ",t.contact]})]},a)),y.company&&!Me.some(t=>t.name.toLowerCase()===y.company.toLowerCase())&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-[#2D4485] font-medium",onClick:()=>{re(!1)},children:['+ Add "',y.company,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Opportunity"}),e.jsx("input",{value:y.opportunity,onChange:t=>Q({...y,opportunity:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Deal opportunity name"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Contact"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Email"}),e.jsx("input",{value:y.email,onChange:t=>Q({...y,email:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Phone"}),e.jsx("input",{value:y.phone,onChange:t=>Q({...y,phone:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Phone number"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Address"}),e.jsx("input",{value:y.address,onChange:t=>Q({...y,address:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Company address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Contact Person"}),e.jsx("input",{value:y.contact,onChange:t=>Q({...y,contact:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Contact person"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Codes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Tax ID"}),e.jsx("input",{value:y.taxId,onChange:t=>Q({...y,taxId:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Tax ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"PO Number"}),e.jsx("input",{value:y.poNumber,onChange:t=>Q({...y,poNumber:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Purchase Order Number"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Amount"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:y.currency}),e.jsx("input",{type:"number",value:y.amount,onChange:t=>Q({...y,amount:Number(t.target.value)}),className:"w-full pl-10 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Currency"}),e.jsx("input",{value:y.currency,onChange:t=>Q({...y,currency:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all text-center uppercase"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Priority"}),e.jsx("div",{className:"flex items-center gap-3",children:[1,2,3].map(t=>{const a=t===1?"low":t===2?"medium":"high",s=t===1?"Low":t===2?"Medium":"High",o=y.priority===a,r=t===1?"bg-[#2D4485]":t===2?"bg-orange-400":"bg-red-500";return e.jsxs("button",{className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${o?`${r} text-white border-transparent shadow-md transform scale-105`:"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,onClick:()=>Q({...y,priority:o?"none":a}),children:[s," Priority"]},t)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Stage"}),e.jsx("select",{value:y.stageIndex,onChange:t=>Q({...y,stageIndex:Number(t.target.value)}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",children:u.map((t,a)=>e.jsx("option",{value:a,children:t.name},t.id))})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50/50",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>Ue(null),children:"Cancel"}),e.jsx("button",{className:"px-5 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:Na,children:"Save Changes"})]})]})})}),x&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-40 transition-opacity",onClick:()=>L(null),children:e.jsx("div",{className:"absolute left-1/2 top-16 -translate-x-1/2 w-[640px] transition-all",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Company Details"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>L(null),children:"✕"})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Sales Person"}),e.jsx("input",{type:"text",value:m.salesperson,onChange:t=>B({...m,salesperson:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Enter sales person name"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Company"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Company"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:m.company,onChange:t=>{B({...m,company:t.target.value}),re(!0)},onFocus:()=>re(!0),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Search or enter company name..."}),tt&&m.company&&e.jsxs("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg z-20 max-h-60 overflow-y-auto",children:[Me.filter(t=>t.name.toLowerCase().includes(m.company.toLowerCase())).map((t,a)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-slate-700",onClick:()=>{B({...m,company:t.name,contact:t.contact,email:t.email||"",phone:t.phone||"",address:t.address||"",taxId:t.taxId||""}),re(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Contact: ",t.contact]})]},a)),m.company&&!Me.some(t=>t.name.toLowerCase()===m.company.toLowerCase())&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-[#2D4485] font-medium",onClick:()=>{re(!1)},children:['+ Add "',m.company,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Opportunity"}),e.jsx("input",{value:m.opportunity,onChange:t=>B({...m,opportunity:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Deal opportunity name"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Contact"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Email"}),e.jsx("input",{value:m.email,onChange:t=>B({...m,email:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Phone"}),e.jsx("input",{value:m.phone,onChange:t=>B({...m,phone:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Phone number"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Address"}),e.jsx("input",{value:m.address,onChange:t=>B({...m,address:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Company address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Contact Person"}),e.jsx("input",{value:m.contact,onChange:t=>B({...m,contact:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Contact person"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Codes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Tax ID"}),e.jsx("input",{value:m.taxId,onChange:t=>B({...m,taxId:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Tax ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"PO Number"}),e.jsx("input",{value:m.poNumber,onChange:t=>B({...m,poNumber:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Purchase Order Number"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Amount"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:m.currency}),e.jsx("input",{type:"number",value:m.amount,onChange:t=>B({...m,amount:Number(t.target.value)}),className:"w-full pl-10 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Currency"}),e.jsx("input",{value:m.currency,onChange:t=>B({...m,currency:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all text-center uppercase"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Priority"}),e.jsx("div",{className:"flex items-center gap-3",children:[1,2,3].map(t=>{const a=t===1?"low":t===2?"medium":"high",s=t===1?"Low":t===2?"Medium":"High",o=m.priority===a,r=t===1?"bg-[#2D4485]":t===2?"bg-orange-400":"bg-red-500";return e.jsxs("button",{className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${o?`${r} text-white border-transparent shadow-md transform scale-105`:"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,onClick:()=>B({...m,priority:o?"none":a}),children:[s," Priority"]},t)})})]})]})}),e.jsxs("div",{className:"px-4 py-3 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50/50",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>L(null),children:"Cancel"}),e.jsx("button",{className:"px-5 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:ha,children:"Save Changes"})]})]})})}),ct&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-40 transition-opacity",onClick:()=>Oe(null),children:e.jsx("div",{className:"absolute left-1/2 top-16 -translate-x-1/2 w-[640px] transition-all",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"Note"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>Oe(null),children:"✕"})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Note Content"}),e.jsxs("button",{className:"px-3 py-1.5 rounded-lg border border-[#2D4485] text-[#2D4485] bg-white hover:bg-blue-50 text-xs font-medium flex items-center gap-2 transition-all shadow-sm",onClick:()=>{const t=m.notes?`

──────────────────────────
`:"";B({...m,notes:t+(m.notes||"")})},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create another note"]})]}),e.jsx("div",{className:"space-y-4",children:(m.notes?m.notes.split(`

──────────────────────────
`):[""]).map((t,a,s)=>{const o=/^\[(\d{1,2}\/\d{1,2}\/\d{4}, \d{1,2}:\d{2}(?:\s?[a-zA-Z]{2})?)\]\s*/,r=t.match(o),n=r?r[1]:"";let i=r?t.replace(o,""):t;const l=/[\r\n]*(<<Attachment:([^:]+):([^:]+):(.+?)>>)/g,c=[];let d,N=i;for(;(d=l.exec(i))!==null;)c.push({fullMatch:d[1],type:d[2],name:d[3],data:d[4]}),N=N.replace(d[0],"");const k=N;return e.jsxs("div",{className:"relative group/note-box",children:[e.jsx("textarea",{value:k,onChange:v=>{const I=v.target.value;let j=I;c.forEach(be=>{j+=`
${be.fullMatch}`});let T=n;I.trim().length>0||c.length>0?T=new Date().toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):T="";const V=T?`[${T}] ${j}`:j,ge=[...s];ge[a]=V,B({...m,notes:ge.join(`

──────────────────────────
`)})},className:"w-full min-h-[120px] rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all resize-y pb-10",placeholder:"Add notes about this deal...",autoFocus:a===0}),n&&e.jsx("div",{className:"absolute bottom-2 right-3 text-xs text-slate-400 font-medium select-none pointer-events-none",children:n}),c.length>0&&e.jsx("div",{className:"absolute bottom-2 left-2 z-10 flex items-center gap-2 flex-wrap max-w-[70%]",children:c.map((v,I)=>e.jsxs("div",{className:"group/att-badge flex items-center gap-1.5 px-2 py-1 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded text-[11px] font-medium text-slate-600 transition-all cursor-pointer select-none",onClick:()=>{if(v.type.startsWith("image/")){const j=window.open();j&&j.document.write(`<img src="${v.data}" style="max-width:100%; height:auto;" />`)}else try{const j=v.data.split(","),T=j[0].match(/:(.*?);/)[1],O=atob(j[1]);let V=O.length;const ge=new Uint8Array(V);for(;V--;)ge[V]=O.charCodeAt(V);const be=new Blob([ge],{type:T}),se=URL.createObjectURL(be);window.open(se,"_blank")}catch{const T=document.createElement("a");T.href=v.data,T.download=v.name,T.click()}},children:[v.type.startsWith("image/")?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-purple-500",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:"truncate max-w-[80px]",title:v.name,children:"Image"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-red-500",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("span",{className:"truncate max-w-[80px]",title:v.name,children:"PDF"})]}),e.jsx("button",{onClick:j=>{if(j.stopPropagation(),window.confirm("Remove attachment?")){let T=k,O=0;c.forEach((_e,Ae)=>{Ae!==I&&(T+=`
${_e.fullMatch}`,O++)});let V=n;k.trim().length>0||O>0||(V="");const be=V?`[${V}] ${T}`:T,se=[...s];se[a]=be,B({...m,notes:se.join(`

──────────────────────────
`)})}},className:"ml-1 p-0.5 hover:bg-slate-200 rounded-full text-slate-400 hover:text-red-500 opacity-0 group-hover/att-badge:opacity-100 transition-all",title:"Remove",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),v.type.startsWith("image/")&&e.jsx("div",{className:"absolute bottom-full left-0 mb-2 hidden group-hover/att-badge:block z-50 pointer-events-none",children:e.jsx("div",{className:"bg-white p-1 rounded-lg border border-slate-200 shadow-xl",children:e.jsx("img",{src:v.data,alt:"Preview",className:"max-w-[160px] max-h-[160px] rounded object-cover"})})})]},I))}),e.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-1",children:[e.jsxs("label",{className:"p-1 text-slate-400 hover:text-[#2D4485] hover:bg-blue-50 rounded cursor-pointer transition-all",title:"Attachment",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",className:"hidden",onChange:v=>{if(v.target.files&&v.target.files[0]){const I=v.target.files[0],j=new FileReader;j.onloadend=()=>{const T=j.result;let O=k;c.forEach(ke=>{O+=`
${ke.fullMatch}`});const V=I.name.replace(/:/g,"-"),be=`
<<Attachment:${I.type||"application/octet-stream"}:${V}:${T}>>`;O+=be;let se=n;se||(se=new Date().toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}));const _e=se?`[${se}] ${O}`:O,Ae=[...s];Ae[a]=_e,B({...m,notes:Ae.join(`

──────────────────────────
`)})},j.readAsDataURL(I)}}}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"})})]}),s.length>1&&e.jsx("button",{onClick:()=>{if(window.confirm("Delete this note section?")){const v=s.filter((I,j)=>j!==a);B({...m,notes:v.join(`

──────────────────────────
`)})}},className:"p-1 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded opacity-0 group-hover/note-box:opacity-100 transition-all",title:"Delete this note section",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]},a)})})]})})}),e.jsxs("div",{className:"px-4 py-3 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50/50",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>Oe(null),children:"Cancel"}),e.jsx("button",{className:"px-5 py-2 rounded-lg bg-orange-500 text-white hover:bg-orange-600 shadow-md transition-all text-sm font-medium",onClick:pa,children:"Save Changes"})]})]})})}),R&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-30 transition-opacity",onClick:()=>_(!1),children:e.jsx("div",{className:"absolute left-1/2 top-16 -translate-x-1/2 w-[640px] z-50 transition-all",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:"New Deal"}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600 transition-colors",onClick:()=>_(!1),children:"✕"})]}),e.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Sales Person"}),e.jsx("input",{type:"text",value:f.salesperson,onChange:t=>F({...f,salesperson:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Enter sales person name"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Company"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Company"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:f.company,onChange:t=>{F({...f,company:t.target.value}),re(!0)},onFocus:()=>re(!0),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Search or enter company name..."}),tt&&f.company&&e.jsxs("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg z-20 max-h-60 overflow-y-auto",children:[Me.filter(t=>t.name.toLowerCase().includes(f.company.toLowerCase())).map((t,a)=>e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-slate-700",onClick:()=>{F({...f,company:t.name,contact:t.contact,email:t.email||"",phone:t.phone||"",address:t.address||"",taxId:t.taxId||""}),re(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Contact: ",t.contact]})]},a)),f.company&&!Me.some(t=>t.name.toLowerCase()===f.company.toLowerCase())&&e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50 text-[#2D4485] font-medium",onClick:()=>{re(!1)},children:['+ Add "',f.company,'"']})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Opportunity"}),e.jsx("input",{value:f.opportunity,onChange:t=>F({...f,opportunity:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Deal opportunity name"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Contact"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Email"}),e.jsx("input",{value:f.email,onChange:t=>F({...f,email:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Phone"}),e.jsx("input",{value:f.phone,onChange:t=>F({...f,phone:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Phone number"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Address"}),e.jsx("input",{value:f.address,onChange:t=>F({...f,address:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Company address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Contact Person"}),e.jsx("input",{value:f.contact,onChange:t=>F({...f,contact:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Contact person"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Codes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Tax ID"}),e.jsx("input",{value:f.taxId,onChange:t=>F({...f,taxId:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Tax ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"PO Number"}),e.jsx("input",{value:f.poNumber,onChange:t=>F({...f,poNumber:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",placeholder:"Purchase Order Number"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Amount"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:f.currency}),e.jsx("input",{type:"number",value:f.amount,onChange:t=>F({...f,amount:Number(t.target.value)}),className:"w-full pl-10 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Currency"}),e.jsx("input",{value:f.currency,onChange:t=>F({...f,currency:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all text-center uppercase"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Priority"}),e.jsx("div",{className:"flex items-center gap-3",children:[1,2,3].map(t=>{const a=t===1?"low":t===2?"medium":"high",s=t===1?"Low":t===2?"Medium":"High",o=f.priority===a,r=t===1?"bg-[#2D4485]":t===2?"bg-orange-400":"bg-red-500";return e.jsxs("button",{className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${o?`${r} text-white border-transparent shadow-md transform scale-105`:"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,onClick:()=>F({...f,priority:o?"none":a}),children:[s," Priority"]},t)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Stage"}),e.jsx("select",{value:f.stageIndex,onChange:t=>F({...f,stageIndex:Number(t.target.value)}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all",children:u.map((t,a)=>e.jsx("option",{value:a,children:t.name},t.id))})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50/50",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 transition-colors font-medium text-sm",onClick:()=>_(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"px-5 py-2 rounded-lg bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-md transition-all text-sm font-medium",onClick:async()=>{var s,o;let t="";try{t=((s=u[f.stageIndex])==null?void 0:s.name)||((o=u[0])==null?void 0:o.name)||""}catch{}const a={title:f.opportunity||f.company||"Untitled",customer:null,amount:Number(f.amount)||0,currency:f.currency||"฿",po_number:f.poNumber||"",priority:f.priority||"none",contact:f.contact||"",email:f.email||"",phone:f.phone||"",address:f.address||"",tax_id:f.taxId||"",notes:"",stage:t,write_customer_name:f.company||"",salesperson:f.salesperson||null};(f.company||"").trim()&&(a.write_customer_name=f.company.trim());try{const r=localStorage.getItem("authToken"),n={"Content-Type":"application/json",...r?{Authorization:`Token ${r}`}:{}},i=await fetch(`${E}/deals/`,{method:"POST",headers:n,body:JSON.stringify(a)});if(i.ok){await g(),_(!1),F(ue);try{const l=String(t).toLowerCase(),c=l.includes("close")&&l.includes("won"),d=`CRM: Created "${a.title}" in ${t}`,N=c?`${d} — Create PO or Receive PO`:d;ie(N),St(N,c?"success":"info",a.customer||"","CRM")}catch{}}else{const l=await i.text();console.error("Failed to create deal:",l),ie("Failed to create deal: "+l)}}catch(r){console.error("Error creating deal",r),ie("Error creating deal: "+r.message)}},children:"Create Deal"})]})]})})}),Re&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity",onClick:()=>{De(null),$e(!1)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-slate-200 relative",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg",children:yt?"Email Configuration":"Send Email"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>{De(null),$e(!1)},className:"text-slate-400 hover:text-slate-600 transition-colors",children:"✕"})})]}),yt?e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-sm text-slate-600 bg-blue-50 p-3 rounded-lg border border-blue-100 mb-4",children:["To send emails directly from this app (without opening Outlook/Mail), you need a free account from ",e.jsx("a",{href:"https://www.emailjs.com/",target:"_blank",rel:"noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:"EmailJS.com"}),".",e.jsx("br",{}),e.jsx("br",{}),"1. Sign up & Create a Service (e.g. Gmail)",e.jsx("br",{}),"2. Create an Email Template",e.jsx("br",{}),"3. Copy your keys here:"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Service ID"}),e.jsx("input",{type:"text",value:je.serviceId,onChange:t=>Ve({...je,serviceId:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"service_..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Template ID"}),e.jsx("input",{type:"text",value:je.templateId,onChange:t=>Ve({...je,templateId:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"template_..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Public Key"}),e.jsx("input",{type:"text",value:je.publicKey,onChange:t=>Ve({...je,publicKey:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"User ID / Public Key"})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>wt(!1),className:"px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>qt(je),className:"px-4 py-2 text-sm font-medium text-white bg-[#2D4485] hover:bg-[#3D56A6] rounded-lg shadow-sm transition-all",children:"Save Configuration"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"To"}),e.jsx("input",{type:"email",value:Re.to,onChange:t=>De({...Re,to:t.target.value}),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Subject"}),e.jsx("input",{type:"text",value:bt,onChange:t=>We(t.target.value),className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"border border-slate-300 rounded-lg focus-within:ring-2 focus-within:ring-[#2D4485]/20 focus-within:border-[#2D4485] transition-all bg-white relative",children:[e.jsxs("div",{className:"flex flex-col border-b border-slate-200 bg-slate-50 select-none rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 p-2",children:[e.jsx("button",{onClick:Ct,className:`p-1.5 rounded transition-colors ${pe>0?"text-slate-500 hover:text-slate-700 hover:bg-slate-200":"text-slate-300 cursor-not-allowed"}`,title:"Undo (Ctrl+Z)",disabled:pe<=0,onMouseDown:t=>t.preventDefault(),children:e.jsx(os,{size:14})}),e.jsx("button",{onClick:rt,className:`p-1.5 rounded transition-colors ${pe<Le.length-1?"text-slate-500 hover:text-slate-700 hover:bg-slate-200":"text-slate-300 cursor-not-allowed"}`,title:"Redo (Ctrl+Y)",disabled:pe>=Le.length-1,onMouseDown:t=>t.preventDefault(),children:e.jsx(es,{size:14})})]}),st&&e.jsxs("div",{className:"flex items-center flex-wrap gap-2 p-2 border-t border-slate-200 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("select",{onChange:t=>ee("fontName",t.target.value),className:"h-7 text-xs border border-slate-300 rounded px-1 bg-white focus:outline-none focus:border-[#2D4485]",title:"Font Family",children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Verdana",children:"Verdana"})]}),e.jsxs("select",{onChange:t=>ee("fontSize",t.target.value),className:"h-7 text-xs border border-slate-300 rounded px-1 bg-white focus:outline-none focus:border-[#2D4485]",title:"Font Size",children:[e.jsx("option",{value:"3",children:"Normal"}),e.jsx("option",{value:"1",children:"Small"}),e.jsx("option",{value:"5",children:"Large"}),e.jsx("option",{value:"7",children:"Huge"})]}),e.jsx("div",{className:"w-px h-4 bg-slate-300 mx-1"}),e.jsx("button",{onClick:()=>ee("bold"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Bold",onMouseDown:t=>t.preventDefault(),children:e.jsx(Ja,{size:14})}),e.jsx("button",{onClick:()=>ee("italic"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Italic",onMouseDown:t=>t.preventDefault(),children:e.jsx(Ya,{size:14})}),e.jsx("button",{onClick:()=>ee("underline"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Underline",onMouseDown:t=>t.preventDefault(),children:e.jsx(ns,{size:14})}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded flex items-center gap-1",title:"Text Color",onMouseDown:t=>t.preventDefault(),children:[e.jsx(Ga,{size:14})," ",e.jsx(Bt,{size:10})]}),e.jsx("div",{className:"absolute top-full left-0 mt-1 p-2 bg-white border border-slate-200 rounded shadow-lg hidden group-hover:grid grid-cols-4 gap-1 z-50",children:["#000000","#444444","#888888","#ffffff","#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#6366f1","#a855f7","#ec4899"].map(t=>e.jsx("button",{onClick:()=>ee("foreColor",t),className:"w-4 h-4 rounded-full border border-slate-200",style:{backgroundColor:t},onMouseDown:a=>a.preventDefault()},t))})]}),e.jsx("div",{className:"w-px h-4 bg-slate-300 mx-1"}),e.jsx("button",{onClick:()=>ee("justifyLeft"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Align Left",onMouseDown:t=>t.preventDefault(),children:e.jsx(Ua,{size:14})}),e.jsx("button",{onClick:()=>ee("justifyCenter"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Align Center",onMouseDown:t=>t.preventDefault(),children:e.jsx(Wa,{size:14})}),e.jsx("button",{onClick:()=>ee("justifyRight"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Align Right",onMouseDown:t=>t.preventDefault(),children:e.jsx(Va,{size:14})}),e.jsx("div",{className:"w-px h-4 bg-slate-300 mx-1"}),e.jsx("button",{onClick:()=>ee("insertUnorderedList"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Bullet List",onMouseDown:t=>t.preventDefault(),children:e.jsx(Za,{size:14})}),e.jsx("button",{onClick:()=>ee("insertOrderedList"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Numbered List",onMouseDown:t=>t.preventDefault(),children:e.jsx(Xa,{size:14})}),e.jsx("button",{onClick:()=>ee("indent"),className:"p-1.5 text-slate-600 hover:bg-slate-200 rounded",title:"Indent",onMouseDown:t=>t.preventDefault(),children:e.jsx(qa,{size:14})})]})]}),e.jsxs("div",{className:"relative rounded-b-lg",children:[!Se&&e.jsx("div",{className:"absolute top-3 left-4 text-slate-400 text-sm pointer-events-none select-none",children:"Write email..."}),e.jsx("div",{ref:U,contentEditable:!0,className:"w-full px-4 py-3 text-sm outline-none min-h-[192px] max-h-[500px] overflow-y-auto block text-slate-700",onInput:t=>Be(t.currentTarget.innerHTML,!0),onClick:Xt,onScroll:()=>Ie(null),suppressContentEditableWarning:!0,onKeyDown:t=>{(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="z"?(t.preventDefault(),t.shiftKey?rt():Ct()):(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="y"&&(t.preventDefault(),rt())}}),Y&&e.jsxs("div",{className:"absolute z-50 bg-white border border-slate-300 shadow-lg rounded px-3 py-2 flex items-center gap-2 text-sm animate-in fade-in zoom-in-95 duration-150",style:{top:kt.top,left:kt.left},onMouseDown:t=>t.preventDefault(),children:[e.jsxs("a",{href:Y.href,target:"_blank",rel:"noopener noreferrer",className:"text-[#1a73e8] hover:underline whitespace-nowrap",children:["Go to link: ",Y.href.length>30?Y.href.substring(0,30)+"...":Y.href]}),e.jsx("div",{className:"w-px h-4 bg-slate-300 mx-1"}),e.jsx("button",{onClick:()=>{Ee({text:Y.textContent,url:Y.href}),Je(!0)},className:"text-[#1a73e8] hover:underline whitespace-nowrap",children:"Change"}),e.jsx("div",{className:"w-px h-4 bg-slate-300 mx-1"}),e.jsx("button",{onClick:()=>{const t=Y.parentNode;for(;Y.firstChild;)t.insertBefore(Y.firstChild,Y);t.removeChild(Y),Be(U.current.innerHTML,!0),Ie(null)},className:"text-[#1a73e8] hover:underline whitespace-nowrap",children:"Remove"})]})]})]}),Ne.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:Ne.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 border border-slate-200 rounded-lg px-3 py-1.5 text-sm text-slate-700 animate-in fade-in zoom-in duration-200 group",children:[e.jsx(ht,{size:14,className:"text-slate-400"}),e.jsx("a",{href:t.preview,target:"_blank",rel:"noopener noreferrer",className:"truncate max-w-[200px] hover:text-[#2D4485] hover:underline cursor-pointer",title:`View ${t.name}`,children:t.name}),e.jsxs("span",{className:"text-xs text-slate-500",children:["(",(t.size/1024).toFixed(1)," KB)"]}),e.jsx("button",{onClick:()=>Qt(a),className:"text-slate-400 hover:text-red-500 transition-colors ml-1",title:"Remove attachment",children:e.jsx($t,{size:14})})]},a))})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-100 bg-slate-50/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center shadow-sm relative z-10",children:e.jsx("button",{onClick:async()=>{if(!Re.to){ie("Please enter an email address");return}vt(!0);try{const t=new FormData;t.append("to_email",Re.to),t.append("subject",bt),t.append("message",Se),Ne&&Ne.length>0&&Ne.forEach(s=>{t.append("attachments",s)});const a=await fetch(`${fe}/api/send-email/`,{method:"POST",body:t});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to send email")}De(null),Ge([]),We(""),Te(""),gt(!0),setTimeout(()=>gt(!1),5e3)}catch(t){console.error("Email failed:",t),ie(`Failed to send: ${t.message}`)}finally{vt(!1)}},disabled:ft,className:"px-6 py-2 bg-[#1a73e8] hover:bg-[#1557b0] disabled:bg-slate-400 text-white text-sm font-bold rounded-full transition-colors flex items-center gap-2",children:ft?"Sending...":"Send"})}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("button",{onClick:()=>Gt(!st),className:`p-2 rounded-full transition-colors ${st?"bg-slate-200 text-slate-700":"text-slate-500 hover:text-slate-700 hover:bg-slate-200"}`,title:"Formatting Options",children:e.jsxs("div",{className:"flex items-baseline font-serif font-bold italic select-none",children:[e.jsx("span",{className:"text-lg",children:"A"}),e.jsx("span",{className:"text-sm",children:"a"})]})}),e.jsx("button",{onClick:()=>{var t;return(t=jt.current)==null?void 0:t.click()},className:"p-2 text-slate-500 hover:text-slate-700 hover:bg-slate-200 rounded-full transition-colors",title:"Attach File",children:e.jsx(ht,{size:20})}),e.jsx("input",{type:"file",ref:jt,className:"hidden",multiple:!0,onChange:Zt}),e.jsx("button",{onClick:Yt,className:`p-2 rounded-full transition-colors ${Nt?"bg-slate-200 text-slate-700":"text-slate-500 hover:text-slate-700 hover:bg-slate-200"}`,title:"Insert Link",children:e.jsx(Pt,{size:20})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>$e(!lt),className:`p-2 rounded-full transition-colors ${lt?"bg-red-100 text-red-600":"text-slate-400 hover:text-red-500 hover:bg-red-50"}`,title:"Discard Draft",children:e.jsx(ut,{size:18})}),lt&&e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 w-64 bg-white rounded-lg shadow-xl border border-slate-200 p-3 z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-800 mb-1",children:"Discard draft?"}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"This will clear all content and close the email editor."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>$e(!1),className:"px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100 rounded transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{De(null),We(""),Te(""),Ge([]),at([]),Pe(0),$e(!1)},className:"px-3 py-1.5 text-xs font-medium text-white bg-red-500 hover:bg-red-600 rounded transition-colors",children:"Discard"})]})]})]})]})]}),Nt&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-80 z-50 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-800 mb-3",children:"Insert Link"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Text to display"}),e.jsxs("div",{className:"flex items-center gap-2 border border-slate-300 rounded-md px-3 py-2 focus-within:ring-2 focus-within:ring-[#2D4485]/20 focus-within:border-[#2D4485] bg-slate-50",children:[e.jsx(_t,{size:14,className:"text-slate-400 shrink-0"}),e.jsx("input",{type:"text",placeholder:"Text",className:"text-sm outline-none w-full text-slate-700 bg-transparent placeholder:text-slate-400",value:ae.text,onChange:t=>Ee({...ae,text:t.target.value}),autoFocus:!0})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Link URL"}),e.jsxs("div",{className:"flex items-center gap-2 border border-slate-300 rounded-md px-3 py-2 focus-within:ring-2 focus-within:ring-[#2D4485]/20 focus-within:border-[#2D4485] bg-slate-50",children:[e.jsx(Pt,{size:14,className:"text-slate-400 shrink-0"}),e.jsx("input",{type:"text",placeholder:"https://example.com",className:"text-sm outline-none w-full text-slate-700 bg-transparent placeholder:text-slate-400",value:ae.url,onChange:t=>Ee({...ae,url:t.target.value}),onKeyDown:t=>{t.key==="Enter"&&Dt()}})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2 pt-2 border-t border-slate-100",children:[e.jsx("button",{onClick:()=>Je(!1),className:"px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Dt,className:"px-3 py-1.5 text-xs font-medium bg-[#2D4485] text-white rounded-md hover:bg-[#1a2e66] transition-colors shadow-sm",children:"Apply"})]})]})]})]})})]}):M==="Customers"?e.jsx("div",{className:"min-h-screen bg-white",children:e.jsx(ds,{deals:u.flatMap(t=>t.deals.map(a=>({...a,stageName:t.name,stageCount:t.deals.length}))).sort((t,a)=>(t.createdAt?new Date(t.createdAt).getTime():0)-(a.createdAt?new Date(a.createdAt).getTime():0)),onDeleteDeals:Ca})}):M==="Activities"?e.jsx("div",{className:"h-[calc(100vh-140px)] bg-white",children:e.jsx(ms,{deals:u.flatMap(t=>t.deals),onDeleteActivity:ia,onActivityUpdate:g})}):M==="History"?e.jsx("div",{className:"p-6 bg-slate-50 min-h-screen",children:e.jsx(us,{})}):e.jsx("div",{className:"p-6 text-slate-600",children:"Coming soon"}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>S(null),children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[360px]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-white",children:[e.jsx("div",{className:"px-4 py-3 border-b-2 border-white",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Confirm Delete"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"text-sm text-gray-800",children:C.type==="schedule"?"Delete this activity schedule?":((Rt=C==null?void 0:C.ids)==null?void 0:Rt.length)>1?`Delete ${C.ids.length} opportunities?`:"Delete this opportunity?"})}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>S(null),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700",onClick:Da,children:"Delete"})]})]})})}),Wt&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-[#323232] text-white px-6 py-3 rounded shadow-lg z-[100] flex items-center animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsx("span",{className:"text-sm font-medium",children:"Message sent"})}),e.jsx(Fa,{})]})}Sa.createRoot(document.getElementById("root")).render(e.jsx(p.StrictMode,{children:e.jsx(Aa,{children:e.jsx(hs,{})})}));
