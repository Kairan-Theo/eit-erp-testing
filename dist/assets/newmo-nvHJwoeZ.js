import{R as be,j as e,a as d,b as fe}from"./index-BHXMZ0-J.js";import{A as f,N as ye,f as se}from"./navigation-B0IDt7ps.js";import{J as ne}from"./job-order-template-CSuNXwgo.js";import{A as je}from"./arrow-left-COoKEq45.js";import{T as K}from"./trash-D7KEJc6k.js";import{P as we}from"./plus-BuoTYnGG.js";import{p as Ne,C as ve}from"./parseISO-BxmDVPrG.js";import{g as Se,D as Ce}from"./DayPicker-Cy1TBD3b.js";import"./addWeeks-yWatJi1q.js";function De(D,Y){if(!Array.isArray(D)||!D.length)return"";const b={};for(const v of D){const y=String(v.description||"").trim().toLowerCase();if(!y)continue;const x=Number(v.qty);!Number.isFinite(x)||x<=0||(b[y]=(b[y]||0)+x)}const O=Object.keys(b);if(!O.length)return"";for(const v of O){const y=Number(Y[v]||0),x=Number(b[v]||0);if(console.debug(`[Status Check] Item: "${v}", Required: ${x}, Available: ${y}`),!Number.isFinite(y)||x>=y)return console.debug(`[Status Check] -> Not Available (Insufficient: ${y} <= ${x})`),"Not Available"}return"Available"}function ke(){const[D,Y]=d.useState({}),[b,O]=d.useState([]),[v,y]=d.useState([]),[x,_e]=d.useState(()=>{try{return!!new URLSearchParams(window.location.search).get("mfgId")}catch{return!1}}),[Pe,oe]=d.useState([]),[ie,Z]=d.useState([]),[F,ae]=d.useState([]),[le,$]=d.useState(!1),[z,k]=d.useState(!1),W=d.useRef(null),[t,m]=d.useState({product:"",productNo:"",jobOrderCode:"",purchaseOrder:"",quantity:1,scheduledDate:"",completedDate:"",productionTime:"",responsible:"",priority:"None",customer:"",responsibleSalesPerson:"",responsibleProductionPerson:"",supplier:"",supplierDate:"",recipient:"",recipientDate:"",poFile:null,poFileName:""}),[B,S]=d.useState([]),[_,P]=d.useState(!1),[A,G]=d.useState(null),[L,V]=d.useState(null),[X,J]=d.useState(.5),[M,de]=d.useState("portrait"),I=d.useRef(null),q=d.useMemo(()=>t.poFile?URL.createObjectURL(t.poFile):null,[t.poFile]);d.useEffect(()=>()=>{q&&URL.revokeObjectURL(q)},[q]);const ee=d.useCallback(r=>{V(r)},[]),H=d.useCallback(()=>{const r=String(t.productNo||"").trim().toLowerCase();if(!r)return S([]),!1;try{if(!Array.isArray(b)||!b.length)return;const o=b.find(a=>String(a.product||"").trim().toLowerCase()===r);if(!o)return!1;const s=o.productTree,n=(s&&!Array.isArray(s)?s.systems||[]:Array.isArray(s)?s:[]).flatMap(a=>(a.components||[]).map(c=>({itemCode:"",description:String(c.name||"").trim(),qty:String(Number(c.qty)||1),unit:"Unit"})));return n.length?(S(n.map((a,c)=>({...a,itemCode:a.itemCode||String(c+1)}))),!0):!1}catch{return!1}},[t.productNo,b]);d.useEffect(()=>{if(x)return;String(t.productNo||"").trim()?_||H():_||S([])},[t.productNo,_,x]),d.useEffect(()=>{if(!z)return;const r=o=>{const s=W.current;s&&!s.contains(o.target)&&k(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[z]);const[ce,C]=d.useState(!1);d.useEffect(()=>{const r=()=>{document.visibilityState==="visible"&&!x&&!_&&H()};return document.addEventListener("visibilitychange",r),()=>document.removeEventListener("visibilitychange",r)},[_,H,x]);function T({value:r,onChange:o,placeholder:s="DD/MM/YYYY"}){const[l,n]=d.useState(!1),a=d.useRef(null),c=Se(),i=(()=>{try{return r?Ne(r):void 0}catch{return}})(),g=(()=>{try{return i?se(i,"dd/MM/yyyy"):""}catch{return""}})();return d.useEffect(()=>{if(!l)return;const u=j=>{const R=a.current;R&&!R.contains(j.target)&&n(!1)},h=j=>{j.key==="Escape"&&n(!1)};return document.addEventListener("mousedown",u),document.addEventListener("touchstart",u,{passive:!0}),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("touchstart",u),document.removeEventListener("keydown",h)}},[l]),e.jsxs("div",{ref:a,className:"relative inline-block w-full",children:[e.jsx("input",{type:"text",value:g,placeholder:s,onClick:()=>n(u=>!u),readOnly:!0,className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"}),e.jsx("button",{type:"button",onClick:()=>n(u=>!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700","aria-label":"Open calendar",children:e.jsx(ve,{className:"size-4","aria-hidden":"true"})}),l&&e.jsx("div",{onMouseDown:u=>u.stopPropagation(),className:"absolute left-1/2 -translate-x-1/2 top-[calc(100%+8px)] z-50 bg-white border border-slate-200 rounded-[22px] shadow-xl p-4 w-[340px]",children:e.jsx(Ce,{mode:"single",selected:i,onSelect:u=>{if(!u)return;const h=se(u,"yyyy-MM-dd");o(h)},captionLayout:"buttons",classNames:{root:`w-fit ${c.root}`,months:`flex flex-col ${c.months}`,month:`rounded-2xl pt-8 ${c.month}`,caption:`relative h-8 ${c.caption}`,nav:`absolute left-3 right-3 top-0 flex items-center justify-between ${c.nav}`,nav_button:`p-2 rounded-full hover:bg-slate-100 ${c.nav_button}`,nav_button_previous:`${c.nav_button_previous}`,nav_button_next:`${c.nav_button_next}`,caption_label:`absolute left-1/2 -translate-x-1/2 top-0 h-8 leading-8 text-center font-semibold uppercase tracking-wide text-[#2D4485] ${c.caption_label}`,table:"w-full border-collapse",weekdays:`flex justify-between border-b border-slate-200 pb-2 ${c.weekdays}`,weekday:`text-slate-500 flex-1 text-sm text-center ${c.weekday}`,week:`grid grid-cols-7 mt-2 ${c.week}`,day:`mx-auto size-10 flex items-center justify-center rounded-full hover:bg-blue-50 ${c.day}`,today:`bg-[#D6E4FF] text-[#2D4485] font-semibold ${c.today}`,outside:`text-slate-400 ${c.outside}`,disabled:`${c.disabled}`},modifiersClassNames:{selected:"border-2 border-[#2D4485]/30 !bg-transparent text-[#2D4485] font-semibold"}})})]})}d.useEffect(()=>{const r=()=>{V(null)};return window.addEventListener("afterprint",r),()=>{window.removeEventListener("afterprint",r)}},[]),d.useEffect(()=>{L&&setTimeout(()=>window.print(),500)},[L]),d.useEffect(()=>{(async()=>{try{const r=localStorage.getItem("authToken"),o=r?{Authorization:`Token ${r}`}:{},s=await fetch(`${f}/api/manufacturing_orders/`,{headers:o});if(!s.ok)return;const l=await s.json(),n=(Array.isArray(l)?l:[]).map(c=>String(c.job_order_code||"").trim()).filter(Boolean),a=Array.isArray(l)?l:[];if(oe(n),y(a),window.__remoteManufacturingOrders=a,!x){const c=n.map(u=>{const h=u.match(/^JO[-/ ]?(\d{1,5})$/i);return h?parseInt(h[1],10):null}).filter(u=>Number.isFinite(u)),i=c.length?Math.max(...c)+1:1,g=`JO-${String(i).padStart(3,"0")}`;m(u=>({...u,jobOrderCode:g}))}}catch{if(!x){const r=`JO-${String(1).padStart(3,"0")}`;m(o=>({...o,jobOrderCode:r}))}}})()},[x]),d.useEffect(()=>{try{const o=new URLSearchParams(window.location.search).get("mfgId");o&&(async()=>{try{const s=localStorage.getItem("authToken"),l=s?{Authorization:`Token ${s}`}:{},n=await fetch(`${f}/api/manufacturing_orders/${o}/`,{headers:l});if(!n.ok)return;const a=await n.json();m(i=>({...i,jobOrderCode:a.job_order_code||i.jobOrderCode,purchaseOrder:a.po_number||i.purchaseOrder,customer:a.customer_name||i.customer,productNo:a.product_no||i.productNo,quantity:Number(a.quantity)||i.quantity,scheduledDate:a.start_date||i.scheduledDate,completedDate:a.complete_date||i.completedDate,productionTime:a.production_time||i.productionTime,responsibleSalesPerson:a.responsible_sales_person||i.responsibleSalesPerson,responsibleProductionPerson:a.responsible_production_person||i.responsibleProductionPerson,supplier:a.supplier||i.supplier,supplierDate:a.supplier_date||i.supplierDate,recipient:a.recipient||i.recipient,recipientDate:a.recipient_date||i.recipientDate,poFileName:a.po_file_name||i.poFileName}));const c=Array.isArray(a.items)?a.items.map(i=>({itemCode:String(i.item??i.itemCode??"").trim(),description:String(i.item_description??i.description??"").trim(),qty:String(i.item_quantity??i.qty??""),unit:String(i.item_unit??i.unit??"Unit")})):[];c.length&&(S(c.map((i,g)=>({...i,itemCode:i.itemCode||String(g+1)}))),P(!0))}catch{}})()}catch{}},[]),d.useEffect(()=>{const r=localStorage.getItem("authToken"),o=r?{Authorization:`Token ${r}`}:{};fetch(`${f}/api/component_entries/`,{headers:o}).then(s=>s.json()).then(s=>{const l={};for(const n of Array.isArray(s)?s:[]){const a=String(n.component_name||"").trim().toLowerCase();a&&(l[a]=(l[a]||0)+(Number(n.quantity)||0))}Y(l)}).catch(console.error),O([]),(async()=>{try{const s=localStorage.getItem("authToken"),l=s?{Authorization:`Token ${s}`}:{},n=await fetch(`${f}/api/deals/`,{headers:l});let a=[];n.ok&&(a=(await n.json()||[]).map(g=>String(g.po_number||"").trim()).filter(Boolean));const c=await fetch(`${f}/api/customer_purchase_orders/`,{headers:l});if(c.ok){const i=await c.json();ae(i||[]);const g=(i||[]).map(h=>String(h.po_number||"").trim()).filter(Boolean),u=Array.from(new Set([...a,...g]));Z(u)}else{const i=Array.from(new Set(a));Z(i)}}catch(s){console.error("Error fetching PO numbers:",s)}})()},[]);const ue=d.useCallback(r=>{const o=String(r||"").trim();let s={...t,purchaseOrder:o};const l=F.find(n=>String(n.po_number||"").trim().toLowerCase()===o.toLowerCase());if(l&&l.po_file_name){const n=`${f}/api/customer_purchase_orders/${l.id}/download/`;s={...s,poFileName:l.po_file_name,poFile:null,linkedCpoId:l.id,linkedCpoFileUrl:n}}else s={...s,linkedCpoId:null,linkedCpoFileUrl:null},(l||t.linkedCpoFileUrl)&&(s.poFileName="",s.poFile=null);m(s),$(!1)},[t,F]),te=async()=>{var c,i,g;const r=localStorage.getItem("authToken"),o={};if(r&&(o.Authorization=`Token ${r}`),t.poFile&&t.poFile.size/1048576>8)return alert("File size exceeds 8 MB. Please upload a smaller file."),null;const s=B.map((u,h)=>({...u,itemCode:u.itemCode||String(h+1)})),l=De(s,D),n=new FormData;n.append("job_order_code",String(t.jobOrderCode||"").trim()),n.append("po_number",String(t.purchaseOrder||"").trim()),n.append("write_customer_name",String(t.customer||"").trim()),n.append("product",String(t.product||"").trim()),n.append("product_no",String(t.productNo||"").trim()),n.append("quantity",String(Number(t.quantity)||1)),t.scheduledDate&&n.append("start_date",t.scheduledDate),t.completedDate&&n.append("complete_date",t.completedDate),n.append("production_time",String(t.productionTime||"").trim()),n.append("responsible_sales_person",String(t.responsibleSalesPerson||"").trim()),n.append("responsible_production_person",String(t.responsibleProductionPerson||"").trim()),n.append("supplier",String(t.supplier||"").trim()),t.supplierDate&&n.append("supplier_date",t.supplierDate),n.append("recipient",String(t.recipient||"").trim()),t.recipientDate&&n.append("recipient_date",t.recipientDate);const a=s.map(u=>({item:String(u.itemCode||"").trim(),item_description:String(u.description||"").trim(),item_quantity:String(u.qty||"").trim(),item_unit:String(u.unit||"Unit").trim()}));n.append("items",JSON.stringify(a)),n.append("item_description",String(((c=s[0])==null?void 0:c.description)||"").trim()),n.append("item_quantity",String(((i=s[0])==null?void 0:i.qty)||"").trim()),n.append("item_unit",String(((g=s[0])==null?void 0:g.unit)||"Unit").trim()),n.append("component_status",l),t.poFile&&n.append("po_file",t.poFile),t.linkedCpoId&&n.append("linked_cpo_id",String(t.linkedCpoId)),n.append("po_file_name",String(t.poFileName||""));try{let j=new URLSearchParams(window.location.search).get("mfgId");if(!j&&t.jobOrderCode)try{const w=await fetch(`${f}/api/manufacturing_orders/`,{headers:o});if(w.ok){const Q=await w.json(),re=(Array.isArray(Q)?Q:[]).find(ge=>String(ge.job_order_code||"").trim()===String(t.jobOrderCode||"").trim());re&&(j=String(re.id||""))}}catch{}const R=j?`${f}/api/manufacturing_orders/${j}/`:`${f}/api/manufacturing_orders/`,U=await fetch(R,{method:j?"PATCH":"POST",headers:o,body:n});if(!U.ok){const w=await U.json().catch(()=>({}));throw new Error(typeof w=="object"&&w?JSON.stringify(w):`HTTP ${U.status}`)}const p=await U.json().catch(()=>null);if(p){const w=Array.isArray(p.items)?p.items.map(N=>({itemCode:String(N.item??N.itemCode??"").trim(),description:String(N.item_description??N.description??"").trim(),qty:String(N.item_quantity??N.qty??""),unit:String(N.item_unit??N.unit??"Unit")})):s;return{jobOrderCode:p.job_order_code||t.jobOrderCode,productNo:p.product_no||t.productNo,customer:p.customer_name||t.customer,start:p.start_date||t.scheduledDate,completedDate:p.complete_date||t.completedDate,totalQuantity:Number(p.quantity)||Number(t.quantity)||1,quantity:Number(p.quantity)||Number(t.quantity)||1,productionTime:p.production_time||t.productionTime,supplier:p.supplier||t.supplier,supplierDate:p.supplier_date||t.supplierDate,recipient:p.recipient||t.recipient,recipientDate:p.recipient_date||t.recipientDate,items:w,responsible:[String(p.responsible_sales_person||"").trim(),String(p.responsible_production_person||"").trim()].filter(Boolean).join(" / "),responsibleSales:String(p.responsible_sales_person||"").trim(),responsibleProduction:String(p.responsible_production_person||"").trim()}}else return{jobOrderCode:t.jobOrderCode,productNo:t.productNo,customer:t.customer,start:t.scheduledDate,completedDate:t.completedDate,totalQuantity:Number(t.quantity)||1,quantity:Number(t.quantity)||1,productionTime:t.productionTime,supplier:t.supplier,supplierDate:t.supplierDate,recipient:t.recipient,recipientDate:t.recipientDate,items:s,responsible:[String(t.responsibleSalesPerson||"").trim(),String(t.responsibleProductionPerson||"").trim()].filter(Boolean).join(" / "),responsibleSales:String(t.responsibleSalesPerson||"").trim(),responsibleProduction:String(t.responsibleProductionPerson||"").trim()}}catch(u){const h=(u==null?void 0:u.message)||"Unknown error";return h.includes("Invalid token")||h.includes("HTTP 401")||h.includes("HTTP 403")?(alert("Your session has expired. Please log in again."),localStorage.removeItem("authToken"),window.location.href="/login.html",null):(alert("Failed to create Manufacturing Order: "+h),null)}},me=async()=>{const r=await te();r&&ee(r)},pe=async()=>{await te()&&(C(!1),window.location.href="/manufacturing.html")},he=()=>{S(r=>[...r,{itemCode:String(r.length+1),description:"",qty:"1",unit:"Unit"}]),P(!0)},xe=r=>{S(o=>o.filter((s,l)=>l!==r).map((s,l)=>({...s,itemCode:s.itemCode||String(l+1)}))),P(!0)},E=(r,o,s)=>{S(l=>l.map((n,a)=>a===r?{...n,[o]:s}:n)),P(!0)};return e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(ye,{}),e.jsx("section",{className:"w-full py-8 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>window.location.href="/manufacturing.html",className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors",title:"Back to List",children:e.jsx(je,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Manufacturing Order"})]})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-2",children:"Codes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Job Order Code"}),e.jsx("input",{value:t.jobOrderCode,onChange:r=>m({...t,jobOrderCode:r.target.value}),placeholder:"e.g. JO-001",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"PO Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:t.purchaseOrder,onChange:r=>{m({...t,purchaseOrder:r.target.value}),$(!0)},onFocus:()=>$(!0),onKeyDown:r=>{r.key==="Escape"&&$(!1)},placeholder:"e.g. PO-1234",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),le&&(()=>{const r=(t.purchaseOrder||"").toLowerCase(),o=Array.from(new Set([...v.map(s=>String(s.po_number||"").trim()).filter(Boolean),...ie])).filter(s=>s.toLowerCase().includes(r)).slice(0,8);return o.length?e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto",children:o.map((s,l)=>e.jsx("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-gray-700",onClick:()=>ue(s),children:s},`${s}-${l}`))}):null})()]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-2",children:"Customer"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Company"}),e.jsx("input",{value:t.customer,onChange:r=>m({...t,customer:r.target.value}),placeholder:"Company name",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"PO File"}),e.jsxs("div",{className:"flex items-center gap-3 h-[42px]",children:[e.jsx("input",{type:"file",ref:I,className:"hidden",accept:".pdf,.xls,.xlsx",onChange:r=>{r.target.files&&r.target.files[0]&&m({...t,poFile:r.target.files[0]})}}),e.jsx("button",{onClick:()=>I.current.click(),className:"px-3 py-1.5 bg-gray-100 border border-gray-300 rounded text-xs font-medium text-gray-700 hover:bg-gray-200",children:"Choose File"}),t.poFile?e.jsxs("div",{className:"flex items-center gap-2 max-w-[calc(100%-120px)]",children:[e.jsx("a",{href:q,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm underline hover:text-blue-800 truncate",children:t.poFile.name}),e.jsx("button",{type:"button",onClick:()=>{m({...t,poFile:null}),I.current&&(I.current.value="")},className:"text-red-500 hover:text-red-700 shrink-0",title:"Remove file",children:e.jsx(K,{className:"w-4 h-4"})})]}):t.poFileName?e.jsxs("div",{className:"flex items-center gap-2 max-w-[calc(100%-120px)]",children:[(()=>{const o=new URLSearchParams(window.location.search).get("mfgId");if(t.linkedCpoFileUrl)return e.jsx("a",{href:t.linkedCpoFileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm underline hover:text-blue-800 truncate",children:t.poFileName});if(t.purchaseOrder&&t.poFileName&&F.length>0){const s=F.find(l=>String(l.po_number||"").trim().toLowerCase()===String(t.purchaseOrder).trim().toLowerCase());if(s&&s.po_file_name)return e.jsx("a",{href:`${f}/api/customer_purchase_orders/${s.id}/download/`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm underline hover:text-blue-800 truncate",children:t.poFileName})}return o?e.jsx("a",{href:`${f}/api/manufacturing_orders/${o}/download/`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm underline hover:text-blue-800 truncate",children:t.poFileName}):e.jsx("span",{className:"text-sm text-gray-700 truncate",children:t.poFileName})})(),e.jsx("button",{type:"button",onClick:()=>m({...t,poFileName:"",poFile:null,linkedCpoId:null,linkedCpoFileUrl:null}),className:"text-red-500 hover:text-red-700 shrink-0",title:"Remove file",children:e.jsx(K,{className:"w-4 h-4"})})]}):e.jsx("span",{className:"text-sm text-gray-400 italic",children:"No file chosen"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-2",children:"Product"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Product No"}),e.jsxs("div",{className:"relative",ref:W,children:[e.jsx("input",{value:t.productNo,onChange:r=>{m({...t,productNo:r.target.value}),k(!0)},onFocus:()=>k(!0),onKeyDown:r=>{r.key==="Escape"&&k(!1)},placeholder:"e.g. LCM-001",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),z&&String(t.productNo||"").trim()&&(()=>{const r=String(t.productNo||"").trim().toLowerCase(),o=Array.from(new Set((Array.isArray(b)?b:[]).map(s=>String((s==null?void 0:s.product)||"").trim()).filter(Boolean))).filter(s=>s.toLowerCase().includes(r)).slice(0,8);return o.length?e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto",children:o.map((s,l)=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-gray-700",onClick:()=>{m({...t,productNo:s}),S([]),P(!1),k(!1)},children:s},`${s}-${l}`))}):null})()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Order Quantity"}),e.jsx("input",{value:t.quantity,onChange:r=>m({...t,quantity:r.target.value}),placeholder:"1",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-2",children:"Date"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Start Date"}),e.jsx(T,{value:t.scheduledDate,onChange:r=>m({...t,scheduledDate:r}),placeholder:"DD/MM/YYYY"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Complete Date"}),e.jsx(T,{value:t.completedDate,onChange:r=>m({...t,completedDate:r}),placeholder:"DD/MM/YYYY"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Time of Production"}),e.jsx("input",{value:t.productionTime,onChange:r=>m({...t,productionTime:r.target.value}),placeholder:"e.g. 2 weeks",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-2",children:"Responsible Person"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Responsible Sales Person"}),e.jsx("input",{value:t.responsibleSalesPerson,onChange:r=>m({...t,responsibleSalesPerson:r.target.value}),placeholder:"Sales person",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Responsible Production Person"}),e.jsx("input",{value:t.responsibleProductionPerson,onChange:r=>m({...t,responsibleProductionPerson:r.target.value}),placeholder:"Production lead",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide mb-2",children:"Supplier & Recipient"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Supplier"}),e.jsx("input",{value:t.supplier,onChange:r=>m({...t,supplier:r.target.value}),placeholder:"Supplier company/person",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Supplier Date"}),e.jsx(T,{value:t.supplierDate,onChange:r=>m({...t,supplierDate:r}),placeholder:"DD/MM/YYYY"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Recipient"}),e.jsx("input",{value:t.recipient,onChange:r=>m({...t,recipient:r.target.value}),placeholder:"Recipient name",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"Recipient Date"}),e.jsx(T,{value:t.recipientDate,onChange:r=>m({...t,recipientDate:r}),placeholder:"DD/MM/YYYY"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-bold text-blue-900 uppercase tracking-wide",children:"Items Description"}),e.jsxs("button",{onClick:he,className:"inline-flex items-center gap-2 rounded-full px-4 py-2 bg-[#2D4485]/10 text-[#2D4485] hover:bg-[#2D4485]/15",children:[e.jsx(we,{className:"size-4","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium",children:"Add Item"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b",children:"Item Code"}),e.jsx("th",{className:"p-3 border-b",children:"Description"}),e.jsx("th",{className:"p-3 border-b",children:"Quantity"}),e.jsx("th",{className:"p-3 border-b",children:"Unit"}),e.jsx("th",{className:"p-3 border-b w-12"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[B.map((r,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition border-b border-gray-100",children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{value:r.itemCode,onChange:s=>E(o,"itemCode",s.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Code"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:r.description,onChange:s=>E(o,"description",s.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Item description"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:r.qty,onChange:s=>E(o,"qty",s.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"1"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:r.unit,onChange:s=>E(o,"unit",s.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Unit"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>xe(o),className:"text-red-600 hover:text-red-800",title:"Delete","aria-label":"Delete item",children:e.jsx(K,{className:"w-4 h-4"})})})]},o)),B.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-6 text-center text-gray-400",children:"No items"})})]})]})})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10",onClick:()=>window.location.href="/manufacturing.html",children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:()=>C(!0),children:"Create MO Form"})]})]})}),ce&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>C(!1),children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[560px] max-w-[95vw]",onClick:r=>r.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Create MO Form"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Choose how you want to proceed"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>C(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 grid grid-cols-3 gap-4",children:[e.jsx("button",{className:"w-full px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",onClick:()=>{C(!1),window.location.href="/manufacturing.html"},children:"Discard"}),e.jsx("button",{className:"w-full px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6] min-w-[140px]",onClick:pe,children:"Save Changes"}),e.jsx("button",{className:"w-full px-4 py-2 rounded-md text-[#2D4485] underline underline-offset-2 hover:text-[#3D56A6] min-w-[140px] whitespace-nowrap text-center",onClick:async()=>{C(!1),await me()},children:"Download Form"})]})]})})}),L&&fe.createPortal(e.jsxs("div",{className:"print-portal",children:[e.jsx("style",{children:`
              @media print {
                .print-portal {
                  display: block !important;
                }
              }
              .print-portal { display: none; }
            `}),e.jsx(ne,{order:L})]}),document.body),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>G(null),children:e.jsx("div",{className:"absolute inset-0 flex items-start justify-center",onClick:r=>r.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 mt-6",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Job Order Preview"}),e.jsxs("span",{className:"text-gray-500",children:["#",A.jobOrderCode||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>J(r=>Math.max(.4,Math.round((r-.1)*10)/10)),children:"-"}),e.jsxs("span",{className:"text-sm text-gray-700 w-14 text-center",children:[Math.round(X*100),"%"]}),e.jsx("button",{className:"px-2 py-1 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>J(r=>Math.min(2,Math.round((r+.1)*10)/10)),children:"+"}),e.jsx("button",{className:"px-2 py-1 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>J(1),children:"Reset"}),e.jsxs("select",{value:M,onChange:r=>de(r.target.value),className:"px-2 py-1 rounded-md border border-gray-300 text-gray-700",children:[e.jsx("option",{value:"portrait",children:"Portrait"}),e.jsx("option",{value:"landscape",children:"Landscape"})]})]}),e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>ee(A),children:"Print"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>G(null),children:"✕"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("style",{children:`@media print { @page { size: A4 ${M}; margin: 0 } }`}),(()=>{const r=M==="portrait"?794:1123,o=M==="portrait"?1123:794,s=Math.max(600,window.innerHeight-220),l=Math.min(1,s/o),n=Math.max(.4,Math.min(2,X||l));return e.jsx("div",{style:{width:r*n,height:o*n,margin:"0 auto",overflow:"hidden"},children:e.jsx("div",{style:{width:r,height:o,transform:`scale(${n})`,transformOrigin:"top left"},children:e.jsx(ne,{order:A})})})})()]})]})})})]})}be.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(ke,{})}));
