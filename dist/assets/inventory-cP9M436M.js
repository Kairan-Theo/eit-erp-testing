import{R as je,j as e,a as o}from"./index-BHXMZ0-J.js";import{N as we}from"./navigation-B0IDt7ps.js";const X=(t,i)=>{if(!i)return null;if(String(i).startsWith("http"))return i;switch(t){case"Kerry":return`https://th.kerryexpress.com/th/track/?track=${i}`;case"Flash":return`https://www.flashexpress.co.th/tracking/?se=${i}`;case"ThaiPost":return`https://track.thailandpost.co.th/?trackNumber=${i}`;case"J&T":return`https://www.jtexpress.co.th/tracking?billcode=${i}`;case"DHL":return`https://www.dhl.com/th-en/home/tracking.html?tracking-id=${i}`;case"SCG":return`https://www.scgexpress.co.th/tracking/detail/${i}`;case"NinjaVan":return`https://www.ninjavan.co/th-th/tracking?id=${i}`;case"Best":return`https://www.best-inc.co.th/track?billcode=${i}`;case"Lazada":return`https://tracker.lel.asia/tracker?trackingNumber=${i}`;case"Shopee":return"https://spx.co.th/";case"Nim":return`https://www.nimexpress.com/web/p/tracking?i=${i}`;default:return`https://t.17track.net/en#nums=${i}`}},V=(t,i,c)=>c&&String(c).trim()?String(c).trim():X(t,i)||"";function ve(){const[t,i]=o.useState(""),[c,h]=o.useState("updatedAt"),[m,b]=o.useState("desc"),[x,f]=o.useState([]),[N,d]=o.useState(!1),[A,p]=o.useState(null),[U,M]=o.useState(null),[F,T]=o.useState(null),[B,P]=o.useState(null),[O,R]=o.useState(null),[j,L]=o.useState("Inventory Admin"),[E,W]=o.useState(""),[a,r]=o.useState("All"),[k,Q]=o.useState(null),[g,v]=o.useState("inventory"),[_,ne]=o.useState(null),[le,Z]=o.useState([]),H=s=>{f(s);try{localStorage.setItem("inventoryProducts",JSON.stringify(s))}catch{}},oe=s=>{const n=/^WH\/IV\/(\d+)$/.exec(String(s||""));return n?parseInt(n[1],10):null},q=(s=x)=>{let n=0;for(const y of s){const u=oe(y.sku);Number.isFinite(u)&&u>n&&(n=u)}return n+1};o.useEffect(()=>{try{const s=JSON.parse(localStorage.getItem("inventoryProducts")||"[]");if(Array.isArray(s)&&s.length){const n=s.map(l=>({sku:String(l.sku||""),name:l.name,stockQty:Number(l.stockQty||0),price:Number(l.price||0),updatedAt:l.updatedAt||new Date().toISOString().slice(0,10),instock:Number(l.instock||0),warehouse:l.warehouse||"Main",bin:l.bin||"A-01-01",lot:l.lot||"",expiry:l.expiry||"",reserved:Number(l.reserved||0),incomingQty:Number(l.incomingQty||0),outgoingQty:Number(l.outgoingQty||0),barcode:l.barcode||"",category:l.category||"Finished Goods",uom:l.uom||"pcs",description:l.description||"",brand:l.brand||"",model:l.model||"",status:l.status||"Active",minStock:Number(l.minStock||0),reorderQty:Number(l.reorderQty||0),valuationMethod:l.valuationMethod||"FIFO",serials:Array.isArray(l.serials)?l.serials:[],manufactureDate:l.manufactureDate||"",deliveryStatus:l.deliveryStatus||"",deliveryCompany:l.deliveryCompany||"",trackingNumber:l.trackingNumber||"",courier:l.courier||"",trackingUrl:l.trackingUrl||"",trackingStatus:l.trackingStatus||""}));let y=q(n);const u=n.map(l=>{const S=/^WH\/IV\/\d+$/.test(String(l.sku||""))?l:{...l,sku:`WH/IV/${y++}`},C=V(S.courier,S.trackingNumber,S.trackingUrl);return{...S,trackingUrl:C}});f(u);try{localStorage.setItem("inventoryProducts",JSON.stringify(u))}catch{}}else f([{sku:"WH/IV/1",name:"Simatic S7-1500",stockQty:15e3,price:12e4,updatedAt:"2021-02-20",instock:1,warehouse:"Main",bin:"A-01-01",lot:"L210201",expiry:"2023-12-31",reserved:0,incomingQty:0,outgoingQty:0,barcode:"1234567890123",category:"Finished Goods",uom:"pcs",description:"",brand:"Siemens",model:"S7-1500",status:"Active",minStock:1e3,reorderQty:500,valuationMethod:"FIFO",serials:[],manufactureDate:"",trackingNumber:"",courier:"",trackingUrl:""}])}catch{f([])}},[]);const ie=o.useMemo(()=>{const s=new Set(x.map(n=>n.warehouse||"Main"));return["All",...Array.from(s)]},[x]),ce=o.useMemo(()=>{const s=new Set(x.map(n=>n.category||"Finished Goods"));return["All",...Array.from(s)]},[x]),de=[...x.filter(s=>(s.name||"").toLowerCase().includes(t.toLowerCase())).filter(s=>E?(s.sku||"").toLowerCase().includes(E.toLowerCase()):!0).filter(s=>a==="All"?!0:(s.category||"Finished Goods")===a)].sort((s,n)=>{const y=s[c],u=n[c];return typeof y=="number"&&typeof u=="number"?m==="asc"?y-u:u-y:m==="asc"?String(y).localeCompare(String(u)):String(u).localeCompare(String(y))}),ue=s=>{c===s?b(n=>n==="asc"?"desc":"asc"):(h(s),b("asc"))},me=(s,n=!1)=>{const y=String(s.sku||""),l=/^WH\/IV\/\d+$/.test(y)?y:`WH/IV/${q()}`,w=V(s.courier,s.trackingNumber,s.trackingUrl),S=[{...s,sku:l,stockQty:Number(s.stockQty||0),price:Number(s.price||0),reserved:Number(s.reserved||0),incomingQty:Number(s.incomingQty||0),outgoingQty:Number(s.outgoingQty||0),minStock:Number(s.minStock||0),reorderQty:Number(s.reorderQty||0),updatedAt:s.updatedAt||new Date().toISOString().slice(0,10),instock:s.instock||1,trackingUrl:w},...x];H(S),n||d(!1)},K=s=>{try{const n=JSON.parse(localStorage.getItem("inventoryMovements")||"[]"),y=Array.isArray(n)?n:[];y.push({...s,id:s.id||Date.now().toString(36)+Math.random().toString(36).substr(2),ts:new Date().toISOString(),user:j}),localStorage.setItem("inventoryMovements",JSON.stringify(y))}catch{}},xe=(s,n,y,u,l,w,S)=>{const C=x.map(I=>{if(!(I.sku===s&&(I.warehouse||"Main")===(n||"Main")&&(I.bin||"A-01-01")===(y||"A-01-01")&&(I.lot||"")===(u||"")))return I;const J=Math.max(0,Number(l||0));return{...I,stockQty:J,status:J>0?"Active":"Inactive",updatedAt:new Date().toISOString().slice(0,10)}});H(C);const $=x.find(I=>I.sku===s&&(I.warehouse||"Main")===(n||"Main")&&(I.bin||"A-01-01")===(y||"A-01-01")&&(I.lot||"")===(u||"")),z=$?Number($.stockQty||0):0,G=Math.max(0,Number(l||0));K({type:"adjustment",sku:s,warehouse:n||"Main",bin:y||"A-01-01",lot:u||"",delta:G-z,newQty:G,reason:w,ref:S}),M(null)},he=(s,n,y,u)=>{if(!n||n<=0){P(null);return}const l=x.map(w=>w.sku===s?{...w,stockQty:Number(w.stockQty||0)+Number(n||0),incomingQty:Math.max(0,Number(w.incomingQty||0)-Number(n||0)),deliveryStatus:"Delivered",updatedAt:new Date().toISOString().slice(0,10)}:w);H(l),K({type:"purchase_receipt",sku:s,qty:Number(n),ref:y,company:u}),P(null)},ge=(s,n,y,u,l,w,S,C,$,z,G)=>{if(!n||n<=0){R(null);return}const I=x.find(D=>D.sku===s&&(D.warehouse||"Main")===(w||"Main")&&(D.bin||"")===(S||"")&&(D.lot||"")===(C||""));if(I){const D=Number(I.stockQty||0);if(n>D){alert(`Insufficient stock! You only have ${D} units available.`);return}}const J=["Shipped","Delivered"].includes(u||"Delivered"),fe=["Pending","Ready"].includes(u),te=V(z,$,G),Ne=x.map(D=>{if(D.sku!==s||w!==void 0&&(D.warehouse||"Main")!==(w||"Main")||S!==void 0&&(D.bin||"")!==(S||"")||C!==void 0&&(D.lot||"")!==(C||""))return D;let Y=Number(D.stockQty||0),se=Number(D.reserved||0),re=Number(D.outgoingQty||0);return J?Y=Math.max(0,Y-Number(n)):fe&&(se+=Number(n),re+=Number(n)),{...D,stockQty:Y,reserved:se,outgoingQty:re,deliveryStatus:u||"Delivered",deliveryCompany:l||"",trackingNumber:$||"",courier:z||"",trackingUrl:te||"",updatedAt:new Date().toISOString().slice(0,10)}});H(Ne),K({type:"sales_delivery",sku:s,qty:Number(n),ref:y,company:l,status:u||"Delivered",tracking:$||"",courier:z,trackingUrl:te}),R(null)},be=(s,n,y,u,l)=>{if(!n||n<=0||y===u){T(null);return}const w=x.map(C=>C.sku===s&&(C.warehouse||"Main")===y?{...C,stockQty:Math.max(0,Number(C.stockQty||0)-Number(n||0)),updatedAt:new Date().toISOString().slice(0,10)}:C),S=w.findIndex(C=>C.sku===s&&(C.warehouse||"Main")===u);if(S>=0)w[S]={...w[S],stockQty:Number(w[S].stockQty||0)+Number(n||0),updatedAt:new Date().toISOString().slice(0,10)};else{const C=x.find($=>$.sku===s);C&&w.push({...C,warehouse:u,stockQty:Number(n||0),bin:"A-01-01",updatedAt:new Date().toISOString().slice(0,10)})}H(w),K({type:"transfer",sku:s,qty:Number(n),from:y,to:u,ref:l}),T(null)},pe=()=>{const s=["sku","name","stockQty","reserved","price","updatedAt","warehouse","bin","lot","expiry","trackingNumber","courier","trackingUrl"],n=[s.join(","),...x.map(w=>s.map(S=>w[S]??"").join(","))].join(`
`),y=new Blob([n],{type:"text/csv"}),u=URL.createObjectURL(y),l=document.createElement("a");l.href=u,l.download="inventory.csv",l.click()},ye=(s,n)=>{const y=x.map(u=>{if(!(u.sku===s.sku&&(u.warehouse||"Main")===(s.warehouse||"Main")&&(u.bin||"A-01-01")===(s.bin||"A-01-01")&&(u.lot||"")===(s.lot||"")))return u;const w=n.courier??u.courier,S=n.trackingNumber??u.trackingNumber,C=V(w,S,n.trackingUrl??u.trackingUrl);return{...u,...n,trackingUrl:C,updatedAt:new Date().toISOString().slice(0,10)}});H(y)},ee=s=>`${s.sku}-${s.warehouse||"Main"}-${s.bin||"A-01-01"}-${s.lot||""}`;return{query:t,setQuery:i,pageItems:de,toggleSort:ue,sortKey:c,sortDir:m,showAdd:N,setShowAdd:d,showEdit:A,setShowEdit:p,showAdjust:U,setShowAdjust:M,showTransfer:F,setShowTransfer:T,addItem:me,updateItem:ye,deleteItems:s=>{!Array.isArray(s)||s.length===0||(H(x.filter(n=>!s.includes(ee(n)))),Z([]))},getRowId:ee,setQty:xe,transferQty:be,exportCsv:pe,warehouses:ie,role:j,setRole:L,refQuery:E,setRefQuery:W,categories:ce,categoryFilter:a,setCategoryFilter:r,showReceive:B,setShowReceive:P,showDeliver:O,setShowDeliver:R,receiveQty:he,deliverQty:ge,items:x,showHistory:k,setShowHistory:Q,view:g,setView:v,historyFilter:_,setHistoryFilter:ne,selectedRows:le,setSelectedRows:Z}}function ke({inv:t}){const[i,c]=o.useState(null),[h,m]=o.useState(null),[b,x]=o.useState(""),[f,N]=o.useState(""),[d,A]=o.useState(null),[p,U]=o.useState({}),{selectedRows:M,setSelectedRows:F,getRowId:T}=t,B=a=>{a.target.checked?F(t.pageItems.map(r=>T(r))):F([])},P=a=>{M.includes(a)?F(r=>r.filter(k=>k!==a)):F(r=>[...r,a])},O=(a,r)=>{a.key==="Enter"?(h==="trackingNumber"?t.updateItem(r,{trackingNumber:b,courier:f}):t.updateItem(r,{[h]:h==="price"?Number(b):b}),c(null),m(null)):a.key==="Escape"&&(c(null),m(null))},R=(a,r)=>{if(h==="trackingNumber"){if(a.relatedTarget&&a.relatedTarget.closest(".tracking-edit-container"))return;t.updateItem(r,{trackingNumber:b,courier:f})}else t.updateItem(r,{[h]:h==="price"?Number(b):b});c(null),m(null)},j=a=>{switch(a){case"Pending":return"bg-amber-100 text-amber-800 border border-amber-200";case"Shipped":case"In Transit":return"bg-blue-100 text-blue-800 border border-blue-200";case"Out for Delivery":return"bg-purple-100 text-purple-800 border border-purple-200";case"Delivered":return"bg-emerald-100 text-emerald-800 border border-emerald-200";case"Returned":case"Exception":return"bg-rose-100 text-rose-800 border border-rose-200";case"Manual Check Needed":return"bg-orange-100 text-orange-800 border border-orange-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},L=[{id:"sku",label:"Product Number",sortable:!0,defaultClass:"font-medium text-[#3D56A6]"},{id:"name",label:"Name",sortable:!0,defaultClass:"max-w-xs truncate"},{id:"stockQty",label:"Stock",sortable:!0,defaultClass:"font-mono"},{id:"deliveryStatus",label:"Delivery Status"},{id:"deliveryCompany",label:"Customer",defaultClass:"max-w-xs truncate"},{id:"tracking",label:"Tracking #"},{id:"updatedAt",label:"Last Updated",sortable:!0}],E=(a,r)=>{U(k=>({...k,[a]:k[a]===r?void 0:r}))},W=(a,r)=>{if(p[a.id]==="folded")return e.jsx("span",{className:"text-gray-300",children:"•"});const k=T(r),Q=g=>i===k&&h===g;switch(a.id){case"sku":return e.jsx("a",{href:`/inventory-detail.html?sku=${encodeURIComponent(r.sku)}`,className:"text-[#3D56A6] hover:underline font-medium",children:r.sku});case"name":return Q("name")?e.jsx("input",{autoFocus:!0,className:"w-full rounded-md border border-gray-300 px-2 py-1",value:b,onChange:g=>x(g.target.value),onBlur:g=>R(g,r),onKeyDown:g=>O(g,r)}):e.jsx("span",{className:"cursor-pointer hover:text-[#2D4485] hover:underline",onClick:()=>{c(k),m("name"),x(r.name)},children:r.name});case"stockQty":return e.jsx("span",{className:"cursor-pointer hover:text-[#2D4485] hover:underline font-medium",title:"Click to update stock",onClick:()=>t.setShowAdjust({sku:r.sku,warehouse:r.warehouse||"Main",bin:r.bin||"A-01-01",lot:r.lot||"",current:Number(r.stockQty||0)}),children:Number(r.stockQty).toLocaleString("en-US")});case"deliveryStatus":return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{className:`${j(r.deliveryStatus)} px-2 py-1 rounded-full text-xs font-medium min-w-[80px]`,onClick:g=>{g.stopPropagation(),A(d===k?null:k)},children:r.deliveryStatus||"Set Status"}),d===k&&e.jsx("div",{className:"absolute z-20 mt-1 w-32 bg-white border border-gray-200 rounded-md shadow-lg left-0",children:["Pending","Delivered",""].map(g=>e.jsx("button",{className:`block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${g==="Pending"?"text-amber-700":g==="Delivered"?"text-emerald-700":"text-gray-500"}`,onClick:v=>{v.stopPropagation(),A(null),g==="Delivered"?t.setShowDeliver(r):t.updateItem(r,{deliveryStatus:g})},children:g||"Clear"},g))})]});case"deliveryCompany":return Q("deliveryCompany")?e.jsx("input",{autoFocus:!0,className:"w-full rounded-md border border-gray-300 px-2 py-1",value:b,onChange:g=>x(g.target.value),onBlur:g=>R(g,r),onKeyDown:g=>O(g,r)}):e.jsx("span",{className:"cursor-pointer hover:text-[#2D4485] hover:underline truncate max-w-[120px] inline-block align-middle",title:r.deliveryCompany||"Click to edit",onClick:()=>{c(k),m("deliveryCompany"),x(r.deliveryCompany||"")},children:r.deliveryCompany||"-"});case"tracking":{const g=r.trackingUrl||X(r.courier,r.trackingNumber);return Q("trackingNumber")?e.jsxs("div",{className:"tracking-edit-container flex flex-col gap-1 min-w-[160px]",children:[e.jsx("input",{autoFocus:!0,className:"w-full rounded border border-gray-300 px-2 py-1 text-xs font-mono",value:b,onChange:v=>x(v.target.value),onBlur:v=>R(v,r),onKeyDown:v=>O(v,r),placeholder:"Tracking #"}),e.jsxs("select",{className:"w-full rounded border border-gray-300 px-2 py-1 text-xs",value:f,onChange:v=>N(v.target.value),onBlur:v=>R(v,r),onKeyDown:v=>O(v,r),children:[e.jsx("option",{value:"",children:"Courier..."}),["Kerry","Flash","ThaiPost","J&T","DHL","SCG","NinjaVan","Best","Shopee","Lazada","Nim","Other"].map(v=>e.jsx("option",{value:v,children:v},v))]})]}):e.jsx("div",{className:"text-xs font-mono cursor-pointer",onClick:()=>{c(k),m("trackingNumber"),x(r.trackingNumber||""),N(r.courier||"")},title:"Click to edit tracking",children:r.trackingNumber?g?e.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[e.jsx("span",{className:"font-mono font-medium text-gray-900",children:r.trackingNumber}),e.jsxs("a",{href:g,target:"_blank",rel:"noopener noreferrer",onClick:v=>v.stopPropagation(),className:"text-[10px] inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 hover:underline",title:"Open tracking website",children:[e.jsx("span",{children:r.courier?`Track on ${r.courier}`:"Track Package"}),e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}):e.jsx("span",{className:"truncate max-w-[140px] inline-block",children:r.trackingNumber}):e.jsx("span",{className:"text-gray-400 opacity-50 hover:opacity-100 transition-opacity",children:"+ Add"})})}case"updatedAt":return e.jsx("span",{className:"text-gray-600 text-sm",children:r.updatedAt});default:return e.jsx("span",{children:"-"})}};return e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 border-b w-10",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",checked:t.pageItems.length>0&&M.length===t.pageItems.length,onChange:B})}),L.map(a=>{const r=p[a.id];return e.jsx("th",{className:`p-4 border-b transition-all duration-300 group relative align-top ${r==="folded"?"w-12 max-w-[3rem]":r==="expanded"?"min-w-[300px]":"whitespace-nowrap"}`,children:e.jsxs("div",{className:`flex items-center justify-between gap-2 ${r==="folded"?"justify-center":""}`,children:[r!=="folded"&&e.jsx("div",{className:`flex items-center gap-1 ${a.sortable?"cursor-pointer hover:text-gray-900":""}`,onClick:()=>a.sortable&&t.toggleSort(a.id),children:a.label}),e.jsxs("div",{className:`flex items-center gap-1 bg-white rounded-md shadow-md border border-gray-300 opacity-0 group-hover:opacity-100 transition-opacity z-10 ${r==="folded"?"opacity-100 absolute left-1/2 -translate-x-1/2 top-2":""}`,children:[r!=="folded"&&e.jsx("button",{onClick:()=>E(a.id,"folded"),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Fold Column",children:"◀▶"}),r!=="expanded"?e.jsx("button",{onClick:()=>E(a.id,"expanded"),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Fully Expand",children:"⤢"}):e.jsx("button",{onClick:()=>E(a.id,void 0),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Reset Width",children:"✕"})]})]})},a.id)})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[t.pageItems.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:L.length+1,className:"p-8 text-center text-gray-400",children:t.query?"No matching items found.":"No inventory items."})}),t.pageItems.map((a,r)=>{const k=T(a);return e.jsxs("tr",{className:`transition border-b border-gray-100 ${M.includes(k)?"bg-blue-200 hover:bg-blue-300":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:()=>P(k),checked:M.includes(k)})}),L.map(Q=>{const g=p[Q.id];return e.jsx("td",{className:`p-4 transition-all duration-300 align-top ${g==="folded"?"w-12 max-w-[3rem] text-center overflow-hidden p-2":g==="expanded"?"min-w-[300px] whitespace-normal break-words text-gray-600":`whitespace-nowrap text-gray-600 ${Q.defaultClass||""}`}`,children:W(Q,a)},Q.id)})]},r)})]})]})}),t.showAdd&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowAdd(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-lg p-6",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Add Inventory Item"}),e.jsx(ae,{onCancel:()=>t.setShowAdd(!1),onSave:t.addItem})]})}),t.showEdit&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowEdit(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Edit Item"}),e.jsx(ae,{initialData:t.showEdit,onCancel:()=>t.setShowEdit(null),onSave:a=>t.updateItem(t.showEdit,a)})]})}),t.showAdjust&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowAdjust(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Update Stock"}),e.jsx(Ce,{sku:t.showAdjust.sku,current:t.showAdjust.current,onCancel:()=>t.setShowAdjust(null),onConfirm:(a,r)=>t.setQty(t.showAdjust.sku,t.showAdjust.warehouse,t.showAdjust.bin,t.showAdjust.lot,a,r,"")})]})}),t.showTransfer&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowTransfer(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Transfer Stock"}),e.jsx(De,{sku:t.showTransfer.sku,from:t.showTransfer.from,warehouses:t.warehouses.filter(a=>a!=="All"),onCancel:()=>t.setShowTransfer(null),onConfirm:(a,r,k)=>t.transferQty(t.showTransfer.sku,a,t.showTransfer.from,r,k)})]})}),t.showReceive&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowReceive(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Receive Products"}),e.jsx(Qe,{sku:t.showReceive.sku,onCancel:()=>t.setShowReceive(null),onConfirm:(a,r)=>t.receiveQty(t.showReceive.sku,a,r)})]})}),t.showDeliver&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowDeliver(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Deliver Products"}),e.jsx(Me,{sku:t.showDeliver.sku,items:t.items,onCancel:()=>t.setShowDeliver(null),onConfirm:(a,r,k,Q,g,v,_)=>t.deliverQty(t.showDeliver.sku,a,r,k,Q,t.showDeliver.warehouse,t.showDeliver.bin,t.showDeliver.lot,g,v,_)})]})}),t.showImport&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",onClick:()=>t.setShowImport(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-md p-6",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Import CSV"}),e.jsx(Ae,{onCancel:()=>t.setShowImport(!1),onFile:a=>t.importCsv(a)})]})})]})}function Se({inv:t}){var i,c,h,m;return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("div",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Movement History"}),e.jsx(Ie,{sku:(i=t.historyFilter)==null?void 0:i.sku,warehouse:(c=t.historyFilter)==null?void 0:c.warehouse,bin:(h=t.historyFilter)==null?void 0:h.bin,lot:(m=t.historyFilter)==null?void 0:m.lot,onCancel:()=>t.setView("inventory")})]})})}function ae({onCancel:t,onSave:i,initialData:c}){const h={sku:"",name:"",stockQty:0,reserved:0,price:0,warehouse:"Main",bin:"A-01-01",lot:"",expiry:"",incomingQty:0,outgoingQty:0,barcode:"",category:"Finished Goods",uom:"pcs",description:"",brand:"",model:"",status:"Active",minStock:0,reorderQty:0,valuationMethod:"FIFO",serials:"",manufactureDate:"",trackingNumber:"",courier:"",trackingUrl:""},[m,b]=o.useState(c||h),x=!!m.name,f=(N,d)=>b(A=>({...A,[N]:d}));return e.jsxs("div",{className:"space-y-3",children:[c&&e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:m.sku})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Product name"}),e.jsx("input",{value:m.name,onChange:N=>f("name",N.target.value),placeholder:"e.g. Laser Welding Machine",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Stock qty"}),e.jsx("input",{type:"number",min:0,value:m.stockQty,onChange:N=>f("stockQty",Math.max(0,Number(N.target.value))),className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Price"}),e.jsx("input",{type:"number",step:"0.01",value:m.price,onChange:N=>f("price",Number(N.target.value)),className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Courier"}),e.jsxs("select",{value:m.courier,onChange:N=>f("courier",N.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2",children:[e.jsx("option",{value:"",children:"Select Courier"}),["Kerry","Flash","ThaiPost","J&T","DHL","SCG","NinjaVan","Best","Shopee","Lazada","Nim","Other"].map(N=>e.jsx("option",{value:N,children:N},N))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Tracking Number"}),e.jsx("input",{value:m.trackingNumber,onChange:N=>f("trackingNumber",N.target.value),placeholder:"e.g. TH12345678",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:t,className:"btn-pill",children:"Cancel"}),e.jsx("button",{disabled:!x,onClick:()=>i({...m,serials:[],trackingUrl:V(m.courier,m.trackingNumber,m.trackingUrl)}),className:"btn-pill disabled:opacity-50",children:"Save"})]})]})}function Ce({sku:t,current:i=0,onCancel:c,onConfirm:h}){const[m,b]=o.useState(i),[x,f]=o.useState(""),N=Number.isFinite(m);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Current stock"}),e.jsx("input",{value:i,readOnly:!0,className:"w-full rounded-md border border-gray-300 px-3 py-2 bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"New stock"}),e.jsx("input",{type:"number",value:m,onChange:d=>b(Number(d.target.value)),className:"w-full rounded-md border border-gray-300 px-3 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Note (optional)"}),e.jsx("input",{value:x,onChange:d=>f(d.target.value),placeholder:"Reason for change",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:c,className:"btn-pill",children:"Cancel"}),e.jsx("button",{disabled:!N,onClick:()=>h(Number(m),x||"Stock update"),className:"btn-pill disabled:opacity-50",children:"Confirm"})]})]})}function De({sku:t,from:i,warehouses:c,onCancel:h,onConfirm:m}){const[b,x]=o.useState(0),[f,N]=o.useState(c.find(p=>p!==i)||"Secondary"),[d,A]=o.useState("");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:b,onChange:p=>x(Number(p.target.value)),placeholder:"Qty",className:"rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"rounded-md border border-gray-300 px-3 py-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"From"}),e.jsx("div",{className:"text-sm font-semibold",children:i})]}),e.jsx("select",{value:f,onChange:p=>N(p.target.value),className:"rounded-md border border-gray-300 px-3 py-2",children:c.map(p=>p!=="All"&&e.jsx("option",{children:p},p))})]}),e.jsx("input",{value:d,onChange:p=>A(p.target.value),placeholder:"Reference (e.g. Source Document)",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:h,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>m(b,f,d),className:"btn-pill",children:"Transfer"})]})]})}function Ae({onCancel:t,onFile:i}){const[c,h]=o.useState(null);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"file",accept:".csv,text/csv",onChange:m=>{var b;return h(((b=m.target.files)==null?void 0:b[0])||null)},className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:t,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>i&&i(c),className:"btn-pill",children:"Import"})]})]})}function Ie({sku:t,warehouse:i,bin:c,lot:h,onCancel:m}){const[b,x]=o.useState([]);o.useEffect(()=>{try{const A=JSON.parse(localStorage.getItem("inventoryMovements")||"[]").filter(p=>t?(p.sku||"")===t:!0).filter(p=>i?(p.warehouse||"Main")===i:!0).filter(p=>c?(p.bin||"A-01-01")===c:!0).filter(p=>h?(p.lot||"")===h:!0).sort((p,U)=>String(U.ts).localeCompare(String(p.ts))).slice(0,50);x(A)}catch{x([])}},[t,i,c,h]);const f=d=>d.delta!=null?d.delta:d.qty!=null?d.qty:"",N=`${i||"Main"} / ${c||"A-01-01"}${h?" / "+h:""}`;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Location: ",N]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[#2D4485]",children:[e.jsx("th",{className:"p-2 text-left",children:"Date"}),e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Change"}),e.jsx("th",{className:"p-2 text-left",children:"New Qty"}),e.jsx("th",{className:"p-2 text-left",children:"Reason"}),e.jsx("th",{className:"p-2 text-left",children:"Ref"}),e.jsx("th",{className:"p-2 text-left",children:"Company"}),e.jsx("th",{className:"p-2 text-left",children:"Tracking"}),e.jsx("th",{className:"p-2 text-left",children:"Status"}),e.jsx("th",{className:"p-2 text-left",children:"User"})]})}),e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-gray-600",colSpan:10,children:"No movements found"})}):b.map((d,A)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:String(d.ts).slice(0,19).replace("T"," ")}),e.jsx("td",{className:"p-2",children:d.type}),e.jsx("td",{className:"p-2",children:f(d)}),e.jsx("td",{className:"p-2",children:d.newQty!=null?d.newQty:""}),e.jsx("td",{className:"p-2",children:d.reason||""}),e.jsx("td",{className:"p-2",children:d.ref||d.from||d.to||""}),e.jsx("td",{className:"p-2",children:d.company||"-"}),e.jsx("td",{className:"p-2",children:d.tracking?e.jsx("a",{href:d.trackingUrl||X(d.courier,d.tracking),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:d.tracking}):"-"}),e.jsx("td",{className:"p-2",children:d.status||"-"}),e.jsx("td",{className:"p-2",children:d.user||""})]},A))})]})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:m,className:"btn-pill",children:"Close"})})]})}function Qe({sku:t,onCancel:i,onConfirm:c}){const[h,m]=o.useState(0),[b,x]=o.useState("");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product Number: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsx("input",{type:"number",value:h,onChange:f=>m(Number(f.target.value)),placeholder:"Qty received",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{value:b,onChange:f=>x(f.target.value),placeholder:"PO/GRN Reference",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:i,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>c(h,b),className:"btn-pill",children:"Receive"})]})]})}function Me({sku:t,onCancel:i,onConfirm:c}){const[h,m]=o.useState(0),[b,x]=o.useState(""),[f,N]=o.useState(""),[d,A]=o.useState("Delivered"),[p,U]=o.useState(""),[M,F]=o.useState("Other"),[T,B]=o.useState(""),[P,O]=o.useState(""),R=M==="Other";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Product: ",e.jsx("span",{className:"font-semibold",children:t})]}),e.jsx("input",{type:"number",min:0,value:h,onChange:j=>m(Math.max(0,Number(j.target.value))),placeholder:"Quantity",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsx("input",{value:b,onChange:j=>x(j.target.value),placeholder:"Reference No.",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("select",{value:M,onChange:j=>F(j.target.value),className:"rounded-md border border-gray-300 px-3 py-2",children:["Other","Kerry","Flash","ThaiPost","J&T","DHL","SCG","NinjaVan","Best","Shopee","Lazada","Nim"].map(j=>e.jsx("option",{value:j,children:j},j))}),e.jsx("input",{value:p,onChange:j=>U(j.target.value),placeholder:"Tracking No.",className:"w-full rounded-md border border-gray-300 px-3 py-2"})]}),R&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{value:T,onChange:j=>B(j.target.value),placeholder:"Specify Courier Name",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"}),e.jsx("input",{value:P,onChange:j=>O(j.target.value),placeholder:"Tracking Link (Optional)",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm"})]}),e.jsx("input",{value:f,onChange:j=>N(j.target.value),placeholder:"Customer Name",className:"w-full rounded-md border border-gray-300 px-3 py-2"}),e.jsxs("select",{value:d,onChange:j=>A(j.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Shipped",children:"Shipped"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:i,className:"btn-pill",children:"Cancel"}),e.jsx("button",{onClick:()=>{const j=R?T||"Other":M,L=V(j,p,P);c(h,b,d,f,p,j,L)},className:"btn-pill",children:"Deliver"})]})]})}function Re(){const t=ve(),[i,c]=o.useState(!1);return e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(we,{}),e.jsx("section",{className:"w-full bg-gray-50",children:e.jsxs("div",{className:"w-full mx-auto p-6 min-h-full",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Inventory Control Tower"}),e.jsx("button",{className:"inline-flex items-center justify-center min-w-[150px] px-6 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6] shadow-sm",onClick:()=>t.setShowAdd(!0),children:"Add Item"}),e.jsx("button",{onClick:t.exportCsv,className:"inline-flex items-center justify-center px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 shadow-sm",children:"Export"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.selectedRows.length>0&&e.jsx("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",children:e.jsxs("span",{className:"font-medium",children:["Delete (",t.selectedRows.length,")"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t.query,onChange:h=>t.setQuery(h.target.value),placeholder:"Search by name or product number",className:"pl-10 pr-10 py-2 border border-slate-300 rounded-lg text-sm w-80 focus:outline-none focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] transition-all"}),e.jsx("svg",{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),t.query&&e.jsx("button",{onClick:()=>t.setQuery(""),className:"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600",title:"Clear Search",children:"✕"})]}),e.jsx("button",{onClick:()=>{t.setHistoryFilter(null),t.setView(t.view==="history"?"inventory":"history")},className:"inline-flex items-center justify-center px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 shadow-sm",children:t.view==="history"?"Inventory":"History"}),e.jsx("div",{className:"text-slate-500 font-medium text-sm",children:t.query?e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"text-slate-900 font-bold",children:t.pageItems.length})," of ",e.jsx("span",{className:"text-slate-900 font-bold",children:t.items.length})," items"]}):e.jsxs("span",{children:["Total: ",e.jsx("span",{className:"text-slate-900 font-bold",children:t.items.length})," items"]})})]})]}),e.jsx("div",{children:t.view==="history"?e.jsx(Se,{inv:t}):e.jsx(ke,{inv:t})})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>c(!1),children:e.jsx("div",{className:"absolute left-1/2 top-1/3 -translate-x-1/2 w-[520px] max-w-[95vw]",onClick:h=>h.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete items"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>c(!1),children:"✕"})]}),e.jsx("div",{className:"px-5 py-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:t.selectedRows.length})," selected items?"]})}),e.jsxs("div",{className:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700",onClick:()=>{t.deleteItems(t.selectedRows),c(!1)},children:"Delete"})]})]})})})]})}je.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(Re,{})}));
