import{R as Ce,j as e,a as o,b as ke}from"./index-BHXMZ0-J.js";import{c as De,A as S,N as Oe,f as ie}from"./navigation-B0IDt7ps.js";import{L as qe}from"./language-context-DF7eV6qf.js";import{J as Ie}from"./job-order-template-CSuNXwgo.js";import{g as $e,D as Te}from"./DayPicker-Cy1TBD3b.js";import{p as Ae,C as Pe}from"./parseISO-BxmDVPrG.js";import"./addWeeks-yWatJi1q.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=De("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);function J(p,O){if(!Array.isArray(p)||!p.length)return"";const v={};for(const h of p){const w=String(h.description||"").trim().toLowerCase();if(!w)continue;const c=Number(h.qty);!Number.isFinite(c)||c<=0||(v[w]=(v[w]||0)+c)}const C=Object.keys(v);if(!C.length)return"";for(const h of C){const w=Number(O[h]||0),c=Number(v[h]||0);if(!Number.isFinite(w)||c>=w)return"Not Available"}return"Available"}function B({value:p,onChange:O,placeholder:v="DD/MM/YYYY"}){const[C,h]=o.useState(!1),w=o.useRef(null),c=$e(),z=(()=>{try{return p?Ae(p):void 0}catch{return}})(),X=(()=>{try{return z?ie(z,"dd/MM/yyyy"):""}catch{return""}})();return o.useEffect(()=>{if(!C)return;const f=F=>{const V=w.current;V&&!V.contains(F.target)&&h(!1)},T=F=>{F.key==="Escape"&&h(!1)};return document.addEventListener("mousedown",f),document.addEventListener("touchstart",f,{passive:!0}),document.addEventListener("keydown",T),()=>{document.removeEventListener("mousedown",f),document.removeEventListener("touchstart",f),document.removeEventListener("keydown",T)}},[C]),e.jsxs("div",{ref:w,className:"relative inline-block w-full",children:[e.jsx("input",{type:"text",value:X,placeholder:v,onClick:()=>h(f=>!f),readOnly:!0,className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"}),e.jsx("button",{type:"button",onClick:()=>h(f=>!f),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700","aria-label":"Open calendar",children:e.jsx(Pe,{className:"size-4","aria-hidden":"true"})}),C&&e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-[calc(100%+8px)] z-50 bg-white border border-slate-200 rounded-[22px] shadow-xl p-4 w-[340px]",children:e.jsx(Te,{mode:"single",selected:z,onSelect:f=>{if(!f)return;const T=ie(f,"yyyy-MM-dd");O(T),h(!1)},captionLayout:"buttons",classNames:{root:`w-fit ${c.root}`,months:`flex flex-col ${c.months}`,month:`rounded-2xl pt-8 ${c.month}`,caption:`relative h-8 ${c.caption}`,nav:`absolute left-3 right-3 top-0 flex items-center justify-between ${c.nav}`,nav_button:`p-2 rounded-full hover:bg-slate-100 ${c.nav_button}`,nav_button_previous:`${c.nav_button_previous}`,nav_button_next:`${c.nav_button_next}`,caption_label:`absolute left-1/2 -translate-x-1/2 top-0 h-8 leading-8 text-center font-semibold uppercase tracking-wide text-[#2D4485] ${c.caption_label}`,table:"w-full border-collapse",weekdays:`flex justify-between border-b border-slate-200 pb-2 ${c.weekdays}`,weekday:`text-slate-500 flex-1 text-sm text-center ${c.weekday}`,week:`grid grid-cols-7 mt-2 ${c.week}`,day:`mx-auto size-10 flex items-center justify-center rounded-full hover:bg-blue-50 ${c.day}`,today:`bg-[#E7F1FF] text-[#2D4485] ${c.today}`,outside:`text-slate-400 ${c.outside}`,disabled:`${c.disabled}`},modifiersClassNames:{selected:"bg-[#E7F1FF] text-[#2D4485]"}})})]})}function Le(){const[p,O]=o.useState([]),v=O,[C,h]=o.useState(null),[w,c]=o.useState(null),[z,X]=o.useState(null),[f,T]=o.useState(""),[F,V]=o.useState(""),[le,R]=o.useState(!1),[l,b]=o.useState({product:"",productNo:"",jobOrderCode:"",purchaseOrder:"",unit:"Unit",quantity:1,totalQuantity:1,scheduledDate:"",completedDate:"",productionTime:"",responsible:"",priority:"None",customer:""}),[Ee,ze]=o.useState(null),[Fe,Re]=o.useState(""),[Qe,Je]=o.useState(null),[Be,Ve]=o.useState(""),[Ye,Ue]=o.useState(null),[He,Ke]=o.useState(""),[ee,A]=o.useState(null),[We,Ze]=o.useState(null),[Ge,Xe]=o.useState(""),[et,tt]=o.useState(null),[rt,st]=o.useState(""),[at,nt]=o.useState(null),[Y,U]=o.useState(null),[de,k]=o.useState(!1),[te,q]=o.useState("default"),[ot,it]=o.useState(null),[lt,dt]=o.useState(""),[ct,ce]=o.useState(!1),[$,P]=o.useState(null),[d,y]=o.useState(null),[M,N]=o.useState([]),[L,re]=o.useState(""),[H,ue]=o.useState({}),[_,Q]=o.useState([]),[pe,E]=o.useState(!1),[ut,pt]=o.useState(null),[mt,xt]=o.useState(null),[gt,ht]=o.useState(null);o.useRef(null);const[bt,yt]=o.useState(null),[ft,jt]=o.useState(null),[se,me]=o.useState({}),[vt,Nt]=o.useState(!1),[ae,ne]=o.useState(null),[xe,K]=o.useState(!1),[ge,he]=o.useState([]),be=o.useCallback(t=>{const r=String(t||"").trim();let s={...l,purchaseOrder:r};const n=p.find(i=>String(i.ref||"").trim()===r||String(i.purchaseOrder||"").trim()===r);if(n){String(n.customer||"").trim()&&(s.customer=n.customer),!String(s.product||"").trim()&&String(n.product||"").trim()&&(s.product=n.product),!String(s.productNo||"").trim()&&String(n.productNo||"").trim()&&(s.productNo=n.productNo);const i=Number(n.quantity),a=Number(n.totalQuantity);!Number(s.quantity)&&Number.isFinite(i)&&i>0&&(s.quantity=i),!Number(s.totalQuantity)&&Number.isFinite(a)&&a>0&&(s.totalQuantity=a)}b(s),K(!1)},[l,p]);o.useEffect(()=>{const t=localStorage.getItem("authToken"),r=t?{Authorization:`Token ${t}`}:{};fetch(`${S}/api/component_entries/`,{headers:r}).then(s=>s.json()).then(s=>{const n={};for(const i of Array.isArray(s)?s:[]){const a=String(i.component_name||"").trim().toLowerCase();a&&(n[a]=(n[a]||0)+(Number(i.quantity)||0))}me(n)}).catch(console.error)},[]),o.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken"),r=t?{Authorization:`Token ${t}`}:{},s=await fetch(`${S}/api/deals/`,{headers:r});if(!s.ok)return;const n=await s.json(),i=Array.from(new Set((n||[]).map(a=>String(a.po_number||"").trim()).filter(Boolean)));he(i)}catch{}})()},[]),o.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken"),r=t?{Authorization:`Token ${t}`}:{},s=await fetch(`${S}/api/manufacturing_orders/`,{headers:r});if(!s.ok)return;const n=await s.json(),i=(Array.isArray(n)?n:[]).map(a=>{const x=Array.isArray(a.items)?a.items.map(j=>({itemCode:String(j.item??j.itemCode??"").trim(),description:String(j.item_description??j.description??"").trim(),qty:String(j.item_quantity??j.qty??""),unit:String(j.item_unit??j.unit??"Unit")})):[],u=J(x,se);return{id:a.id,ref:a.job_order_code,jobOrderCode:a.job_order_code||"",purchaseOrder:a.po_number||"",productNo:a.product_no||"",product:a.product||"",quantity:Number(a.quantity)||1,totalQuantity:Number(a.quantity)||Number(a.totalQuantity)||Number(a.quantity)||1,start:a.start_date||"",completedDate:a.complete_date||"",productionTime:a.production_time||"",supplier:a.supplier||"",supplierDate:a.supplier_date||"",recipient:a.recipient||"",recipientDate:a.recipient_date||"",responsible:[String(a.responsible_sales_person||"").trim(),String(a.responsible_production_person||"").trim()].filter(Boolean).join(" / "),responsibleSales:String(a.responsible_sales_person||"").trim(),responsibleProduction:String(a.responsible_production_person||"").trim(),customer:a.customer_name||"",poFileName:a.po_file_name||"",componentStatus:u||a.component_status||"",state:a.state||"",favorite:!1,selected:!1,activitySchedules:[],items:x}});O(i),ce(!0)}catch{}})()},[se]),o.useEffect(()=>{$&&(async()=>{try{const t=localStorage.getItem("authToken"),r=t?{Authorization:`Token ${t}`}:{},s=await fetch(`${S}/api/manufacturing_orders/${$}/`,{headers:r});if(!s.ok)return;const n=await s.json();y({id:n.id,job_order_code:n.job_order_code||"",po_number:n.po_number||"",customer_name:n.customer_name||"",product_no:n.product_no||"",quantity:Number(n.quantity)||1,start_date:n.start_date||"",complete_date:n.complete_date||"",production_time:n.production_time||"",responsible_sales_person:n.responsible_sales_person||"",responsible_production_person:n.responsible_production_person||"",supplier:n.supplier||"",supplier_date:n.supplier_date||"",recipient:n.recipient||"",recipient_date:n.recipient_date||""});const i=Array.isArray(n.items)?n.items.map(a=>({itemCode:String(a.item??a.itemCode??"").trim(),description:String(a.item_description??a.description??"").trim(),qty:String(a.item_quantity??a.qty??""),unit:String(a.item_unit??a.unit??"Unit")})):[];N(i)}catch{}})()},[$]),o.useEffect(()=>{try{const r=new URLSearchParams(window.location.search).get("mfgId");if(r){const s=Number(r);P(Number.isFinite(s)?s:r)}}catch{}},[]),p.reduce((t,r)=>t+(parseInt(r.quantity,10)||0),0),p.reduce((t,r)=>t+(parseInt(r.totalQuantity,10)||0),0);const ye=t=>t==="Processing"?"bg-blue-50 text-[#2D4485]":t==="Finished"?"bg-green-100 text-green-700":t==="Cancelled"?"bg-red-100 text-red-700":"bg-gray-200 text-gray-700",fe=t=>t==="Not Available"?"bg-red-100 text-red-700":t==="Available"?"bg-green-100 text-green-700":"bg-gray-200 text-gray-700",I=async(t,r)=>{try{const s=localStorage.getItem("authToken"),n={"Content-Type":"application/json",...s?{Authorization:`Token ${s}`}:{}},i=await fetch(`${S}/api/manufacturing_orders/${t}/`,{method:"PATCH",headers:n,body:JSON.stringify(r)});if(!i.ok)return;const a=await i.json();v(p.map(x=>x.id===t?{...x,componentStatus:a.component_status??x.componentStatus,state:a.state??x.state}:x))}catch{}},oe=t=>t?new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",D=p.filter(t=>{const s=L.toLowerCase().split(/\s+/).filter(Boolean);return s.length?s.every(n=>[t.product,t.customer,t.jobOrderCode,t.ref,t.purchaseOrder,t.productNo].some(i=>String(i||"").toLowerCase().includes(n))):!0}),je=o.useMemo(()=>{const t=[...D];switch(te){case"start_asc":return t.sort((r,s)=>new Date(r.start||0)-new Date(s.start||0));case"start_desc":return t.sort((r,s)=>new Date(s.start||0)-new Date(r.start||0));case"quantity_asc":return t.sort((r,s)=>(parseInt(r.quantity,10)||0)-(parseInt(s.quantity,10)||0));case"quantity_desc":return t.sort((r,s)=>(parseInt(s.quantity,10)||0)-(parseInt(r.quantity,10)||0));case"product_az":return t.sort((r,s)=>String(r.product||"").localeCompare(String(s.product||"")));case"product_za":return t.sort((r,s)=>String(s.product||"").localeCompare(String(r.product||"")));default:return t.sort((r,s)=>r.id-s.id)}},[D,te]),ve=t=>{t.target.checked?Q(D.map(r=>r.id)):Q([])},Ne=t=>{Q(r=>r.includes(t)?r.filter(s=>s!==t):[...r,t])},we=async()=>{if(!_.length)return;const t=[..._];try{await Promise.all(t.map(async r=>{try{const s=localStorage.getItem("authToken"),n=s?{Authorization:`Token ${s}`}:{},i=await fetch(`${S}/api/manufacturing_orders/${r}/`,{method:"DELETE",headers:n});if(!i.ok&&i.status!==404)throw new Error(`HTTP ${i.status}`)}catch{}}))}finally{const r=p.filter(s=>!t.includes(s.id));v(r),Q([])}},W=[{id:"index",label:"Index",width:"w-16"},{id:"ref",label:"Job Order"},{id:"productNo",label:"Product No",defaultClass:"max-w-xs truncate"},{id:"quantity",label:"Quantity",defaultClass:"font-mono text-sm"},{id:"componentStatus",label:"Component Status"},{id:"state",label:"State"},{id:"customer",label:"Customer"},{id:"jobOrderCode",label:"PO Number"},{id:"poFile",label:"PO File"},{id:"responsible",label:"Responsible"},{id:"start",label:"Start"},{id:"completedDate",label:"Completed Date"},{id:"productionTime",label:"Production Time"}],Z=(t,r)=>{ue(s=>({...s,[t]:s[t]===r?void 0:r}))},_e=(t,r,s)=>{if(H[t.id]==="folded")return e.jsx("span",{className:"text-gray-300",children:"•"});switch(t.id){case"index":return e.jsx("span",{className:"font-medium text-gray-800",children:s+1});case"ref":return e.jsx("button",{className:"text-[#3D56A6] hover:underline font-medium",onClick:()=>{window.location.href=`/new-mo.html?mfgId=${r.id}`},children:r.jobOrderCode||"-"});case"jobOrderCode":return e.jsx("span",{className:"text-gray-800",children:r.purchaseOrder||"-"});case"poFile":return r.poFileName?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("a",{href:`${S}/api/manufacturing_orders/${r.id}/download/`,className:"text-blue-600 underline hover:text-blue-800",target:"_blank",rel:"noopener noreferrer",children:r.poFileName}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Click to open"})]}):e.jsx("span",{className:"text-gray-400",children:"-"});case"productNo":return e.jsx("span",{className:"text-gray-800",children:r.productNo||"-"});case"quantity":return e.jsx("span",{className:"text-gray-800",children:String(parseInt(r.quantity,10)||0)});case"start":return e.jsx("span",{className:"text-gray-700",children:r.start?oe(new Date(r.start).getTime()):"-"});case"completedDate":return e.jsx("span",{className:"text-gray-700",children:r.completedDate?oe(new Date(r.completedDate).getTime()):"-"});case"productionTime":return e.jsx("span",{className:"text-gray-700",children:r.productionTime||"-"});case"responsible":return e.jsx("span",{className:"text-gray-700",children:r.responsible||"-"});case"customer":return e.jsx("span",{className:"text-gray-800",children:r.customer||"-"});case"componentStatus":return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{className:`${fe(r.componentStatus)} px-2 py-1 rounded-full text-xs`,onClick:()=>h(C===r.id?null:r.id),title:"Change component status",children:r.componentStatus||"Set Status"}),C===r.id&&e.jsxs("div",{className:"absolute z-10 mt-2 bg-white border border-gray-200 rounded-md shadow-md",children:[e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-green-700",onClick:()=>{h(null),I(r.id,{component_status:"Available"})},children:"Available"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-red-600",onClick:()=>{h(null),I(r.id,{component_status:"Not Available"})},children:"Not Available"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{h(null),I(r.id,{component_status:""})},children:"Clear"})]})]});case"state":return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{className:`${ye(r.state)} px-2 py-1 rounded-full text-xs`,onClick:()=>A(ee===r.id?null:r.id),title:"Change state",children:r.state||"Set State"}),ee===r.id&&e.jsxs("div",{className:"absolute z-10 mt-2 bg-white border border-gray-200 rounded-md shadow-md",children:[e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{A(null),I(r.id,{state:"Processing"})},children:"Processing"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-green-700",onClick:()=>{A(null),I(r.id,{state:"Finished"})},children:"Finished"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-red-600",onClick:()=>{A(null),I(r.id,{state:"Cancelled"})},children:"Cancelled"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{A(null),I(r.id,{state:""})},children:"Clear"})]})]});default:return e.jsx("span",{children:"-"})}},Se=()=>{const t=p.map(s=>String(s.jobOrderCode||"")).map(s=>{const n=s.match(/^JO[-/ ]?(\d{1,5})$/i);return n?parseInt(n[1],10):null}).filter(s=>Number.isFinite(s)),r=t.length?Math.max(...t)+1:1;return`JO-${String(r).padStart(3,"0")}`};return e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(Oe,{}),e.jsx("section",{className:"w-full bg-gray-50",children:e.jsxs("div",{className:"w-full mx-auto p-6 min-h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Manufacturing Orders"}),e.jsx("button",{className:"inline-flex items-center justify-center px-6 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",title:"New MO",onClick:()=>{window.location.href="/new-mo.html"},children:"New MO"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>k(t=>!t),className:"inline-flex items-center justify-center gap-2 px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Sort",children:[e.jsx("span",{children:"Sort"}),e.jsx(Me,{className:"w-4 h-4"})]}),de&&e.jsxs("div",{className:"absolute left-0 top-full mt-1 bg-white border border-gray-200 rounded-md shadow-md z-20 w-44",children:[e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("default"),k(!1)},children:"Default"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("start_asc"),k(!1)},children:"Start Date ↑"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("start_desc"),k(!1)},children:"Start Date ↓"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("quantity_asc"),k(!1)},children:"Quantity ↑"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("quantity_desc"),k(!1)},children:"Quantity ↓"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("product_az"),k(!1)},children:"Product A–Z"}),e.jsx("button",{className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>{q("product_za"),k(!1)},children:"Product Z–A"})]})]}),e.jsx("button",{className:"px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Bills of Materials",onClick:()=>window.location.href="/bom.html",children:"Bill of Materials"}),e.jsx("button",{className:"px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Components",onClick:()=>window.location.href="/products.html",children:"Components"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[_.length>0&&e.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("span",{className:"font-medium",children:["Delete (",_.length,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by Product, Customer, JO or MO...",className:"pl-10 pr-10 py-2 border border-slate-300 rounded-lg text-sm w-80 focus:outline-none focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] transition-all",value:L,onChange:t=>re(t.target.value)}),e.jsx("svg",{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),L&&e.jsx("button",{onClick:()=>re(""),className:"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600 transition-colors",title:"Clear Search",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"text-slate-500 font-medium text-sm",children:L?e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"text-slate-900 font-bold",children:D.length})," of ",e.jsx("span",{className:"text-slate-900 font-bold",children:p.length})," orders"]}):e.jsxs("span",{children:["Total: ",e.jsx("span",{className:"text-slate-900 font-bold",children:p.length})," orders"]})})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 border-b w-10",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:ve,checked:D.length>0&&_.length===D.length,ref:t=>{t&&(t.indeterminate=_.length>0&&_.length<D.length)}})}),W.map(t=>{const r=H[t.id];return e.jsx("th",{className:`p-4 border-b transition-all duration-300 group relative align-top ${r==="folded"?"w-12 max-w-[3rem]":r==="expanded"?"min-w-[300px]":"whitespace-nowrap"}`,children:e.jsxs("div",{className:`flex items-center justify-between gap-2 ${r==="folded"?"justify-center":""}`,children:[r!=="folded"&&e.jsx("span",{children:t.label}),e.jsxs("div",{className:`flex items-center gap-1 bg-white rounded-md shadow-md border border-gray-300 opacity-0 group-hover:opacity-100 transition-opacity z-10 ${r==="folded"?"opacity-100 absolute left-1/2 -translate-x-1/2 top-2":""}`,children:[r!=="folded"&&e.jsx("button",{onClick:()=>Z(t.id,"folded"),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Fold Column",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})]})}),r!=="expanded"?e.jsx("button",{onClick:()=>Z(t.id,"expanded"),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Fully Expand",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 01-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12a1 1 0 01-1-1z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M16 16a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L13.586 13.586V12a1 1 0 012 0v4zM4 12a1 1 0 011 1v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 13.586H8a1 1 0 010 2H4a1 1 0 01-1-1v-4a1 1 0 011-1z",clipRule:"evenodd"})]})}):e.jsx("button",{onClick:()=>Z(t.id,void 0),className:"p-1.5 hover:bg-blue-50 text-gray-500 hover:text-blue-600 rounded transition-colors",title:"Reset to Default",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})},t.id)})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[je.map((t,r)=>e.jsxs("tr",{className:`transition border-b border-gray-100 ${_.includes(t.id)?"bg-blue-200 hover:bg-blue-300":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:()=>Ne(t.id),checked:_.includes(t.id)})}),W.map(s=>{const n=H[s.id];return e.jsx("td",{className:`p-4 transition-all duration-300 align-top ${n==="folded"?"w-12 max-w-[3rem] text-center overflow-hidden p-2":n==="expanded"?"min-w-[300px] whitespace-normal break-words text-gray-600":`whitespace-nowrap text-gray-600 ${s.defaultClass||""}`}`,children:_e(s,t,r)},s.id)})]},t.id)),D.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:W.length+1,className:"p-8 text-center text-gray-400",children:L?"No matching orders found.":"No manufacturing orders."})})]})]})})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>U(null),children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[360px]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-white",children:[e.jsx("div",{className:"px-4 py-3 border-b-2 border-white",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Confirm Delete"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"text-sm text-gray-800",children:"Delete this order?"})}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>U(null),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:async()=>{try{const t=await fetch(`${S}/api/manufacturing_orders/${Y}/`,{method:"DELETE"});if(!t.ok&&t.status!==404)throw new Error(`HTTP ${t.status}`)}catch{}v(p.filter(t=>t.id!==Y)),U(null)},children:"Delete"})]})]})})}),pe&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>E(!1),children:e.jsx("div",{className:"absolute left-1/2 top-1/3 -translate-x-1/2 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete orders"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>E(!1),children:"✕"})]}),e.jsx("div",{className:"px-5 py-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:_.length})," selected orders?"]})}),e.jsxs("div",{className:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>E(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700",onClick:async()=>{await we(),E(!1)},children:"Delete"})]})]})})}),$&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>{P(null),y(null),N([])},children:e.jsx("div",{className:"absolute left-1/2 top-10 -translate-x-1/2 w-[1000px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Job Order"}),e.jsxs("span",{className:"text-gray-500",children:["#",d.job_order_code||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>{const t=p.find(r=>r.id===$);t&&(ne({...t,totalQuantity:t.totalQuantity||t.quantity||1,productNo:t.productNo||"",completedDate:t.completedDate||""}),setTimeout(()=>{window.print(),ne(null)},100))},children:"Print"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>{P(null),y(null),N([])},children:"✕"})]})]}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Customer Name"}),e.jsx("input",{value:d.customer_name,onChange:t=>y({...d,customer_name:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Start Date"}),e.jsx(B,{value:d.start_date,onChange:t=>y({...d,start_date:t}),placeholder:"DD/MM/YYYY"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Order Quantity"}),e.jsx("input",{value:d.quantity,onChange:t=>y({...d,quantity:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Product No"}),e.jsx("input",{value:d.product_no,onChange:t=>y({...d,product_no:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Completed Date"}),e.jsx(B,{value:d.complete_date,onChange:t=>y({...d,complete_date:t}),placeholder:"DD/MM/YYYY"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Supplier Date"}),e.jsx(B,{value:d.supplier_date,onChange:t=>y({...d,supplier_date:t}),placeholder:"DD/MM/YYYY"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Recipient Date"}),e.jsx(B,{value:d.recipient_date,onChange:t=>y({...d,recipient_date:t}),placeholder:"DD/MM/YYYY"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Time of Production"}),e.jsx("input",{value:d.production_time,onChange:t=>y({...d,production_time:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-900 uppercase tracking-wide mb-2",children:"Product Items Description"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b",children:"Item Code"}),e.jsx("th",{className:"p-3 border-b",children:"Description"}),e.jsx("th",{className:"p-3 border-b",children:"Quantity"}),e.jsx("th",{className:"p-3 border-b",children:"Unit"}),e.jsx("th",{className:"p-3 border-b w-12"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[M.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition border-b border-gray-100",children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{value:t.itemCode,onChange:s=>N(n=>n.map((i,a)=>a===r?{...i,itemCode:s.target.value}:i)),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",placeholder:"Code"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:t.description,onChange:s=>N(n=>n.map((i,a)=>a===r?{...i,description:s.target.value}:i)),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",placeholder:"Item description"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:t.qty,onChange:s=>N(n=>n.map((i,a)=>a===r?{...i,qty:s.target.value}:i)),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",placeholder:"1"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:t.unit,onChange:s=>N(n=>n.map((i,a)=>a===r?{...i,unit:s.target.value}:i)),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",placeholder:"Unit"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>N(s=>s.filter((n,i)=>i!==r)),className:"px-2 py-1 rounded-md text-red-600 hover:bg-red-50",children:"Delete"})})]},r)),M.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-6 text-center text-gray-400",children:"No items"})})]})]})}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>N(t=>[...t,{itemCode:"",description:"",qty:"1",unit:"Unit"}]),className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Add Item"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>{P(null),y(null),N([])},children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:async()=>{var n,i,a;const t=M.map((x,u)=>({item:String(x.itemCode||String(u+1)).trim(),item_description:String(x.description||"").trim(),item_quantity:String(x.qty||"").trim(),item_unit:String(x.unit||"Unit").trim()})),r=J(M),s={job_order_code:String(d.job_order_code||"").trim(),po_number:String(d.po_number||"").trim(),write_customer_name:String(d.customer_name||"").trim(),product_no:String(d.product_no||"").trim(),quantity:Number(d.quantity)||1,start_date:d.start_date||null,complete_date:d.complete_date||null,supplier:String(d.supplier||"").trim(),supplier_date:d.supplier_date||null,recipient:String(d.recipient||"").trim(),recipient_date:d.recipient_date||null,production_time:String(d.production_time||"").trim(),responsible_sales_person:String(d.responsible_sales_person||"").trim(),responsible_production_person:String(d.responsible_production_person||"").trim(),items:t,item_description:String(((n=t[0])==null?void 0:n.item_description)||"").trim(),item_quantity:String(((i=t[0])==null?void 0:i.item_quantity)||"").trim(),item_unit:String(((a=t[0])==null?void 0:a.item_unit)||"Unit").trim(),component_status:r};try{const x=await fetch(`${S}/api/manufacturing_orders/${d.id}/`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!x.ok)return;const u=await x.json(),j=Array.isArray(u.items)?u.items.map(m=>({itemCode:String(m.item??m.itemCode??"").trim(),description:String(m.item_description??m.description??"").trim(),qty:String(m.item_quantity??m.qty??""),unit:String(m.item_unit??m.unit??"Unit")})):M,G=J(j);O(m=>m.map(g=>g.id===$?{...g,jobOrderCode:u.job_order_code||g.jobOrderCode,purchaseOrder:u.po_number||g.purchaseOrder,productNo:u.product_no||g.productNo,quantity:Number(u.quantity)||g.quantity,start:u.start_date||g.start,completedDate:u.complete_date||g.completedDate,productionTime:u.production_time||g.productionTime,supplier:u.supplier??g.supplier,supplierDate:u.supplier_date??g.supplierDate,recipient:u.recipient??g.recipient,recipientDate:u.recipient_date??g.recipientDate,responsible:[String(u.responsible_sales_person||"").trim(),String(u.responsible_production_person||"").trim()].filter(Boolean).join(" / ")||g.responsible,customer:u.customer_name||g.customer,componentStatus:G||u.component_status||g.componentStatus||"",items:j}:g)),P(null),y(null),N([])}catch{}},children:"Save"})]})]})]})})}),le&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-30",onClick:()=>R(!1),children:e.jsx("div",{className:"absolute left-1/2 top-20 -translate-x-1/2 w-[960px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"New Manufacturing Order"})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>R(!1),children:"✕"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-3",children:[e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Job Order Code"}),e.jsx("input",{value:l.jobOrderCode,onChange:t=>b({...l,jobOrderCode:t.target.value}),placeholder:"e.g. JO-001",className:"w-full border-b border-gray-300 px-2 py-1 focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Purchase Order"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:l.purchaseOrder,onChange:t=>{b({...l,purchaseOrder:t.target.value}),K(!0)},onFocus:()=>K(!0),placeholder:"e.g. PO-1234",className:"w-full border-b border-gray-300 px-2 py-1 focus:outline-none"}),xe&&l.purchaseOrder&&(()=>{const t=l.purchaseOrder.toLowerCase(),r=Array.from(new Set([...p.map(s=>String(s.ref||"").trim()).filter(Boolean),...poList.map(s=>String(s.poNumber||"").trim()).filter(Boolean),...ge])).filter(s=>s.toLowerCase().includes(t)).slice(0,8);return r.length?e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto",children:r.map((s,n)=>e.jsx("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-gray-700",onClick:()=>be(s),children:s},`${s}-${n}`))}):null})()]})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Item code"}),e.jsx("input",{value:l.productNo,onChange:t=>b({...l,productNo:t.target.value}),placeholder:"e.g. LCM-001",className:"w-full border-b border-gray-300 px-2 py-1 focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Product"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:l.product,onChange:t=>b({...l,product:t.target.value}),placeholder:"Product to build...",className:"w-full border-b border-gray-300 px-2 py-1 focus:outline-none"}),e.jsx("button",{className:"btn-pill px-3",children:"▾"})]})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Unit"}),e.jsx("input",{value:l.unit,onChange:t=>b({...l,unit:t.target.value}),className:"w-28 rounded-md border border-gray-300 px-2 py-1"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Quantity"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("input",{type:"number",value:l.quantity,onChange:t=>b({...l,quantity:Number(t.target.value)}),className:"w-28 rounded-md border border-gray-300 px-2 py-1"})})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Total Quantity"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("input",{type:"number",value:l.totalQuantity,onChange:t=>b({...l,totalQuantity:Number(t.target.value)}),className:"w-28 rounded-md border border-gray-300 px-2 py-1"})})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Start Date"}),e.jsx("input",{type:"datetime-local",value:l.scheduledDate,onChange:t=>b({...l,scheduledDate:t.target.value}),className:"w-64 rounded-md border border-gray-300 px-2 py-1"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Completed Date"}),e.jsx("input",{type:"datetime-local",value:l.completedDate,onChange:t=>b({...l,completedDate:t.target.value}),className:"w-64 rounded-md border border-gray-300 px-2 py-1"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Production Time"}),e.jsx("input",{value:l.productionTime,onChange:t=>b({...l,productionTime:t.target.value}),placeholder:"e.g. 2 Days",className:"w-64 rounded-md border border-gray-300 px-2 py-1"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Responsible"}),e.jsx("input",{value:l.responsible,onChange:t=>b({...l,responsible:t.target.value}),placeholder:"Person responsible",className:"w-64 rounded-md border border-gray-300 px-2 py-1"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Customer Company"}),e.jsx("input",{value:l.customer,onChange:t=>b({...l,customer:t.target.value}),placeholder:"Add customer company",className:"w-64 rounded-md border border-gray-300 px-2 py-1"})]}),e.jsxs("div",{className:"grid grid-cols-[160px_1fr] items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Priority"}),e.jsxs("select",{value:l.priority,onChange:t=>b({...l,priority:t.target.value}),className:"w-64 rounded-md border border-gray-300 px-2 py-1",children:[e.jsx("option",{value:"None",children:"None"}),e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]})]})}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"btn-pill",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn-pill",onClick:async()=>{var n;const t=l.purchaseOrder&&l.purchaseOrder.trim()?l.purchaseOrder.trim():`WH/MO/${String((((n=p[0])==null?void 0:n.id)||0)+1).padStart(5,"0")}`,r=String(l.jobOrderCode||"").trim()||Se(),s={job_order_code:r,po_number:String(l.purchaseOrder||"").trim(),write_customer_name:String(l.customer||"").trim(),product:String(l.product||"").trim(),product_no:String(l.productNo||"").trim(),quantity:Number(l.quantity)||1,start_date:String(l.scheduledDate||"").slice(0,10)||null,complete_date:String(l.completedDate||"").slice(0,10)||null,production_time:String(l.productionTime||"").trim(),responsible_sales_person:String(l.responsible||"").trim()};try{const i=await fetch(`${S}/api/manufacturing_orders/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok){const m=await i.text().catch(()=>"");alert(`Failed to save: ${i.status}${m?` — ${m}`:""}`);return}const a=await i.json(),x=Array.isArray(a.items)?a.items.map(m=>({itemCode:String(m.item??m.itemCode??"").trim(),description:String(m.item_description??m.description??"").trim(),qty:String(m.item_quantity??m.qty??""),unit:String(m.item_unit??m.unit??"Unit")})):[],u=J(x),G=[{id:a.id,ref:t,jobOrderCode:a.job_order_code||r,purchaseOrder:a.po_number||s.po_number||"",start:a.start_date||s.start_date||"",productNo:a.product_no||s.product_no||"",product:a.product||s.product||"Untitled",unit:l.unit||"Unit",completedDate:a.complete_date||s.complete_date||"",productionTime:a.production_time||s.production_time||"",responsible:[String(a.responsible_sales_person||"").trim(),String(a.responsible_production_person||"").trim()].filter(Boolean).join(" / ")||s.responsible_sales_person||"",nextActivity:"",customer:a.customer_name||s.write_customer_name||"",componentStatus:u||a.component_status||"",quantity:Number(a.quantity)||s.quantity||1,totalQuantity:Number(a.quantity)||s.quantity||1,state:a.state||"",priority:l.priority||"None",favorite:!1,selected:!1,items:x},...p];v(G),R(!1),b({product:"",productNo:"",jobOrderCode:"",purchaseOrder:"",unit:"Unit",quantity:1,totalQuantity:1,scheduledDate:"",completedDate:"",productionTime:"",responsible:"",priority:"None",customer:""})}catch(i){alert("Failed to save: "+((i==null?void 0:i.message)||"Unknown error"))}},children:"Add"})]})]})})}),ae&&ke.createPortal(e.jsxs("div",{className:"print-portal",children:[e.jsx("style",{children:`
              @media print {
                body > *:not(.print-portal) { display: none !important; }
                .print-portal { 
                  display: block !important; 
                  position: absolute; 
                  top: 0; 
                  left: 0; 
                  width: 100%; 
                  background: white; 
                  z-index: 9999;
                }
                @page { margin: 0; size: auto; }
              }
              .print-portal { display: none; }
            `}),e.jsx(Ie,{order:ae})]}),document.body)]})}Ce.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(qe,{children:e.jsx(Le,{})})}));
