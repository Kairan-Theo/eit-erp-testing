import{R as k,j as t,a as c}from"./index-BHXMZ0-J.js";import{c as S,N as A,f as C,A as m}from"./navigation-B0IDt7ps.js";import{L as E}from"./language-context-DF7eV6qf.js";import{T}from"./toaster-CI8ohmio.js";import{T as u}from"./trash-D7KEJc6k.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=S("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);function I(){const[r,l]=c.useState([]),[p,$]=c.useState(""),[w,h]=c.useState(!1),d=async()=>{try{const e=localStorage.getItem("authToken"),a={"Cache-Control":"no-store",...e?{Authorization:`Token ${e}`}:{}},s=await fetch(`${m}/api/notifications/`,{headers:a});if(s.ok){const i=await s.json();if(Array.isArray(i)&&i.length>0){l(i);return}}const o=JSON.parse(localStorage.getItem("notifications")||"[]"),x=(Array.isArray(o)?o:[]).map(i=>({id:i.id,message:i.message,created_at:i.timestamp,is_read:!i.unread,type:i.type||"info"}));l(x)}catch(e){console.error("Failed to fetch notifications:",e);let a=[];try{const o=JSON.parse(localStorage.getItem("notifications")||"[]");a=Array.isArray(o)?o:[]}catch{}const s=a.map(o=>({id:o.id,message:o.message,created_at:o.timestamp,is_read:!o.unread,type:o.type||"info"}));l(s)}};c.useEffect(()=>{d();const e=()=>d();window.addEventListener("notificationUpdated",e),window.addEventListener("storage",e);const a=setInterval(d,5e3);return()=>{window.removeEventListener("notificationUpdated",e),window.removeEventListener("storage",e),clearInterval(a)}},[]);const b=async e=>{l(a=>a.map(s=>s.id===e?{...s,is_read:!0}:s));try{const a=JSON.parse(localStorage.getItem("notifications")||"[]"),s=Array.isArray(a)?a:[];if(s.some(o=>o.id===e)){const o=s.map(n=>n.id===e?{...n,unread:!1}:n);localStorage.setItem("notifications",JSON.stringify(o))}}catch{}try{const a=localStorage.getItem("authToken");a&&await fetch(`${m}/api/notifications/read/`,{method:"POST",headers:{Authorization:`Token ${a}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})}),window.dispatchEvent(new Event("notificationUpdated"))}catch(a){console.error("Failed to mark as read",a)}},N=async()=>{l(e=>e.map(a=>({...a,is_read:!0})));try{const e=JSON.parse(localStorage.getItem("notifications")||"[]"),s=(Array.isArray(e)?e:[]).map(o=>({...o,unread:!1}));localStorage.setItem("notifications",JSON.stringify(s))}catch{}try{const e=localStorage.getItem("authToken");if(e){const a=r.filter(s=>!s.is_read);a.length>0&&await Promise.all(a.map(s=>fetch(`${m}/api/notifications/read/`,{method:"POST",headers:{Authorization:`Token ${e}`,"Content-Type":"application/json"},body:JSON.stringify({id:s.id})})))}window.dispatchEvent(new Event("notificationUpdated"))}catch(e){console.error("Failed to mark all as read",e)}},v=async(e,a)=>{a&&a.stopPropagation(),l(s=>s.filter(o=>o.id!==e));try{const s=JSON.parse(localStorage.getItem("notifications")||"[]"),o=Array.isArray(s)?s:[];if(o.some(n=>n.id===e)){const n=o.filter(x=>x.id!==e);localStorage.setItem("notifications",JSON.stringify(n))}}catch{}try{const s=localStorage.getItem("authToken");s&&((await fetch(`${m}/api/notifications/${e}/`,{method:"DELETE",headers:{Authorization:`Token ${s}`}})).ok||console.warn("Delete might not be implemented on backend or not found")),window.dispatchEvent(new Event("notificationUpdated"))}catch(s){console.error("Failed to delete notification",s)}},j=async()=>{l([]),h(!1);try{localStorage.setItem("notifications",JSON.stringify([]))}catch{}try{const e=localStorage.getItem("authToken");e&&await Promise.all(r.map(a=>fetch(`${m}/api/notifications/${a.id}/`,{method:"DELETE",headers:{Authorization:`Token ${e}`}}))),window.dispatchEvent(new Event("notificationUpdated"))}catch(e){console.error("Failed to clear all",e),d()}},g=c.useMemo(()=>{const e=p.trim().toLowerCase();return e?r.filter(a=>(a.message||"").toLowerCase().includes(e)):r},[r,p]),f=r.filter(e=>!e.is_read).length;return t.jsx(E,{children:t.jsxs("div",{className:"min-h-screen bg-slate-50",children:[t.jsx(A,{}),t.jsx(T,{}),t.jsxs("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Notifications"}),t.jsxs("p",{className:"text-slate-500 mt-1",children:["You have ",t.jsx("span",{className:"font-semibold text-blue-600",children:f})," unread messages"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:d,className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 shadow-sm",children:"Refresh"}),t.jsxs("button",{onClick:N,disabled:f===0,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                  ${f===0?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm"}`,children:[t.jsx(y,{className:"w-4 h-4"}),"Mark all read"]}),w?t.jsxs("div",{className:"flex items-center gap-2 bg-red-50 px-3 py-1.5 rounded-lg border border-red-100",children:[t.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Are you sure?"}),t.jsx("button",{onClick:j,className:"px-3 py-1 bg-red-600 text-white text-xs font-bold rounded hover:bg-red-700",children:"Yes"}),t.jsx("button",{onClick:()=>h(!1),className:"px-3 py-1 bg-white text-slate-600 text-xs font-bold rounded border hover:bg-slate-50",children:"No"})]}):t.jsxs("button",{onClick:()=>h(!0),disabled:r.length===0,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                    ${r.length===0?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-white text-red-600 border border-red-200 hover:bg-red-50"}`,children:[t.jsx(u,{className:"w-4 h-4"}),"Clear all"]})]})]}),t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:g.length===0?t.jsxs("div",{className:"p-12 text-center text-slate-400",children:[t.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(y,{className:"w-8 h-8 text-slate-300"})}),t.jsx("p",{className:"text-lg font-medium text-slate-600",children:"All caught up!"}),t.jsx("p",{className:"text-sm",children:"No notifications to display"})]}):t.jsx("div",{className:"divide-y divide-slate-100",children:g.map(e=>t.jsxs("div",{onClick:()=>b(e.id),className:`p-4 hover:bg-slate-50 transition-colors cursor-pointer group flex gap-4 items-start
                      ${e.is_read?"":"bg-blue-50/50"}`,children:[t.jsx("div",{className:`mt-2 w-2 h-2 rounded-full flex-shrink-0 
                      ${e.is_read?"bg-transparent":"bg-blue-600"}`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-sm ${e.is_read?"text-slate-600":"font-semibold text-slate-900"}`,children:e.message}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:(()=>{try{return C(new Date(e.created_at),"MMM d, h:mm a")}catch{return"Just now"}})()})]}),t.jsx("button",{onClick:a=>v(e.id,a),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-all",title:"Delete notification",children:t.jsx(u,{className:"w-4 h-4"})})]},e.id))})})]})]})})}k.createRoot(document.getElementById("root")).render(t.jsx(c.StrictMode,{children:t.jsx(I,{})}));
