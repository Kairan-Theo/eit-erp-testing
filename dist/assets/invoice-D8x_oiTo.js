import{a as p,j as e,R as W}from"./index-BHXMZ0-J.js";import{N as X,A as O,f as L}from"./navigation-B0IDt7ps.js";import{C as Z}from"./customer-combobox-DFf8l8BL.js";import{C as ee}from"./combobox-BN2NY8Fn.js";import{A as se}from"./arrow-left-COoKEq45.js";import{R as te}from"./receipt-DldeSoSC.js";import{P as re}from"./plus-BuoTYnGG.js";import{p as z,C as ae}from"./parseISO-BxmDVPrG.js";import{g as ne,D as ie}from"./DayPicker-Cy1TBD3b.js";import{L as le}from"./language-context-DF7eV6qf.js";import"./check-CiAOFjR6.js";import"./addWeeks-yWatJi1q.js";function Q({value:s,onChange:g,placeholder:b="DD/MM/YYYY"}){const[d,j]=p.useState(!1),v=p.useRef(null),c=ne(),y=(()=>{try{return s?z(s):void 0}catch{return}})(),f=(()=>{try{return y?L(y,"dd/MM/yyyy"):""}catch{return""}})();return p.useEffect(()=>{if(!d)return;const u=t=>{const o=v.current;o&&!o.contains(t.target)&&j(!1)},N=t=>{t.key==="Escape"&&j(!1)};return document.addEventListener("mousedown",u),document.addEventListener("touchstart",u,{passive:!0}),document.addEventListener("keydown",N),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("touchstart",u),document.removeEventListener("keydown",N)}},[d]),e.jsxs("div",{ref:v,className:"relative inline-block w-full",children:[e.jsx("input",{type:"text",value:f,placeholder:b,onClick:()=>j(u=>!u),readOnly:!0,className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),e.jsx("button",{type:"button",onClick:()=>j(u=>!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700","aria-label":"Open calendar",children:e.jsx(ae,{className:"size-4","aria-hidden":"true"})}),d&&e.jsx("div",{onMouseDown:u=>u.stopPropagation(),className:"absolute left-1/2 -translate-x-1/2 top-[calc(100%+2px)] z-50 bg-white border border-slate-200 rounded-[22px] shadow-xl p-4 w-[340px]",children:e.jsx(ie,{mode:"single",selected:y,onSelect:u=>{if(!u)return;const N=L(u,"yyyy-MM-dd");g(N)},captionLayout:"buttons",classNames:{root:`w-fit ${c.root}`,months:`flex flex-col ${c.months}`,month:`rounded-2xl pt-8 ${c.month}`,caption:`relative h-8 ${c.caption}`,nav:`absolute left-3 right-3 top-0 flex items-center justify-between ${c.nav}`,nav_button:`p-2 rounded-full hover:bg-slate-100 ${c.nav_button}`,nav_button_previous:`${c.nav_button_previous}`,nav_button_next:`${c.nav_button_next}`,caption_label:`absolute left-1/2 -translate-x-1/2 top-0 h-8 leading-8 text-center font-semibold uppercase tracking-wide text-[#2D4485] ${c.caption_label}`,table:"w-full border-collapse",weekdays:`flex justify-between border-b border-slate-200 pb-2 ${c.weekdays}`,weekday:`text-slate-500 flex-1 text-sm text-center ${c.weekday}`,week:`grid grid-cols-7 mt-2 ${c.week}`,day:`mx-auto size-10 flex items-center justify-center rounded-full hover:bg-blue-50 ${c.day}`,today:`bg-[#D6E4FF] text-[#2D4485] font-semibold ${c.today}`,outside:`text-slate-400 ${c.outside}`,disabled:`${c.disabled}`},modifiersClassNames:{selected:"border-2 border-[#2D4485]/30 !bg-transparent text-[#2D4485] font-semibold"}})})]})}function M(s){if(!s||s===0)return"ศูนย์บาทถ้วน";s=Number(s).toFixed(2);let[g,b]=s.split(".");const d=["ศูนย์","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],j=["","สิบ","ร้อย","พัน","หมื่น","แสน","ล้าน"];function v(y){let f="",u=y.length;for(let N=0;N<u;N++){let t=parseInt(y.charAt(N)),o=u-N-1;t!==0&&(o===0&&t===1&&u>1?f+="เอ็ด":o===1&&t===2?f+="ยี่":o===1&&t===1?f+="":f+=d[t],o===0?f+="":o===1?f+="สิบ":f+=j[o])}return f}let c="";if(parseInt(g)>0){if(g.length>6){let y=g.substring(0,g.length-6),f=g.substring(g.length-6);c+=v(y)+"ล้าน"+v(f)}else c+=v(g);c+="บาท"}return parseInt(b)>0?c+=v(b)+"สตางค์":c+="ถ้วน",c}function oe(){const[s,g]=p.useState({company:"",address:"",taxId:"",telephone:"",fax:"",attn:"",div:"",mobile:"",email:""}),b=()=>{const a=[];try{for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);if(i&&i.startsWith("history:"))try{const x=JSON.parse(localStorage.getItem(i));x&&Array.isArray(x.invoices)&&a.push(...x.invoices)}catch{}}}catch(n){console.error("Error reading localStorage",n)}const l=new Date().getFullYear(),m=a.map(n=>{var i;return String(n.number||((i=n.details)==null?void 0:i.number)||"")}).map(n=>{const i=n.match(new RegExp(`^VOI ${l}-(\\d{4})$`,"i"));return i?parseInt(i[1],10):null}).filter(n=>Number.isFinite(n)),r=m.length?Math.max(...m)+1:1;return`VOI ${l}-${String(r).padStart(4,"0")}`},[d,j]=p.useState({number:b(),date:new Date().toISOString().slice(0,10),dueDate:"",poNo:"",paymentType:"",currency:"THB",notes:"",paymentTermsDays:7,sourceQuotationNumber:"",salesPerson:"",eit:null,eitAddress:"",eitTelephone:"",eitFax:"",onBehalfOf:""}),[v,c]=p.useState([]),[y,f]=p.useState([]),[u,N]=p.useState([]);p.useEffect(()=>{fetch(`${O}/api/eits/`).then(a=>a.json()).then(a=>{Array.isArray(a)?c(a):(console.error("EIT data is not an array:",a),c([]))}).catch(a=>{console.error("Error loading EITs",a),c([])})},[]),p.useEffect(()=>{fetch(`${O}/api/deals/`).then(a=>a.json()).then(a=>{if(Array.isArray(a)){const l={};a.forEach(m=>{m.customer_name&&!l[m.customer_name]&&(l[m.customer_name]=m)}),f(Object.values(l))}}).catch(a=>console.error("Error loading deals for customers",a))},[]),p.useEffect(()=>{fetch(`${O}/api/customer_purchase_orders/`).then(a=>a.json()).then(a=>{if(Array.isArray(a)){const l=[...new Set(a.map(m=>m.po_number).filter(Boolean))];N(l)}}).catch(a=>console.error("Error loading customer purchase orders",a))},[]);const[t,o]=p.useState([{product:"",description:"",qty:1,price:0,tax:0,unit:"pcs"}]),[h,E]=p.useState(null),[R,D]=p.useState(null);p.useEffect(()=>{const a=new URLSearchParams(window.location.search),l=a.get("key"),m=a.get("index");if(l&&m){if(E(l),D(m),l==="api")fetch(`${O}/api/invoices/${m}/`).then(r=>{if(!r.ok)throw new Error("Failed to fetch");return r.json()}).then(r=>{g(r.customer||{company:"",address:"",taxId:"",telephone:"",fax:"",attn:"",div:"",mobile:"",email:""}),j(n=>{var i,x,w,T,S,A,I,$,F,P,q,U,J;return{...n,...r.details,number:r.number,eit:r.eit||((i=r.eit_details)==null?void 0:i.id)||"",salesPerson:((x=r.details)==null?void 0:x.salesPerson)||((w=r.eit_details)==null?void 0:w.organization_name)||"",onBehalfOf:((T=r.details)==null?void 0:T.onBehalfOf)||((S=r.eit_details)==null?void 0:S.organization_name)||"",eitAddress:((A=r.details)==null?void 0:A.eitAddress)||((I=r.eit_details)==null?void 0:I.address)||"",eitTelephone:(($=r.details)==null?void 0:$.eitTelephone)||((F=r.eit_details)==null?void 0:F.eit_telephone)||"",eitFax:((P=r.details)==null?void 0:P.eitFax)||((q=r.eit_details)==null?void 0:q.eit_fax)||"",eitMobile:((U=r.details)==null?void 0:U.eitMobile)||((J=r.eit_details)==null?void 0:J.eit_mobile)||""}}),Array.isArray(r.items)&&r.items.length>0&&o(r.items)}).catch(r=>console.error("Error loading invoice from API",r));else try{const r=JSON.parse(localStorage.getItem(l));if(r){const n=r.invoices||[];if(n[m]){const i=n[m];g(i.customer),j(i.details),o(i.items)}}}catch(r){console.error("Error loading from localStorage",r)}return}try{const r=localStorage.getItem("confirmedQuotation");if(r){const n=JSON.parse(r);g(i=>{var x,w,T,S,A,I;return{...i,company:((x=n.customer)==null?void 0:x.company)||((w=n.customer)==null?void 0:w.name)||"",address:((T=n.customer)==null?void 0:T.billingAddress1)||((S=n.customer)==null?void 0:S.address)||"",email:((A=n.customer)==null?void 0:A.email)||"",telephone:((I=n.customer)==null?void 0:I.phone)||""}}),o(Array.isArray(n.items)&&n.items.length?n.items.map(i=>({...i,unit:i.unit||"pcs"})):[{product:"",description:"",qty:1,price:0,tax:0,unit:"pcs"}]),j(i=>{var I,$,F,P;const x=((I=n.details)==null?void 0:I.date)||i.date,w=Number((($=n.details)==null?void 0:$.paymentTermsDays)??i.paymentTermsDays),T=new Date(x),S=new Date(T);Number.isNaN(w)||S.setDate(S.getDate()+w);const A=i.number||b();return{...i,...n.details,currency:((F=n.details)==null?void 0:F.currency)||i.currency,date:x,paymentTermsDays:w,number:A,dueDate:S.toISOString().slice(0,10),sourceQuotationNumber:((P=n.details)==null?void 0:P.number)||i.sourceQuotationNumber||""}}),localStorage.removeItem("confirmedQuotation");return}}catch{}j(r=>{const n=new Date(r.date||new Date().toISOString().slice(0,10)),i=r.number||b(),x=new Date(n);return x.setDate(x.getDate()+Number(r.paymentTermsDays||0)),{...r,number:i,dueDate:x.toISOString().slice(0,10)}})},[]),p.useEffect(()=>{try{const a=new Date(d.date);if(isNaN(a.getTime()))return;const l=new Date(a);l.setDate(l.getDate()+Number(d.paymentTermsDays||0));const m=l.toISOString().slice(0,10);j(r=>({...r,dueDate:m}))}catch{}},[d.date,d.paymentTermsDays]);const k=t.reduce((a,l)=>a+(Number(l.qty)||0)*(Number(l.price)||0),0),_=k*.07,C=k+_,V=()=>o(a=>[...a,{product:"",description:"",qty:1,price:0,tax:0,unit:"pcs"}]),Y=a=>o(l=>l.filter((m,r)=>r!==a)),G=(a,l,m)=>o(r=>r.map((n,i)=>i===a?{...n,[l]:l==="qty"||l==="price"||l==="tax"?m===""?"":Number(m):m}:n)),H=async()=>{const a={customer:s,details:d,items:t,totals:{subtotal:k,taxTotal:_,total:C}};localStorage.setItem("invoiceDraft",JSON.stringify(a));try{const l=`history:${s.email||s.telephone||s.company||d.number}`,m=JSON.parse(localStorage.getItem(l)||"{}"),r=Array.isArray(m.invoices)?m.invoices:[];r.push({...a,savedAt:new Date().toISOString()}),localStorage.setItem(l,JSON.stringify({...m,customer:s,invoices:r}))}catch{}try{const l=localStorage.getItem("authToken"),m={number:d.number,customer:s,items:t,details:d,totals:{subtotal:k,taxTotal:_,total:C,thaiText:M(C)},eit:d.eit,eit_name:d.salesPerson,eit_address:d.eitAddress,eit_phone:d.eitTelephone,eit_fax:d.eitFax,eit_mobile:d.eitMobile};let r=`${O}/api/invoices/`,n="POST";h==="api"&&R&&(r=`${O}/api/invoices/${R}/`,n="PUT");const i={"Content-Type":"application/json"};l&&(i.Authorization=`Token ${l}`);const x=await fetch(r,{method:n,headers:i,body:JSON.stringify(m)});if(x.ok)return alert("Invoice saved to database successfully!"),!0;{const w=await x.text();return console.error("Failed to save invoice to API:",x.status,w),alert(`Failed to save to database: ${x.status}`),!1}}catch(l){return console.error("Error in confirm function:",l),alert("Network error saving to database"),!1}},K=()=>window.print(),B=a=>typeof a=="number"?a:a?parseFloat(String(a).replace(/,/g,"")):0;return{customer:s,setCustomer:g,details:d,setDetails:j,eitOptions:v,customerOptions:y,poOptions:u,items:t,addItem:V,removeItem:Y,updateItem:G,subtotal:k,taxTotal:_,total:C,confirm:H,print:K,exportPdf:async()=>{try{const a={details:d,customer:s,items:t.map(i=>({...i,qty:B(i.qty),price:B(i.price)})),totals:{subtotal:k,taxTotal:_,total:C,thaiText:M(C)}},l=await fetch(`${O}/api/generate-invoice-pdf/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error("Failed to generate PDF");const m=await l.blob(),r=window.URL.createObjectURL(m),n=document.createElement("iframe");n.style.display="none",n.src=r,document.body.appendChild(n),setTimeout(()=>{n.contentWindow.focus(),n.contentWindow.print()},500),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(r)},6e4)}catch(a){console.error("PDF generation failed",a),alert("Failed to generate PDF")}},emailTo:()=>{if(!s.email)return{ok:!1,message:"No customer email provided"};const a=encodeURIComponent(`Invoice ${d.number}`),l=s.address||"-",m=encodeURIComponent(`Dear ${s.attn||s.company},

Please find your invoice ${d.number} dated ${d.date}.

Total: ${C.toFixed(2)} ${d.currency}
Due Date: ${d.dueDate||"-"}
Invoice Address:
${l}

Notes:
${d.notes||"-"}

Regards,
EIT Lasertechnik`),r=`mailto:${s.email}?subject=${a}&body=${m}`;window.location.href=r;try{const n=`history:${s.email||s.telephone||s.company||d.number}`,i=JSON.parse(localStorage.getItem(n)||"{}"),x=Array.isArray(i.emails)?i.emails:[];x.push({type:"invoice",number:d.number,sentAt:new Date().toISOString()}),localStorage.setItem(n,JSON.stringify({...i,customer:s,emails:x}))}catch{}return{ok:!0}}}}function de({inv:s}){s.details.currency==="THB"||s.details.currency==="USD"||s.details.currency==="EUR"||s.details.currency==="GBP"||s.details.currency;const g=s.details.onBehalfOf||"EIT LASERTECHNIK CO.,LTD",b=g.toUpperCase().includes("EINSTEIN"),d=b?"บริษัท ไอน์สไตน์ อินดัสเตรียล เทคนิค คอร์ปอเรชั่น จำกัด":"บริษัท อีไอที เลเซอร์เทคนิค จำกัด",j=b?"1/120 Soi Ramkhamhaeng 184, Minburi, Minburi, Bangkok 10510 Thailand":"118/20 Soi Ramkhamhaeng 184, Minburi, Minburi, Bangkok 10510 Thailand",v=b?"02-052-9544":"02-xxx-xxxx",c=b?"02-052-9544":"02-xxx-xxxx",y=b?"0105547001928":"010555xxxxxxx",f=s.customer.company||s.customer.name||"",u=s.customer.taxId||"",N=s.customer.address||s.customer.billingAddress1||"",t=s.details.paymentType||"",o=s.details.poNo||"",h=s.details.date?L(z(s.details.date),"dd/MM/yyyy"):"",E=s.details.dueDate?L(z(s.details.dueDate),"dd/MM/yyyy"):"",R=window.location.origin+(b?"/Einstein%20header.png":"/EIT%20header.png");return e.jsxs("div",{className:"mx-auto bg-white text-black font-sans p-[10px] w-full h-auto relative text-[10px] leading-tight",children:[e.jsx("div",{className:"mb-1 flex items-center justify-center",children:e.jsx("img",{src:R,alt:"Header",className:"w-full h-auto object-contain"})}),e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"border border-black p-2 w-[60%] min-h-[80px]",children:[e.jsx("div",{className:"font-normal text-xs",children:d}),e.jsx("div",{className:"font-normal text-xs",children:g}),e.jsx("div",{className:"mt-1",children:j}),e.jsxs("div",{className:"mt-1",children:["TEL : ",v,"    Fax : ",c]}),e.jsxs("div",{className:"mt-1 flex justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"font-normal",children:"เลขประจำตัวผู้เสียภาษีอากร :"}),e.jsx("span",{children:y})]}),e.jsx("span",{className:"font-normal",children:"สำนักงานใหญ่"})]})]}),e.jsxs("div",{className:"w-[38%] pl-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm",children:"ใบแจ้งหนี้"}),e.jsx("div",{className:"font-bold text-sm",children:"INVOICE"}),e.jsx("div",{className:"text-[10px]",children:"ไม่ใช่ใบกำกับภาษี"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-sm",children:"ต้นฉบับ"}),e.jsx("div",{className:"font-bold text-sm",children:"Original"})]})]}),e.jsxs("div",{className:"text-right text-xs",children:[e.jsxs("div",{className:"flex justify-end gap-2 mb-1",children:[e.jsxs("span",{className:"w-24",children:[e.jsx("span",{className:"font-bold",children:"เลขที่"}),e.jsx("span",{className:"font-normal",children:" (No.)"})]}),e.jsxs("span",{children:["EIT ",s.details.number]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("span",{className:"w-24",children:[e.jsx("span",{className:"font-bold",children:"วันที่"}),e.jsx("span",{className:"font-normal",children:" (Issue Date)"})]}),e.jsx("span",{children:h})]})]})]})]}),e.jsxs("div",{className:"border border-black border-b-0 flex",children:[e.jsxs("div",{className:"w-[70%] border-r border-black p-2 min-h-[90px]",children:[e.jsxs("div",{className:"flex mb-1",children:[e.jsx("div",{className:"font-bold w-32",children:"สำนักงานใหญ่"}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("span",{className:"font-bold",children:"เลขประจำตัวผู้เสียภาษี"}),e.jsx("span",{children:u})]})]}),e.jsx("div",{className:"mb-1 font-normal",children:"ลูกค้า (customer)"}),e.jsxs("div",{className:"flex mb-1",children:[e.jsx("div",{className:"w-32 font-normal",children:"ชื่อ"}),e.jsx("div",{className:"flex-1",children:f})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-32 font-normal",children:"ที่อยู่"}),e.jsx("div",{className:"w-2/3 break-words",children:N})]})]}),e.jsxs("div",{className:"w-[30%] flex flex-col",children:[e.jsxs("div",{className:"flex-1 border-b border-black p-1 text-center flex flex-col justify-center",children:[e.jsx("div",{className:"font-normal",children:"ประเภทการจ่ายเงิน (Payment Type)"}),e.jsx("div",{className:"mt-1",children:t||"-"})]}),e.jsxs("div",{className:"flex-1 border-b border-black p-1 text-center flex flex-col justify-center",children:[e.jsx("div",{className:"font-normal",children:"วันครบกำหนดชำระเงิน( Due date)"}),e.jsx("div",{className:"mt-1",children:E})]}),e.jsxs("div",{className:"flex-1 p-1 text-center flex flex-col justify-center",children:[e.jsx("div",{className:"font-normal",children:"เลขที่ใบสั่งซื้อ (PO.NO)"}),e.jsx("div",{className:"mt-1",children:o||"-"})]})]})]}),e.jsxs("div",{className:"border border-black border-b-0 flex text-center text-xs bg-gray-100",children:[e.jsxs("div",{className:"w-[55%] border-r border-black p-1",children:[e.jsx("div",{children:"รายการ"}),e.jsx("div",{children:"Description"})]}),e.jsxs("div",{className:"w-[15%] border-r border-black p-1",children:[e.jsx("div",{children:"ราคาขายไม่รวมภาษี"}),e.jsx("div",{children:"Sales (ex.Vat)"})]}),e.jsxs("div",{className:"w-[8%] border-r border-black p-1",children:[e.jsx("div",{children:"จำนวน"}),e.jsx("div",{children:"Qty"})]}),e.jsxs("div",{className:"w-[7%] border-r border-black p-1",children:[e.jsx("div",{children:"หน่วยนับ"}),e.jsx("div",{children:"Unit"})]}),e.jsxs("div",{className:"w-[15%] p-1",children:[e.jsx("div",{children:"จำนวนเงิน (บาท)"}),e.jsx("div",{children:"Amount"})]})]}),e.jsxs("div",{className:"border border-black flex flex-col relative min-h-[300px]",children:[s.items.map((D,k)=>e.jsxs("div",{className:"flex text-xs z-10",children:[e.jsxs("div",{className:"w-[55%] p-1 pl-2 text-left",children:[k+1,". ",D.description||D.product]}),e.jsx("div",{className:"w-[15%] p-1 text-right",children:Number(D.price).toFixed(2)}),e.jsx("div",{className:"w-[8%] p-1 text-center",children:D.qty}),e.jsx("div",{className:"w-[7%] p-1 text-center",children:D.unit}),e.jsx("div",{className:"w-[15%] p-1 text-right",children:(Number(D.qty)*Number(D.price)).toFixed(2)})]},k)),e.jsxs("div",{className:"absolute inset-0 flex pointer-events-none",children:[e.jsx("div",{className:"w-[55%] border-r border-black"}),e.jsx("div",{className:"w-[15%] border-r border-black"}),e.jsx("div",{className:"w-[8%] border-r border-black"}),e.jsx("div",{className:"w-[7%] border-r border-black"}),e.jsx("div",{className:"w-[15%]"})]})]}),e.jsxs("div",{className:"flex border border-black border-t-0",children:[e.jsx("div",{className:"flex-1 border-r border-black"}),e.jsxs("div",{className:"w-[30%]",children:[e.jsxs("div",{className:"flex border-b border-black",children:[e.jsxs("div",{className:"w-[60%] border-r border-black p-1 text-right font-normal text-[10px]",children:[e.jsx("div",{children:"จำนวนเงินสุทธิ"}),e.jsx("div",{children:"Net Amount"})]}),e.jsx("div",{className:"w-[40%] p-1 text-right",children:s.subtotal.toFixed(2)})]}),e.jsxs("div",{className:"flex border-b border-black",children:[e.jsxs("div",{className:"w-[60%] border-r border-black p-1 text-right font-normal text-[10px]",children:[e.jsx("div",{children:"ภาษีมูลค่าเพิ่ม"}),e.jsx("div",{children:"VAT 7%"})]}),e.jsx("div",{className:"w-[40%] p-1 text-right",children:s.taxTotal.toFixed(2)})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-[60%] border-r border-black p-1 text-right font-normal text-[10px]",children:[e.jsx("div",{children:"รวมเป็นมูลค่า"}),e.jsx("div",{children:"Total of sales"})]}),e.jsx("div",{className:"w-[40%] p-1 text-right",children:s.total.toFixed(2)})]})]})]}),e.jsxs("div",{className:"border border-black border-t-0 flex",children:[e.jsxs("div",{className:"w-[25%] border-r border-black p-1 text-center font-normal flex flex-col justify-center",children:[e.jsx("div",{children:"จำนวนเงินรวมทั้งสิ้น"}),e.jsx("div",{children:"(The sum of baht)"})]}),e.jsx("div",{className:"flex-1 p-1 text-center flex items-center justify-center bg-gray-100",children:M(s.total)})]}),e.jsxs("div",{className:"border border-black border-t-0 flex",children:[e.jsx("div",{className:"w-[25%] border-r border-black p-1 text-center font-normal flex flex-col justify-center",children:e.jsx("div",{children:"ชำระเงินโดย"})}),e.jsx("div",{className:"flex-1 p-1"})]}),e.jsxs("div",{className:"border border-black border-t-0 p-2 pt-4 pb-2 flex justify-between text-center text-xs",children:[e.jsxs("div",{className:"w-[30%] flex flex-col pt-2",children:[e.jsx("div",{className:"mt-2 font-normal",children:"ผู้รับสินค้า Receiver"}),e.jsx("div",{className:"mt-6 text-sm",children:"(........................................................)"}),e.jsxs("div",{className:"mt-1 flex justify-center gap-1",children:[e.jsx("span",{children:"วันที่"}),e.jsx("span",{className:"border-b border-dotted border-black w-24"})]})]}),e.jsxs("div",{className:"w-[30%] pt-2",children:[e.jsx("div",{className:"mt-2 font-normal",children:"ผู้ส่งสินค้า Deliverer"}),e.jsx("div",{className:"mt-6 text-sm",children:"(........................................................)"}),e.jsxs("div",{className:"mt-1 flex justify-center gap-1",children:[e.jsx("span",{children:"วันที่"}),e.jsx("span",{className:"border-b border-dotted border-black w-24"})]})]}),e.jsxs("div",{className:"w-[30%] pt-2",children:[e.jsx("div",{className:"mt-2 font-normal",children:"ผู้มีอำนาจลงนาม Authorized Signature"}),e.jsx("div",{className:"mt-6 text-sm",children:"(........................................................)"}),e.jsxs("div",{className:"mt-1 flex justify-center gap-1",children:[e.jsx("span",{children:"วันที่"}),e.jsx("span",{className:"border-b border-dotted border-black w-24"})]})]})]})]})}function ce(){const s=oe(),[g,b]=p.useState(!1),[d,j]=p.useState({open:!1}),[v,c]=p.useState({show:!1,text:""}),[y,f]=p.useState(!1),u=()=>j({open:!1}),N=()=>{j({open:!1});const t=s.emailTo();!t||!t.ok?c({show:!0,text:(t==null?void 0:t.message)||"No email provided"}):c({show:!0,text:"Sent"}),setTimeout(()=>c({show:!1,text:""}),2e3)};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"min-h-screen bg-gray-50",children:[e.jsx(X,{}),y&&e.jsx("div",{className:"fixed inset-0 z-[60] bg-black/50 flex items-center justify-center print:hidden",children:e.jsxs("div",{className:"bg-white rounded-lg p-5 flex flex-col items-center shadow-2xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-[#2D4485] mb-3"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Generating PDF..."}),e.jsx("div",{className:"text-sm text-gray-500 mb-4",children:"Please wait"}),e.jsx("button",{onClick:()=>f(!1),className:"text-xs text-red-500 hover:text-red-700 underline",children:"Cancel / Unfreeze"})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-[55] flex items-center justify-center print:hidden",onClick:()=>b(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 w-[560px] max-w-[95vw] relative",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Create Invoice Form"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Choose how you want to proceed"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900 p-2",onClick:()=>b(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 grid grid-cols-3 gap-4",children:[e.jsx("button",{className:"w-full px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",onClick:()=>{b(!1),window.location.href="/admin.html"},children:"Discard"}),e.jsx("button",{className:"w-full px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6] min-w-[140px]",onClick:async()=>{await s.confirm()&&(window.location.href="/admin.html")},children:"Save Changes"}),e.jsx("button",{className:"w-full px-4 py-2 rounded-md text-[#2D4485] underline underline-offset-2 hover:text-[#3D56A6] min-w-[140px] whitespace-nowrap text-center disabled:opacity-50",disabled:y,onClick:async()=>{f(!0),await new Promise(t=>setTimeout(t,100));try{await s.exportPdf()}catch(t){console.error(t)}finally{f(!1),b(!1)}},children:y?"Generating...":"Download Form"})]})]})}),d.open&&e.jsx("div",{className:"fixed inset-0 z-[55] bg-black/50 flex items-center justify-center print:hidden",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-sm p-5",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Confirm Send"}),e.jsx("div",{className:"text-gray-700 text-sm mb-4",children:"Send invoice to customer email?"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:u,className:"px-3 py-1.5 text-sm rounded-md border border-gray-300 bg-gray-100 text-gray-900 hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{type:"button",onClick:N,className:"px-3 py-1.5 text-sm rounded-md border border-gray-300 bg-gray-100 text-gray-900 hover:bg-[#2D4485] hover:text-white",children:"Confirm"})]})]})}),v.show&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[60] print:hidden",children:e.jsx("div",{className:"bg-[#2D4485] text-white rounded-md shadow-md px-4 py-2 text-sm",children:v.text})}),e.jsxs("div",{className:"max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>window.location.href="/admin.html",className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors",title:"Back to List",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"New Invoice"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Code"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{value:s.details.number,onChange:t=>s.setDetails({...s.details,number:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Invoice number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Date"}),e.jsx(Q,{value:s.details.date,onChange:t=>s.setDetails({...s.details,date:t})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"EIT/Einstein organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From"}),e.jsxs("select",{value:s.details.eit||"",onChange:t=>{const o=t.target.value;if(!o){s.setDetails({...s.details,eit:null,salesPerson:"",onBehalfOf:"",eitAddress:"",eitTelephone:"",eitFax:"",eitMobile:""});return}const h=s.eitOptions.find(E=>String(E.id)===o);h&&s.setDetails({...s.details,eit:h.id,salesPerson:h.organization_name,onBehalfOf:h.organization_name,eitAddress:h.address||"",eitTelephone:h.eit_telephone||"",eitFax:h.eit_fax||"",eitMobile:h.eit_mobile||""})},className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",children:[e.jsx("option",{value:"",children:"Select Organization"}),s.eitOptions.map(t=>e.jsx("option",{value:t.id,children:t.organization_name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:s.details.eitAddress,onChange:t=>s.setDetails({...s.details,eitAddress:t.target.value}),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",rows:"2",placeholder:"Address"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telephone"}),e.jsx("input",{value:s.details.eitTelephone,onChange:t=>s.setDetails({...s.details,eitTelephone:t.target.value}),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Telephone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fax"}),e.jsx("input",{value:s.details.eitFax,onChange:t=>s.setDetails({...s.details,eitFax:t.target.value}),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Fax"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx(Z,{value:s.customer.company,options:s.customerOptions,onChange:t=>{const o=s.customerOptions.find(h=>h.customer_name===t);o?s.setCustomer({...s.customer,company:t,taxId:o.tax_id||s.customer.taxId,address:o.address||s.customer.address,telephone:o.phone||s.customer.telephone,attn:o.contact||s.customer.attn,email:o.email||s.customer.email}):s.setCustomer({...s.customer,company:t})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Code"}),e.jsx("input",{value:s.customer.taxId,onChange:t=>s.setCustomer({...s.customer,taxId:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Tax Code"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:s.customer.address,onChange:t=>s.setCustomer({...s.customer,address:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",rows:"2",placeholder:"Address"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Payment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsx("input",{value:s.details.paymentType,onChange:t=>s.setDetails({...s.details,paymentType:t.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Payment Type"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx(Q,{value:s.details.dueDate,onChange:t=>s.setDetails({...s.details,dueDate:t})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PO No."}),e.jsx(ee,{value:s.details.poNo,onChange:t=>s.setDetails({...s.details,poNo:t}),options:s.poOptions,placeholder:"PO Number"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Invoice Description"}),e.jsxs("button",{onClick:s.addItem,className:"inline-flex items-center gap-2 rounded-full px-4 py-2 bg-[#2D4485]/10 text-[#2D4485] hover:bg-[#2D4485]/15",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Add Item"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-[#2D4485] uppercase text-xs font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b w-16",children:"No."}),e.jsx("th",{className:"p-3 border-b",children:"Description"}),e.jsx("th",{className:"p-3 border-b",children:"Sales (ex. Vat)"}),e.jsx("th",{className:"p-3 border-b",children:"Quantity"}),e.jsx("th",{className:"p-3 border-b",children:"Unit"}),e.jsx("th",{className:"p-3 border-b text-right",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.items.map((t,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition border-b border-gray-100",children:[e.jsx("td",{className:"p-3 text-center text-sm text-gray-700",children:o+1}),e.jsx("td",{className:"p-3",children:e.jsx("textarea",{value:t.description,onChange:h=>s.updateItem(o,"description",h.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none resize-y min-h-[32px]",rows:1,placeholder:"Description"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:t.price,onChange:h=>s.updateItem(o,"price",h.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",min:"0",value:t.qty,onChange:h=>s.updateItem(o,"qty",h.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:t.unit,onChange:h=>s.updateItem(o,"unit",h.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none"})}),e.jsx("td",{className:"p-3 text-right text-sm text-gray-700",children:((Number(t.qty)||0)*(Number(t.price)||0)).toFixed(2)})]},o))})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("div",{className:"w-auto min-w-[250px] space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm gap-8",children:[e.jsx("span",{className:"text-gray-600",children:"Net amount"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.subtotal.toFixed(2)," ",s.details.currency]})]}),e.jsxs("div",{className:"flex justify-between text-sm gap-8",children:[e.jsx("span",{className:"text-gray-600",children:"Vat 7%"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.taxTotal.toFixed(2)," ",s.details.currency]})]}),e.jsxs("div",{className:"flex justify-between text-lg pt-2 border-t border-gray-200 gap-8",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Total of sales"}),e.jsxs("span",{className:"font-bold text-[#2D4485]",children:[s.total.toFixed(2)," ",s.details.currency]})]}),e.jsx("div",{className:"text-right text-base font-bold text-[#2D4485]",children:M(s.total)})]})})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10",onClick:()=>window.location.href="/admin.html",children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:()=>b(!0),children:"Create Invoice Form"})]})]})]}),e.jsx("div",{id:"invoiceArea",children:e.jsx("div",{className:"hidden print:block",id:"invoice-document","aria-hidden":"true",children:e.jsx("div",{className:"print-page",children:e.jsx("div",{className:"invoice",children:e.jsx(de,{inv:s})})})})})]})}W.createRoot(document.getElementById("root")).render(e.jsx(p.StrictMode,{children:e.jsx(le,{children:e.jsx(ce,{})})}));
