import{R as X,j as e,a as x}from"./index-BHXMZ0-J.js";import{A as O,N as Y}from"./navigation-B0IDt7ps.js";const q=({onEdit:p,onDelete:k})=>{const[v,j]=x.useState(!1),N=x.useRef(null);return x.useEffect(()=>{const y=u=>{N.current&&!N.current.contains(u.target)&&j(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]),e.jsxs("div",{className:"relative",ref:N,children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),j(!v)},className:"p-1 hover:bg-gray-100 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})}),v&&e.jsxs("div",{className:"absolute top-full right-0 mt-1 w-24 bg-white rounded-md shadow-xl border border-gray-100 z-50 overflow-hidden ring-1 ring-black/5",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),j(!1),p()},className:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:"Edit"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),j(!1),k()},className:"w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2",children:"Delete"})]})]})},C=({photo:p,onUpload:k})=>e.jsxs("label",{className:"cursor-pointer flex items-center gap-3 group",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:k}),e.jsx("div",{className:`h-10 w-10 rounded-lg border-2 ${p?"border-solid border-gray-200":"border-dashed border-gray-300 group-hover:border-[#3D56A6]"} flex items-center justify-center overflow-hidden transition-colors bg-gray-50 shrink-0`,children:p?e.jsx("img",{src:p,className:"h-full w-full object-cover"}):e.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-[#3D56A6]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-500 group-hover:text-[#3D56A6] transition-colors whitespace-nowrap",children:p?"Change":"Upload"})]});function Z(){const[p,k]=x.useState(()=>{try{const t=JSON.parse(localStorage.getItem("mfgBOMs")||"[]");return Array.isArray(t)?t:[]}catch{return[]}}),v=x.useCallback(t=>{k(t);try{localStorage.setItem("mfgBOMs",JSON.stringify(t))}catch{}},[]),j=x.useCallback(async()=>{try{const s=await fetch(`${O}/api/bom/`);if(s&&s.ok){const r=await s.json(),o=(Array.isArray(r)?r:[]).map(n=>({id:n.id,name:n.product||"",product:n.product||"",version:n.version||"",type:n.type||"",active:!0,productTree:n.productTree||[]}));v(o);return}}catch(s){console.error(s)}try{const s=JSON.parse(localStorage.getItem("mfgBOMs")||"[]"),r=Array.isArray(s)?s:[];if(r.length){k(r);return}}catch{}v([{id:1,name:"LCM Standard",product:"Laser Cladding Machine",version:"v1",type:"Manufacture",active:!0},{id:2,name:"LWM Standard",product:"Laser Welding Machine",version:"v2",type:"Manufacture",active:!0},{id:3,name:"Cake BOM",product:"Cake",version:"v1",type:"Manufacture",active:!1}])},[v]),[N,y]=x.useState(null),[u,m]=x.useState({product:"",version:"",type:"Manufacture",systems:[]}),[T,V]=x.useState(new Set),[E,D]=x.useState(null),W=t=>{const s=new Set(T);s.has(t)?s.delete(t):s.add(t),V(s)},[z,M]=x.useState(!1),[g,f]=x.useState({product:"",version:"",type:"Manufacture",systems:[]}),[b,B]=x.useState([]),[$,S]=x.useState(!1),[L,R]=x.useState(""),H=async()=>{try{b.length>0&&await Promise.all(b.map(async s=>{try{await fetch(`${O}/api/bom/${s}/`,{method:"DELETE"})}catch{}}));const t=p.filter(s=>!b.includes(s.id));v(t)}finally{B([]),S(!1)}},P=[{id:"index",label:"Index"},{id:"product",label:"Product"},{id:"systems",label:"Systems"},{id:"version",label:"Version"},{id:"type",label:"Type"}],I=t=>{if(t.target.checked){const s=w.map(r=>r.id);B(r=>Array.from(new Set([...r,...s])))}else B(s=>s.filter(r=>!w.some(a=>a.id===r)))},_=t=>{B(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},F=t=>{const s=t.productTree;return s&&!Array.isArray(s)?(s.systems||[]).length:Array.isArray(s)?(s||[]).length:0},w=x.useMemo(()=>{const t=String(L||"").toLowerCase().trim();return t?p.filter(s=>String(s.product||"").toLowerCase().includes(t)):p},[p,L]);x.useEffect(()=>{j()},[j]);const U=(t,s)=>{const r=p.map(a=>a.id===t?{...a,productTree:s}:a);v(r)},Q=(t,s)=>{if(!window.confirm("Delete this system?"))return;const r=p.find(d=>d.id===t);if(!r)return;const a=r.productTree||{},n=(Array.isArray(a)?a:a.systems||[]).filter((d,i)=>i!==s);let l;Array.isArray(a)?l=n:l={...a,systems:n},U(t,l)},J=(t,s,r)=>{if(!window.confirm("Delete this component?"))return;const a=p.find(i=>i.id===t);if(!a)return;const o=a.productTree||{},l=(Array.isArray(o)?o:o.systems||[]).map((i,c)=>c!==s?i:{...i,components:(i.components||[]).filter((h,K)=>K!==r)});let d;Array.isArray(o)?d=l:d={...o,systems:l},U(t,d)},A=(t,s)=>{const r=t.target.files[0];if(r){const a=new FileReader;a.onloadend=()=>s(a.result),a.readAsDataURL(r)}},G=(t,s,r)=>{switch(t.id){case"index":return e.jsx("span",{className:"font-medium text-gray-800",children:r+1});case"product":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-[#2D4485] hover:underline font-semibold",onClick:()=>{y(s.id);const a=s.productTree;if(a&&!Array.isArray(a)){const o=(a.systems||[]).map(n=>({name:n.name||"",photo:n.photo,components:(n.components||[]).map(l=>({name:l.name||"",qty:Number(l.qty)||1,photo:l.photo}))}));if(!o.length&&(a.components||[]).length){const n={name:s.product||"",components:(a.components||[]).map(l=>({name:l.name||"",qty:Number(l.qty)||1}))};m({product:s.product||"",version:s.version||"",type:s.type||"Manufacture",photo:a.photo,systems:[n]})}else m({product:s.product||"",version:s.version||"",type:s.type||"Manufacture",photo:a.photo,systems:o})}else if(Array.isArray(a)){const o=(a||[]).map(n=>({name:n.system||"",components:(n.components||[]).map(l=>({name:l.name||"",qty:Number(l.qty)||1}))}));m({product:s.product||"",version:s.version||"",type:s.type||"Manufacture",systems:o})}else m({product:s.product||"",version:s.version||"",type:s.type||"Manufacture",systems:[]})},title:"Edit Settings",children:s.product||"Untitled"}),e.jsx("button",{className:"text-gray-500 hover:text-[#2D4485] p-1 rounded-full hover:bg-gray-100 transition-colors",onClick:()=>W(s.id),title:"Toggle details",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]});case"version":return e.jsx("span",{className:"text-gray-800",children:s.version||"-"});case"type":return e.jsx("span",{className:"text-gray-800",children:s.type||"-"});case"systems":return e.jsx("span",{className:"text-gray-800",children:F(s)});default:return null}};return e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(Y,{}),e.jsx("section",{className:"w-full bg-gray-50",children:e.jsxs("div",{className:"w-full mx-auto p-6 min-h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Bill of Materials"}),e.jsx("button",{className:"inline-flex items-center justify-center px-6 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",title:"New BOM",onClick:()=>M(!0),children:"New BOM"}),e.jsx("button",{className:"hidden",style:{display:"none"},"aria-hidden":"true"}),e.jsx("button",{className:"px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Manufacturing Order",onClick:()=>window.location.href="/manufacturing.html",children:"Manufacturing Orders"}),e.jsx("button",{className:"px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Component",onClick:()=>window.location.href="/products.html",children:"Component"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[b.length>0&&e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("span",{className:"font-medium",children:["Delete (",b.length,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by Product",className:"pl-10 pr-10 py-2 border border-slate-300 rounded-lg text-sm w-80 focus:outline-none focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] transition-all",value:L,onChange:t=>R(t.target.value)}),e.jsx("svg",{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),L&&e.jsx("button",{onClick:()=>R(""),className:"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600 transition-colors",title:"Clear Search",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"text-slate-500 font-medium text-sm",children:L?e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"text-slate-900 font-bold",children:w.length})," of ",e.jsx("span",{className:"text-slate-900 font-bold",children:p.length})," BOMs"]}):e.jsxs("span",{children:["Total: ",e.jsx("span",{className:"text-slate-900 font-bold",children:p.length})," BOMs"]})})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 border-b w-10",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:I,checked:w.length>0&&w.every(t=>b.includes(t.id)),ref:t=>{if(t){const s=b.filter(r=>w.some(a=>a.id===r)).length;t.indeterminate=s>0&&s<w.length}}})}),P.map(t=>e.jsx("th",{className:"p-4 border-b whitespace-nowrap",children:t.label},t.id))]})}),e.jsxs("tbody",{children:[w.map((t,s)=>e.jsxs(x.Fragment,{children:[e.jsxs("tr",{className:`border-b border-gray-100 transition-colors ${b.includes(t.id)?"bg-blue-200 hover:bg-blue-300":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4 border-b w-10",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-[#2D4485] focus:ring-[#2D4485]/20 h-4 w-4",onChange:()=>_(t.id),checked:b.includes(t.id)})}),P.map(r=>e.jsx("td",{className:"p-4 whitespace-nowrap text-gray-600",children:G(r,t,s)},r.id))]}),T.has(t.id)&&e.jsx("tr",{className:"border-t",children:e.jsx("td",{colSpan:P.length+1,className:"p-0",children:(()=>{const r=t.productTree,a=r&&!Array.isArray(r)?r.systems||[]:Array.isArray(r)?(r||[]).map(o=>({name:o.system||"",components:o.components||[]})):[];return e.jsxs("div",{className:"mt-4 border-t border-gray-100 pt-6 animate-in fade-in slide-in-from-top-2 duration-200 overflow-x-auto",children:[e.jsx("style",{children:`
                                  .mm-branch { position: relative; padding-left: 2rem; }
                                  .mm-branch::before { content: ''; position: absolute; left: 0; top: 50%; width: 2rem; height: 1px; background: #e5e7eb; }
                                  .mm-branch::after { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 1px; background: #e5e7eb; }
                                  .mm-branch:first-child::after { top: 50%; }
                                  .mm-branch:last-child::after { bottom: 50%; }
                                  .mm-branch:only-child::after { display: none; }
                                  .mm-branch:only-child::before { width: 2rem; }
                                `}),e.jsxs("div",{className:"flex items-center p-4 min-w-max",children:[e.jsxs("div",{className:"flex-shrink-0 z-10 border border-gray-200 bg-white rounded-lg p-2 shadow-sm flex items-center gap-3 min-w-[200px] hover:shadow-md transition-shadow relative pr-8",children:[r!=null&&r.photo?e.jsx("img",{src:r.photo,className:"w-10 h-10 object-cover rounded-md border border-gray-100 cursor-zoom-in",onClick:o=>{o.stopPropagation(),D(r.photo)}}):e.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-md border border-gray-100 flex items-center justify-center text-[8px] text-gray-400",children:"No Photo"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-[#3D56A6] uppercase tracking-wider",children:"Product"}),e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:t.product||"Untitled"})]}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(q,{onEdit:()=>{y(t.id);const o=r&&!Array.isArray(r)?(r.systems||[]).map(n=>({name:n.name||"",photo:n.photo,components:(n.components||[]).map(l=>({name:l.name||"",qty:Number(l.qty)||1,photo:l.photo}))})):(r||[]).map(n=>({name:n.system||"",components:(n.components||[]).map(l=>({name:l.name||"",qty:Number(l.qty)||1}))}));r&&!Array.isArray(r)?m({product:t.product||"",version:t.version||"",type:t.type||"Manufacture",photo:r.photo,systems:o}):m({product:t.product||"",version:t.version||"",type:t.type||"Manufacture",systems:o})},onDelete:()=>{if(window.confirm("Are you sure you want to delete this product?")){const o=p.filter(n=>n.id!==t.id);v(o)}}})})]}),a.length>0&&e.jsx("div",{className:"w-8 h-px bg-gray-200 flex-shrink-0"}),a.length>0&&e.jsx("div",{className:"flex flex-col justify-center",children:a.map((o,n)=>e.jsxs("div",{className:"mm-branch flex items-center py-2",children:[e.jsxs("div",{className:"flex-shrink-0 z-10 border border-gray-200 bg-white rounded-lg p-2 shadow-sm flex items-center gap-3 min-w-[180px] hover:shadow-md transition-shadow relative pr-8",children:[o.photo?e.jsx("img",{src:o.photo,className:"w-8 h-8 object-cover rounded-md border border-gray-100 cursor-zoom-in",onClick:l=>{l.stopPropagation(),D(o.photo)}}):e.jsx("div",{className:"w-8 h-8 bg-gray-50 rounded-md border border-gray-100 flex items-center justify-center text-[8px] text-gray-400",children:"No Photo"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold text-[#3D56A6] uppercase tracking-wider",children:"System"}),e.jsx("div",{className:"font-medium text-xs text-gray-800",children:o.name||"Untitled"})]}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(q,{onEdit:()=>{y(t.id);const l=r&&!Array.isArray(r)?(r.systems||[]).map(d=>({name:d.name||"",photo:d.photo,components:(d.components||[]).map(i=>({name:i.name||"",qty:Number(i.qty)||1,photo:i.photo}))})):(r||[]).map(d=>({name:d.system||"",components:(d.components||[]).map(i=>({name:i.name||"",qty:Number(i.qty)||1}))}));r&&!Array.isArray(r)?m({product:t.product||"",version:t.version||"",type:t.type||"Manufacture",photo:r.photo,systems:l}):m({product:t.product||"",version:t.version||"",type:t.type||"Manufacture",systems:l})},onDelete:()=>Q(t.id,n)})})]}),(o.components||[]).length>0&&e.jsx("div",{className:"w-8 h-px bg-gray-200 flex-shrink-0"}),(o.components||[]).length>0&&e.jsx("div",{className:"flex flex-col justify-center",children:(o.components||[]).map((l,d)=>e.jsx("div",{className:"mm-branch flex items-center py-1",children:e.jsxs("div",{className:"flex-shrink-0 z-10 border border-gray-100 bg-gray-50/50 rounded-lg p-1.5 shadow-sm flex items-center gap-2 min-w-[150px] hover:bg-white hover:shadow transition-all relative pr-8",children:[l.photo?e.jsx("img",{src:l.photo,className:"w-6 h-6 object-cover rounded border border-gray-200 cursor-zoom-in",onClick:i=>{i.stopPropagation(),D(l.photo)}}):e.jsx("div",{className:"w-6 h-6 bg-white rounded border border-gray-200 flex items-center justify-center text-[6px] text-gray-400",children:"No Photo"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-xs text-gray-700",children:l.name||"Untitled"}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Qty: ",Number(l.qty)||0]})]}),e.jsx("div",{className:"absolute top-0.5 right-0.5",children:e.jsx(q,{onEdit:()=>{y(t.id);const i=r&&!Array.isArray(r)?(r.systems||[]).map(c=>({name:c.name||"",photo:c.photo,components:(c.components||[]).map(h=>({name:h.name||"",qty:Number(h.qty)||1,photo:h.photo}))})):(r||[]).map(c=>({name:c.system||"",components:(c.components||[]).map(h=>({name:h.name||"",qty:Number(h.qty)||1}))}));r&&!Array.isArray(r)?m({product:t.product||"",version:t.version||"",type:t.type||"Manufacture",photo:r.photo,systems:i}):m({product:t.product||"",version:t.version||"",type:t.type||"Manufacture",systems:i})},onDelete:()=>J(t.id,n,d)})})]})},`c${n}-${d}`))})]},`s${n}`))}),a.length===0&&!(r!=null&&r.photo)&&e.jsx("div",{className:"text-gray-500 italic ml-4 text-xs",children:"No details available."})]})]})})()})})]},t.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:P.length+1,className:"p-8 text-center text-gray-400",children:"No bills of materials."})})]})]})})]})}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-30",onClick:()=>M(!1),children:e.jsx("div",{className:"absolute left-1/2 top-20 -translate-x-1/2 w-[720px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"New BOM"})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>M(!1),children:"✕"})]}),e.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-5 border border-gray-200 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Product Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Product Name"}),e.jsx("input",{value:g.product,onChange:t=>f({...g,product:t.target.value}),placeholder:"e.g. Laser Welding Machine",className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2 border"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Version"}),e.jsx("input",{value:g.version,onChange:t=>f({...g,version:t.target.value}),placeholder:"e.g. v1.0",className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2 border"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Type"}),e.jsxs("select",{value:g.type,onChange:t=>f({...g,type:t.target.value}),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2 border bg-white",children:[e.jsx("option",{value:"Manufacture",children:"Manufacture"}),e.jsx("option",{value:"Purchase Order",children:"Purchase Order"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Cover Photo"}),e.jsx(C,{photo:g.photo,onUpload:t=>A(t,s=>f({...g,photo:s}))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#3D56A6]"}),"Systems Configuration"]}),e.jsxs("button",{className:"text-xs flex items-center gap-1.5 bg-[#3D56A6]/10 text-[#3D56A6] px-4 py-2 rounded-full font-medium hover:bg-[#3D56A6]/20 transition-colors border border-[#3D56A6]/20",onClick:()=>f(t=>({...t,systems:[...t.systems||[],{name:"",components:[]}]})),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add System"]})]}),e.jsxs("div",{className:"space-y-6",children:[(g.systems||[]).map((t,s)=>e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm bg-white hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"bg-gray-50/50 px-5 py-3 border-b border-gray-100 flex items-center gap-4 group",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg border border-gray-200 shadow-sm",children:e.jsx("svg",{className:"w-4 h-4 text-[#3D56A6]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{value:t.name,onChange:r=>{const a=r.target.value;f(o=>({...o,systems:(o.systems||[]).map((n,l)=>l===s?{...n,name:a}:n)}))},className:"bg-transparent border-none p-0 text-sm font-semibold text-gray-900 focus:ring-0 placeholder-gray-400 w-full",placeholder:"System Name (e.g. Power Supply)"})}),e.jsx(C,{photo:t.photo,onUpload:r=>A(r,a=>f(o=>({...o,systems:o.systems.map((n,l)=>l===s?{...n,photo:a}:n)})))}),e.jsx("button",{className:"text-gray-300 hover:text-red-600 p-2 rounded-lg hover:bg-red-50 transition-all opacity-0 group-hover:opacity-100",onClick:()=>f(r=>({...r,systems:(r.systems||[]).filter((a,o)=>o!==s)})),title:"Remove system",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]}),e.jsxs("div",{className:"p-4 bg-white space-y-3",children:[(t.components||[]).map((r,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg group border border-transparent hover:border-gray-100 transition-all",children:[e.jsx("div",{className:"w-6 text-gray-300 flex justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 group-hover:bg-[#3D56A6]"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{value:r.name,onChange:o=>{const n=o.target.value;f(l=>({...l,systems:(l.systems||[]).map((d,i)=>i!==s?d:{...d,components:(d.components||[]).map((c,h)=>h===a?{...c,name:n}:c)})}))},className:"w-full text-sm border-gray-200 rounded-md focus:ring-[#3D56A6] focus:border-[#3D56A6] px-3 py-1.5 placeholder-gray-400 border",placeholder:"Component Name"})}),e.jsx("div",{className:"w-24",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"1",value:r.qty,onChange:o=>{const n=Math.max(0,Math.floor(Number(o.target.value||0)));f(l=>({...l,systems:(l.systems||[]).map((d,i)=>i!==s?d:{...d,components:(d.components||[]).map((c,h)=>h===a?{...c,qty:n}:c)})}))},className:"w-full text-sm border-gray-200 rounded-md focus:ring-[#3D56A6] focus:border-[#3D56A6] pl-3 pr-8 py-1.5 text-center border",placeholder:"Qty"}),e.jsx("span",{className:"absolute right-2 top-1.5 text-xs text-gray-400 pointer-events-none",children:"Qty"})]})}),e.jsx(C,{photo:r.photo,onUpload:o=>A(o,n=>f(l=>({...l,systems:(l.systems||[]).map((d,i)=>i!==s?d:{...d,components:(d.components||[]).map((c,h)=>h===a?{...c,photo:n}:c)})})))}),e.jsx("button",{className:"text-gray-300 hover:text-red-500 p-1.5 rounded-md hover:bg-red-50 opacity-0 group-hover:opacity-100 transition-all",onClick:()=>f(o=>({...o,systems:(o.systems||[]).map((n,l)=>l!==s?n:{...n,components:(n.components||[]).filter((d,i)=>i!==a)})})),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},a)),e.jsxs("button",{className:"w-full py-2.5 border-2 border-dashed border-gray-100 rounded-lg text-xs font-medium text-gray-400 hover:border-[#3D56A6]/30 hover:text-[#3D56A6] hover:bg-[#3D56A6]/10 transition-all flex items-center justify-center gap-2 mt-2",onClick:()=>f(r=>({...r,systems:(r.systems||[]).map((a,o)=>o===s?{...a,components:[...a.components||[],{name:"",qty:1}]}:a)})),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Component"]})]})]},s)),(g.systems||[]).length===0&&e.jsxs("div",{className:"text-center py-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 text-gray-400",children:[e.jsx("p",{children:"No systems added yet."}),e.jsx("button",{className:"text-[#3D56A6] font-medium hover:underline mt-1",onClick:()=>f(t=>({...t,systems:[...t.systems||[],{name:"",components:[]}]})),children:"Add your first system"})]})]})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>M(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:()=>{const t={id:Date.now(),product:g.product||"Untitled",version:g.version||"",type:g.type||"Manufacture",productTree:{product:g.product||"Untitled",photo:g.photo,systems:(g.systems||[]).map(a=>({name:a.name||"",photo:a.photo,components:(a.components||[]).map(o=>({name:o.name||"",qty:Number(o.qty)||0,photo:o.photo}))}))}},s=[...p,t];v(s);const r={product:t.productTree.product||"Untitled",version:t.version||"",type:t.type||"",systems:(Array.isArray(t.productTree.systems)?t.productTree.systems:[]).map(a=>({name:a.name||"",components:(Array.isArray(a.components)?a.components:[]).map(o=>({name:o.name||"",qty:Number(o.qty)||0}))}))};fetch(`${O}/api/bom/import/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(async a=>{if(!a||!a.ok){const o=a?await a.text().catch(()=>""):"";alert(`Failed to save BOM: ${a?a.status:"network"} ${o}`)}else await j()}).catch(()=>{alert("Failed to reach backend while saving BOM")}),M(!1),f({product:"",version:"",type:"Manufacture",systems:[]})},children:"Add"})]})]})})}),$&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30",onClick:()=>S(!1),children:e.jsx("div",{className:"absolute left-1/2 top-1/3 -translate-x-1/2 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete BOMs"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>S(!1),children:"✕"})]}),e.jsx("div",{className:"px-5 py-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:b.length})," selected BOMs?"]})}),e.jsxs("div",{className:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>S(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700",onClick:H,children:"Delete"})]})]})})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-30",onClick:()=>y(null),children:e.jsx("div",{className:"absolute left-1/2 top-20 -translate-x-1/2 w-[720px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Edit Product Tree"})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>y(null),children:"✕"})]}),e.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-5 border border-gray-200 space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Product Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Product Name"}),e.jsx("input",{value:u.product,onChange:t=>m(s=>({...s,product:t.target.value})),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2 border",placeholder:"Product Name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Cover Photo"}),e.jsx(C,{photo:u.photo,onUpload:t=>A(t,s=>m({...u,photo:s}))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Version"}),e.jsx("input",{value:u.version||"",onChange:t=>m(s=>({...s,version:t.target.value})),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2 border",placeholder:"e.g. v1.0"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Type"}),e.jsxs("select",{value:u.type||"Manufacture",onChange:t=>m(s=>({...s,type:t.target.value})),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2 border bg-white",children:[e.jsx("option",{value:"Manufacture",children:"Manufacture"}),e.jsx("option",{value:"Purchase Order",children:"Purchase Order"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#3D56A6]"}),"Systems Configuration"]}),e.jsxs("button",{className:"text-xs flex items-center gap-1.5 bg-[#3D56A6]/10 text-[#3D56A6] px-4 py-2 rounded-full font-medium hover:bg-[#3D56A6]/20 transition-colors border border-[#3D56A6]/20",onClick:()=>{m(t=>({...t,systems:[...t.systems||[],{name:"",components:[]}]}))},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add System"]})]}),e.jsxs("div",{className:"space-y-6",children:[(u.systems||[]).map((t,s)=>e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm bg-white hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"bg-gray-50/50 px-5 py-3 border-b border-gray-100 flex items-center gap-4 group",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg border border-gray-200 shadow-sm",children:e.jsx("svg",{className:"w-4 h-4 text-[#3D56A6]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{value:t.name,onChange:r=>{const a=r.target.value;m(o=>({...o,systems:(o.systems||[]).map((n,l)=>l===s?{...n,name:a}:n)}))},className:"bg-transparent border-none p-0 text-sm font-semibold text-gray-900 focus:ring-0 placeholder-gray-400 w-full",placeholder:"System Name (e.g. Power Supply)"})}),e.jsx(C,{photo:t.photo,onUpload:r=>A(r,a=>m(o=>({...o,systems:o.systems.map((n,l)=>l===s?{...n,photo:a}:n)})))}),e.jsx("button",{className:"text-gray-300 hover:text-red-600 p-2 rounded-lg hover:bg-red-50 transition-all opacity-0 group-hover:opacity-100",onClick:()=>m(r=>({...r,systems:(r.systems||[]).filter((a,o)=>o!==s)})),title:"Remove system",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]}),e.jsxs("div",{className:"p-4 bg-white space-y-3",children:[(t.components||[]).map((r,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg group border border-transparent hover:border-gray-100 transition-all",children:[e.jsx("div",{className:"w-6 text-gray-300 flex justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 group-hover:bg-[#3D56A6]"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{value:r.name,onChange:o=>{const n=o.target.value;m(l=>({...l,systems:(l.systems||[]).map((d,i)=>i!==s?d:{...d,components:(d.components||[]).map((c,h)=>h===a?{...c,name:n}:c)})}))},className:"w-full text-sm border-gray-200 rounded-md focus:ring-[#3D56A6] focus:border-[#3D56A6] px-3 py-1.5 placeholder-gray-400 border",placeholder:"Component Name"})}),e.jsx("div",{className:"w-24",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"1",value:r.qty,onChange:o=>{const n=Math.max(0,Math.floor(Number(o.target.value||0)));m(l=>({...l,systems:(l.systems||[]).map((d,i)=>i!==s?d:{...d,components:(d.components||[]).map((c,h)=>h===a?{...c,qty:n}:c)})}))},className:"w-full text-sm border-gray-200 rounded-md focus:ring-[#3D56A6] focus:border-[#3D56A6] pl-3 pr-8 py-1.5 text-center border",placeholder:"Qty"}),e.jsx("span",{className:"absolute right-2 top-1.5 text-xs text-gray-400 pointer-events-none",children:"Qty"})]})}),e.jsx(C,{photo:r.photo,onUpload:o=>A(o,n=>m(l=>({...l,systems:(l.systems||[]).map((d,i)=>i!==s?d:{...d,components:(d.components||[]).map((c,h)=>h===a?{...c,photo:n}:c)})})))}),e.jsx("button",{className:"text-gray-300 hover:text-red-500 p-1.5 rounded-md hover:bg-red-50 opacity-0 group-hover:opacity-100 transition-all",onClick:()=>m(o=>({...o,systems:(o.systems||[]).map((n,l)=>l!==s?n:{...n,components:(n.components||[]).filter((d,i)=>i!==a)})})),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},a)),e.jsxs("button",{className:"w-full py-2.5 border-2 border-dashed border-gray-100 rounded-lg text-xs font-medium text-gray-400 hover:border-[#3D56A6]/30 hover:text-[#3D56A6] hover:bg-[#3D56A6]/10 transition-all flex items-center justify-center gap-2 mt-2",onClick:()=>m(r=>({...r,systems:(r.systems||[]).map((a,o)=>o===s?{...a,components:[...a.components||[],{name:"",qty:1}]}:a)})),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Component"]})]})]},s)),(u.systems||[]).length===0&&e.jsxs("div",{className:"text-center py-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 text-gray-400",children:[e.jsx("p",{children:"No systems added yet."}),e.jsx("button",{className:"text-[#3D56A6] font-medium hover:underline mt-1",onClick:()=>{m(t=>({...t,systems:[...t.systems||[],{name:"",components:[]}]}))},children:"Add your first system"})]})]})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>y(null),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:async()=>{const t=p.map(s=>s.id===N?{...s,productTree:u,product:u.product||"Untitled",version:u.version||s.version||"",type:u.type||s.type||""}:s);v(t);try{const s=t.find(n=>n.id===N)||{},r={product:u.product||"Untitled",version:u.version||"",type:u.type||"",systems:(Array.isArray(u.systems)?u.systems:[]).map(n=>({name:n.name||"",components:(Array.isArray(n.components)?n.components:[]).map(l=>({name:l.name||"",qty:Number(l.qty)||0}))}))},a={"Content-Type":"application/json"},o=await fetch(`${O}/api/bom/import/`,{method:"POST",headers:a,body:JSON.stringify(r)}).catch(()=>null);if(!o||!o.ok){const n=o?await o.text().catch(()=>""):"";alert(`Failed to save BOM: ${o?o.status:"network"} ${n}`)}else await j()}catch{}y(null)},children:"Save"})]})]})})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>D(null),children:e.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh]",children:[e.jsx("img",{src:E,className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:t=>t.stopPropagation()}),e.jsx("button",{className:"absolute -top-4 -right-4 bg-white text-black rounded-full p-1 shadow-lg hover:bg-gray-100",onClick:()=>D(null),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})})]})}X.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(Z,{})}));
