import{R as F,j as e,a as l}from"./index-BHXMZ0-J.js";import{A as N,N as P}from"./navigation-B0IDt7ps.js";import{L as z}from"./language-context-DF7eV6qf.js";function I(){const[c,v]=l.useState([]),[p,C]=l.useState(""),[q,h]=l.useState(!1),[d,b]=l.useState({name:"",sku:"",qty:1}),[x,f]=l.useState([]),[A,g]=l.useState(!1),[i,m]=l.useState(null),[k,L]=l.useState([]),[_,j]=l.useState(!1),[$,w]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const t=await fetch(`${N}/api/component_entries/`);if(!t.ok)throw new Error("Failed to load components");const s=await t.json(),r=(Array.isArray(s)?s:[]).map(a=>({id:a.id,name:a.component_name||"",sku:"",category:"",qty:Number(a.quantity)||0,state:"",favorite:!1}));v(r)}catch(t){console.error("Failed to load component entries",t)}})()},[]),l.useEffect(()=>{try{const t=localStorage.getItem("componentHints")||"[]",s=JSON.parse(t);Array.isArray(s)&&L(s)}catch{}},[]);const y=t=>{v(t)},S=t=>{const s=/CN(?:\/|-)?(\d+)/.exec(String(t||""));return s?parseInt(s[1],10):null},E=()=>{let t=0;for(const s of c){const r=S(s.sku);Number.isFinite(r)&&r>t&&(t=r)}return`CN-${String(t+1).padStart(5,"0")}`};l.useEffect(()=>{if(c.length){const t=n=>/^CN-\d{5}$/.test(String(n||""));let s=0;for(const n of c){const o=S(n.sku);Number.isFinite(o)&&o>s&&(s=o)}let r=!1;const a=c.map(n=>{if(!t(n.sku)){const o=String(++s).padStart(5,"0");return r=!0,{...n,sku:`CN-${o}`}}return n});r&&y(a)}},[]);const u=c.filter(t=>{const s=p.toLowerCase();return(t.name||"").toLowerCase().includes(s)}),D=u.length>0&&u.every(t=>x.includes(t.id)),R=()=>{f(D?[]:u.map(t=>t.id))},B=t=>{f(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},M=async()=>{try{const t=x.slice();for(const s of t)try{await fetch(`${N}/api/component_entries/${s}/`,{method:"DELETE"})}catch{}}finally{const t=c.filter(s=>!x.includes(s.id));y(t),f([]),g(!1)}};return e.jsxs("main",{className:"min-h-screen bg-white",children:[e.jsx(P,{}),e.jsx("section",{className:"w-full bg-gray-50",children:e.jsxs("div",{className:"w-full mx-auto p-6 min-h-full",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Component"}),e.jsx("button",{className:"inline-flex items-center justify-center px-6 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",title:"New component",onClick:()=>h(!0),children:"New component"}),e.jsx("button",{className:"px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Manufacturing Orders",onClick:()=>window.location.href="/manufacturing.html",children:"Manufacturing Orders"}),e.jsx("button",{className:"px-2 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",title:"Bill of Materials",onClick:()=>window.location.href="/bom.html",children:"Bill of Materials"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[x.length>0&&e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",title:"Delete selected components",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("span",{className:"font-medium",children:["Delete (",x.length,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by Component",className:"pl-10 pr-10 py-2 border border-slate-300 rounded-lg text-sm w-80 focus:outline-none focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] transition-all",value:p,onChange:t=>C(t.target.value)}),e.jsx("svg",{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),p&&e.jsx("button",{onClick:()=>C(""),className:"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600 transition-colors",title:"Clear Search",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"text-slate-500 font-medium text-sm",children:p?e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"text-slate-900 font-bold",children:u.length})," of ",e.jsx("span",{className:"text-slate-900 font-bold",children:c.length})," components"]}):e.jsxs("span",{children:["Total: ",e.jsx("span",{className:"text-slate-900 font-bold",children:c.length})," components"]})})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden overflow-x-auto max-w-4xl mx-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 border-b w-10",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300",checked:D,onChange:R})}),e.jsx("th",{className:"p-4 border-b w-14",children:"Index"}),e.jsx("th",{className:"p-4 border-b w-[65%]",children:"Component"}),e.jsx("th",{className:"p-4 border-b w-[20%] text-right",children:"Quantity Available"})]})}),e.jsxs("tbody",{children:[u.map((t,s)=>{const r=x.includes(t.id);return e.jsxs("tr",{className:`transition-colors ${r?"bg-blue-200 hover:bg-blue-300":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"p-4 border-b",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300",checked:r,onChange:()=>B(t.id)})}),e.jsx("td",{className:"p-4 border-b w-14 text-gray-800 font-medium",children:s+1}),e.jsx("td",{className:"p-4 border-b w-[65%] text-gray-600",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"text-[#2D4485] font-semibold hover:underline truncate",title:t.name,onClick:()=>m(t),children:t.name})})}),e.jsx("td",{className:"p-4 border-b w-[20%] text-right text-gray-600",children:e.jsx("span",{className:"text-gray-800",children:Number(t.qty).toFixed(2)})})]},t.id)}),!u.length&&e.jsx("tr",{children:e.jsx("td",{className:"p-6 text-center text-gray-500",colSpan:4,children:"No components found"})})]})]})})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-30",onClick:()=>m(null),children:e.jsx("div",{className:"absolute left-1/2 top-20 -translate-x-1/2 w-[640px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Edit Component"})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>m(null),children:"✕"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-x-10 gap-y-3",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-1",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Component"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:i.name||"",onChange:t=>m({...i,name:t.target.value}),onFocus:()=>w(!0),onBlur:()=>setTimeout(()=>w(!1),120),placeholder:"Component name",className:"w-full rounded-lg border border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2"}),$&&(()=>{const t=String(i.name||"").toLowerCase(),r=Array.from(new Set(k)).filter(a=>{const n=String(a||"");return n?t?n.toLowerCase().includes(t):!0:!1}).slice(0,8);return r.length?e.jsx("div",{className:"absolute left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto",children:r.map((a,n)=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-gray-700",onMouseDown:o=>{o.preventDefault(),m({...i,name:a}),w(!1)},children:a},`${a}-${n}`))}):null})()]})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-1",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"0",step:"1",value:i.qty||0,onChange:t=>m({...i,qty:Number(t.target.value)}),className:"w-28 rounded-md border border-gray-300 px-2 py-1"})]})]})}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>m(null),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:async()=>{const t={component_name:i.name||"Untitled",quantity:Number(i.qty)||0};try{await fetch(`${N}/api/component_entries/${i.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch{}const s=c.map(r=>r.id===i.id?{...r,name:t.component_name,qty:t.quantity}:r);y(s),m(null)},children:"Save"})]})]})})}),A&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30",onClick:()=>g(!1),children:e.jsx("div",{className:"absolute left-1/2 top-1/3 -translate-x-1/2 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete components"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>g(!1),children:"✕"})]}),e.jsx("div",{className:"px-5 py-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:x.length})," selected components?"]})}),e.jsxs("div",{className:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700",onClick:M,children:"Delete"})]})]})})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/30 z-30",onClick:()=>h(!1),children:e.jsx("div",{className:"absolute left-1/2 top-20 -translate-x-1/2 w-[640px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"New Component"})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>h(!1),children:"✕"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-x-10 gap-y-3",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-1",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Component"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:d.name,onChange:t=>b({...d,name:t.target.value}),onFocus:()=>j(!0),onBlur:()=>setTimeout(()=>j(!1),120),placeholder:"Component name",className:"w-full rounded-lg border border-gray-300 shadow-sm focus:border-[#3D56A6] focus:ring-[#3D56A6] text-sm px-3 py-2"}),_&&(()=>{const t=String(d.name||"").toLowerCase(),r=Array.from(new Set(k)).filter(a=>{const n=String(a||"");return n?t?n.toLowerCase().includes(t):!0:!1}).slice(0,8);return r.length?e.jsx("div",{className:"absolute left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto",children:r.map((a,n)=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50 text-gray-700",onMouseDown:o=>{o.preventDefault(),b({...d,name:a}),j(!1)},children:a},`${a}-${n}`))}):null})()]})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] items-center gap-1",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"0",step:"1",value:d.qty,onChange:t=>b({...d,qty:Number(t.target.value)}),className:"w-28 rounded-md border border-gray-300 px-2 py-1"})]})]})}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:async()=>{const t={component_name:d.name||"Untitled",quantity:Number(d.qty)||0};let s=null;try{const o=await fetch(`${N}/api/component_entries/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});o.ok&&(s=await o.json())}catch{}const a={id:s&&s.id?s.id:Date.now(),name:t.component_name,sku:d.sku||E(),category:"",qty:t.quantity,state:"",favorite:!1},n=[...c,a];y(n),h(!1),b({name:"",sku:"",qty:1})},children:"Add"})]})]})})})]})}F.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(z,{children:e.jsx(I,{})})}));
