import{R as H,j as e,a as x}from"./index-BHXMZ0-J.js";import{N as J,A as _,f as Q}from"./navigation-B0IDt7ps.js";import{C as W}from"./customer-combobox-DFf8l8BL.js";import{A as V}from"./arrow-left-COoKEq45.js";import{C as G}from"./clipboard-list-BivIav4i.js";import{P as X}from"./plus-BuoTYnGG.js";import{T as Z}from"./trash-D7KEJc6k.js";import{p as ee,C as te}from"./parseISO-BxmDVPrG.js";import{g as se,D as re}from"./DayPicker-Cy1TBD3b.js";import"./check-CiAOFjR6.js";import"./addWeeks-yWatJi1q.js";function oe({value:t,onChange:N,placeholder:g="DD/MM/YYYY"}){const[w,s]=x.useState(!1),a=x.useRef(null),r=se(),i=(()=>{try{return t?ee(t):void 0}catch{return}})(),p=(()=>{try{return i?Q(i,"dd/MM/yyyy"):""}catch{return""}})();return x.useEffect(()=>{if(!w)return;const n=j=>{const y=a.current;y&&!y.contains(j.target)&&s(!1)},h=j=>{j.key==="Escape"&&s(!1)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n,{passive:!0}),document.addEventListener("keydown",h),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n),document.removeEventListener("keydown",h)}},[w]),e.jsxs("div",{ref:a,className:"relative inline-block w-full",children:[e.jsx("input",{type:"text",value:p,placeholder:g,onClick:()=>s(n=>!n),readOnly:!0,className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none"}),e.jsx("button",{type:"button",onClick:()=>s(n=>!n),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700","aria-label":"Open calendar",children:e.jsx(te,{className:"size-4","aria-hidden":"true"})}),w&&e.jsx("div",{onMouseDown:n=>n.stopPropagation(),className:"absolute left-1/2 -translate-x-1/2 top-[calc(100%+2px)] z-50 bg-white border border-slate-200 rounded-[22px] shadow-xl p-4 w-[340px]",children:e.jsx(re,{mode:"single",selected:i,onSelect:n=>{if(!n)return;const h=Q(n,"yyyy-MM-dd");N(h)},captionLayout:"buttons",classNames:{root:`w-fit ${r.root}`,months:`flex flex-col ${r.months}`,month:`rounded-2xl pt-8 ${r.month}`,caption:`relative h-8 ${r.caption}`,nav:`absolute left-3 right-3 top-0 flex items-center justify-between ${r.nav}`,nav_button:`p-2 rounded-full hover:bg-slate-100 ${r.nav_button}`,nav_button_previous:`${r.nav_button_previous}`,nav_button_next:`${r.nav_button_next}`,caption_label:`absolute left-1/2 -translate-x-1/2 top-0 h-8 leading-8 text-center font-semibold uppercase tracking-wide text-[#2D4485] ${r.caption_label}`,table:"w-full border-collapse",weekdays:`flex justify-between border-b border-slate-200 pb-2 ${r.weekdays}`,weekday:`text-slate-500 flex-1 text-sm text-center ${r.weekday}`,week:`grid grid-cols-7 mt-2 ${r.week}`,day:`mx-auto size-10 flex items-center justify-center rounded-full hover:bg-blue-50 ${r.day}`,today:`bg-[#D6E4FF] text-[#2D4485] font-semibold ${r.today}`,outside:`text-slate-400 ${r.outside}`,disabled:`${r.disabled}`},modifiersClassNames:{selected:"border-2 border-[#2D4485]/30 !bg-transparent text-[#2D4485] font-semibold"}})})]})}const C=t=>typeof t=="number"?t:t?parseFloat(String(t).replace(/,/g,"")):0;function ae(){const[t,N]=x.useState({company:"",taxId:"",address:"",telephone:"",fax:"",attn:"",div:"",mobile:"",email:""}),g=()=>{const l=[];try{for(let c=0;c<localStorage.length;c++){const b=localStorage.key(c);if(b&&b.startsWith("history:"))try{const D=JSON.parse(localStorage.getItem(b));D&&Array.isArray(D.quotations)&&l.push(...D.quotations)}catch{}}}catch(c){console.error("Error reading localStorage",c)}const m=new Date().getFullYear(),u=l.map(c=>String(c.number||"")).map(c=>{const b=c.match(new RegExp(`^QUO ${m}-(\\d{4})$`));return b?parseInt(b[1],10):null}).filter(c=>Number.isFinite(c)),o=u.length?Math.max(...u)+1:1;return`QUO ${m}-${String(o).padStart(4,"0")}`},[w,s]=x.useState({number:g(),date:new Date().toISOString().slice(0,10),validUntil:"",currency:"THB",deliveryTerms:"Ex-Works",eit:null,salesPerson:"",eitMobile:" 000-000-0000",eitTelephone:" 02-052-9544",eitFax:" 02-052 9544",eitAddress:"1/120 ซอยรามคําแหง 184 แขวงมีนบุรี เขตมีนบุรี กรุงเทพมหานคร 10510",tradeTerms:"",validity:"",delivery:"",shipmentLocation:"",invoiceDate:"SAME AS DELIVERY DATE",remark:`IN CASE OF PURCHASING THERE IS NO EXCHANGE GOODS AFTER PURCHASED PLEASE SEE WARRANTY CONDITION
THE INFORMATION ARE SUBJECT TO CHANGE WITH OUT NOTICE`,paymentTerms:""}),[a,r]=x.useState([{item:"",model:"",description:"",qty:1,price:0}]),[i,p]=x.useState(null),[n,h]=x.useState(null),[j,y]=x.useState([]),[S,d]=x.useState([]);x.useEffect(()=>{fetch(`${_}/api/deals/`).then(l=>l.json()).then(l=>{if(Array.isArray(l)){const m={};l.forEach(u=>{u.customer_name&&!m[u.customer_name]&&(m[u.customer_name]=u)}),d(Object.values(m))}}).catch(l=>console.error("Error loading deals for customers",l))},[]),x.useEffect(()=>{fetch(`${_}/api/eits/`).then(l=>l.json()).then(l=>{Array.isArray(l)?y(l):(console.error("EIT data is not an array:",l),y([]))}).catch(l=>{console.error("Error loading EITs",l),y([])})},[]);const v=a.reduce((l,m)=>l+(C(m.qty)||0)*(C(m.price)||0),0),K=()=>r(l=>[...l,{item:"",model:"",description:"",qty:1,price:0}]),Y=l=>r(m=>m.filter((u,o)=>o!==l)),z=(l,m,u)=>r(o=>o.map((c,b)=>b===l?{...c,[m]:u}:c));return x.useEffect(()=>{const l=new URLSearchParams(window.location.search),m=l.get("key"),u=l.get("index");if(m&&u!==null)if(p(m),h(parseInt(u,10)),m==="api")fetch(`${_}/api/quotations/${u}/`).then(o=>{if(!o.ok)throw new Error("Failed to fetch");return o.json()}).then(o=>{var b,D,I,E,T,A,O,q,F,L,$,P,R,M,U;N({company:((b=o.customer_details)==null?void 0:b.company_name)||"",taxId:((D=o.customer_details)==null?void 0:D.tax_id)||"",address:((I=o.customer_details)==null?void 0:I.address)||"",telephone:((E=o.customer_details)==null?void 0:E.phone)||"",fax:((T=o.customer_details)==null?void 0:T.cus_fax)||"",attn:((A=o.customer_details)==null?void 0:A.attn)||"",div:((O=o.customer_details)==null?void 0:O.division)||"",mobile:((q=o.customer_details)==null?void 0:q.mobile)||"",email:((F=o.customer_details)==null?void 0:F.email)||""}),s({number:o.qo_code,date:o.created_date,validUntil:"",currency:"THB",deliveryTerms:"Ex-Works",salesPerson:((L=o.eit_details)==null?void 0:L.organization_name)||"",eit:(($=o.eit_details)==null?void 0:$.id)||null,eitMobile:((P=o.eit_details)==null?void 0:P.eit_mobile)||"",eitTelephone:((R=o.eit_details)==null?void 0:R.eit_telephone)||"",eitFax:((M=o.eit_details)==null?void 0:M.eit_fax)||"",eitAddress:((U=o.eit_details)==null?void 0:U.address)||"",tradeTerms:o.trade_terms||"",validity:o.validity||"",delivery:o.delivery||"",shipmentLocation:o.shipment_location||"",invoiceDate:o.invoice_date||"SAME AS DELIVERY DATE",remark:o.remark||"",paymentTerms:o.payment_terms||""});const c=o.quotation_items||o.items||o.products||[];c.length>0&&r(c.map(f=>{const k=f.quantity||f.qty||1,B=parseFloat(f.quo_total||f.total||0);return{item:f.quo_item||f.item||"",model:f.quo_model||f.model||"",description:f.quo_description||f.description||"",qty:k,price:k>0?B/k:0}}))}).catch(o=>console.error("Error loading from API",o));else try{const o=JSON.parse(localStorage.getItem(m));if(o&&o.quotations&&o.quotations[u]){const c=o.quotations[u];s(b=>({...b,...c.details})),r(c.items||[]),o.customer&&N(o.customer)}}catch(o){console.error("Error loading quotation",o)}},[]),{customer:t,setCustomer:N,details:w,setDetails:s,items:a,addItem:K,removeItem:Y,updateItem:z,total:v,sourceKey:i,sourceIndex:n,eitOptions:j,customerOptions:S}}function le(){const t=ae(),[N,g]=x.useState(!1),w=async()=>{try{const s={details:t.details,customer:t.customer,items:t.items.map(n=>({...n,qty:C(n.qty),price:C(n.price)})),totals:{total:t.total}},a=await fetch(`${_}/api/generate-quotation-pdf/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to generate PDF");const r=await a.blob(),i=window.URL.createObjectURL(r),p=document.createElement("iframe");p.style.display="none",p.src=i,document.body.appendChild(p),setTimeout(()=>{p.contentWindow.focus(),p.contentWindow.print()},500),setTimeout(()=>{document.body.removeChild(p),window.URL.revokeObjectURL(i)},6e4)}catch(s){console.error("Error generating PDF:",s),alert("Failed to generate PDF")}};return e.jsxs("main",{className:"min-h-screen bg-gray-50",children:[e.jsx(J,{}),e.jsxs("div",{className:"max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>window.location.href="/admin.html",className:"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors",title:"Back to List",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(G,{className:"w-8 h-8"}),"New Quotation"]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Codes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quotation Number"}),e.jsx("input",{value:t.details.number,onChange:s=>t.setDetails({...t.details,number:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Quotation number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx(oe,{value:t.details.date,onChange:s=>t.setDetails({...t.details,date:s})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"EIT/Einstein organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From"}),e.jsxs("select",{value:t.details.eit||"",onChange:s=>{const a=s.target.value;if(!a){t.setDetails({...t.details,eit:null,salesPerson:"",eitMobile:"",eitTelephone:"",eitFax:"",eitAddress:""});return}const r=t.eitOptions.find(i=>String(i.id)===a);r&&t.setDetails({...t.details,eit:r.id,salesPerson:r.organization_name,eitMobile:r.eit_mobile||"",eitTelephone:r.eit_telephone||"",eitFax:r.eit_fax||"",eitAddress:r.address||""})},className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",children:[e.jsx("option",{value:"",children:"Select Organization"}),t.eitOptions.map(s=>e.jsx("option",{value:s.id,children:s.organization_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mobile"}),e.jsx("input",{value:t.details.eitMobile,onChange:s=>t.setDetails({...t.details,eitMobile:s.target.value}),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Mobile"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telephone"}),e.jsx("input",{value:t.details.eitTelephone,onChange:s=>t.setDetails({...t.details,eitTelephone:s.target.value}),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Telephone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fax"}),e.jsx("input",{value:t.details.eitFax,onChange:s=>t.setDetails({...t.details,eitFax:s.target.value}),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Fax"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 space-y-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Customer Information"}),e.jsx("h3",{className:"text-base font-bold text-gray-900 pt-2",children:"Customer Company"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx(W,{value:t.customer.company,options:t.customerOptions,onChange:s=>{const a=t.customerOptions.find(r=>r.customer_name===s);a?t.setCustomer({...t.customer,company:s,taxId:a.tax_id||t.customer.taxId,address:a.address||t.customer.address,telephone:a.phone||t.customer.telephone,attn:a.contact||t.customer.attn,email:a.email||t.customer.email}):t.setCustomer({...t.customer,company:s})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax ID"}),e.jsx("input",{value:t.customer.taxId,onChange:s=>t.setCustomer({...t.customer,taxId:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Tax ID"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telephone"}),e.jsx("input",{value:t.customer.telephone,onChange:s=>t.setCustomer({...t.customer,telephone:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Telephone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fax"}),e.jsx("input",{value:t.customer.fax,onChange:s=>t.setCustomer({...t.customer,fax:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Fax"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:t.customer.address,onChange:s=>t.setCustomer({...t.customer,address:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",rows:"2",placeholder:"Address"})]})]}),e.jsx("h3",{className:"text-base font-bold text-gray-900 pt-2",children:"Customer Responsible"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Attention(Attn.)"}),e.jsx("input",{value:t.customer.attn,onChange:s=>t.setCustomer({...t.customer,attn:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Attention"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Division(Div.)"}),e.jsx("input",{value:t.customer.div,onChange:s=>t.setCustomer({...t.customer,div:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Division"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mobile"}),e.jsx("input",{value:t.customer.mobile,onChange:s=>t.setCustomer({...t.customer,mobile:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Mobile"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485]",children:"Quotation Description"}),e.jsxs("button",{onClick:t.addItem,className:"inline-flex items-center gap-2 rounded-full px-4 py-2 bg-[#2D4485]/10 text-[#2D4485] hover:bg-[#2D4485]/15",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Add Item"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b w-16",children:"Item"}),e.jsx("th",{className:"p-3 border-b",children:"Model"}),e.jsx("th",{className:"p-3 border-b",children:"Description"}),e.jsx("th",{className:"p-3 border-b w-32",children:"Price"}),e.jsx("th",{className:"p-3 border-b w-20",children:"Quantity"}),e.jsx("th",{className:"p-3 border-b w-32",children:"Total (Baht)"}),e.jsx("th",{className:"p-3 border-b w-12"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:t.items.map((s,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition border-b border-gray-100",children:[e.jsx("td",{className:"p-3 text-center text-sm text-gray-700",children:a+1}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:s.model,onChange:r=>t.updateItem(a,"model",r.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none",placeholder:"Model"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{value:s.description,onChange:r=>t.updateItem(a,"description",r.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none",placeholder:"Description"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"text",value:s.price,onChange:r=>t.updateItem(a,"price",r.target.value),onBlur:r=>{const i=C(r.target.value);isNaN(i)||t.updateItem(a,"price",i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))},className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:s.qty,onChange:r=>t.updateItem(a,"qty",r.target.value),className:"w-full bg-transparent border-b border-gray-300 px-2 py-1 text-sm focus:border-[#2D4485] outline-none"})}),e.jsx("td",{className:"p-3 text-right text-sm text-gray-700",children:(C(s.qty||0)*C(s.price||0)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>t.removeItem(a),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(Z,{className:"w-4 h-4"})})})]},a))})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("div",{className:"w-64 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-base font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"})," ",e.jsx("span",{children:t.total.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between text-base font-bold text-gray-900",children:[e.jsx("span",{children:"VAT 7%:"})," ",e.jsx("span",{children:(t.total*.07).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"flex justify-between text-base font-bold text-[#2D4485] pt-2 border-t",children:[e.jsx("span",{children:"Grand Total:"})," ",e.jsx("span",{children:(t.total*1.07).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-400 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-[#2D4485] mb-4",children:"Terms & Conditions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trade Terms"}),e.jsx("input",{value:t.details.tradeTerms,onChange:s=>t.setDetails({...t.details,tradeTerms:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Trade Terms"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Validity"}),e.jsx("input",{value:t.details.validity,onChange:s=>t.setDetails({...t.details,validity:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Validity"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery"}),e.jsx("input",{value:t.details.delivery,onChange:s=>t.setDetails({...t.details,delivery:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Delivery"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsx("textarea",{name:"paymentTerms",value:t.details.paymentTerms,onChange:s=>t.setDetails({...t.details,paymentTerms:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",rows:"4",placeholder:"Payment terms"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shipment Location"}),e.jsx("input",{value:t.details.shipmentLocation,onChange:s=>t.setDetails({...t.details,shipmentLocation:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Shipment Location"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Date"}),e.jsx("input",{value:t.details.invoiceDate,onChange:s=>t.setDetails({...t.details,invoiceDate:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",placeholder:"Invoice Date"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remark"}),e.jsx("textarea",{value:t.details.remark,onChange:s=>t.setDetails({...t.details,remark:s.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm focus:ring-2 focus:ring-[#2D4485]/20 focus:border-[#2D4485] outline-none",rows:"4",placeholder:"Remark"})]})]})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10",onClick:()=>window.location.href="/admin.html",children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6]",onClick:()=>g(!0),children:"Create QO Form"})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:()=>g(!1),children:e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[560px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Create QO Form"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Choose how you want to proceed"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-900",onClick:()=>g(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 grid grid-cols-3 gap-4",children:[e.jsx("button",{className:"w-full px-4 py-2 rounded-md border border-[#2D4485] text-[#2D4485] hover:bg-[#2D4485]/10 min-w-[140px]",onClick:()=>{g(!1),window.location.href="/admin.html"},children:"Discard"}),e.jsx("button",{className:"w-full px-4 py-2 rounded-md bg-[#2D4485] text-white hover:bg-[#3D56A6] min-w-[140px]",onClick:()=>{(async()=>{try{const a=t.customer.company||"Unknown",r=`history:${a}`;if(t.sourceKey&&t.sourceKey!==r&&t.sourceIndex!==null)try{const d=localStorage.getItem(t.sourceKey);if(d){const v=JSON.parse(d);v&&Array.isArray(v.quotations)&&(v.quotations.splice(t.sourceIndex,1),localStorage.setItem(t.sourceKey,JSON.stringify(v)))}}catch(d){console.error("Error removing old record",d)}let i={customer:t.customer,quotations:[],invoices:[],billingNotes:[]};try{const d=localStorage.getItem(r);if(d){const v=JSON.parse(d);v&&(i={...i,...v})}}catch(d){console.error("Error parsing localStorage",d)}Array.isArray(i.quotations)||(i.quotations=[]),(!i.customer||!i.customer.company)&&(i.customer=t.customer);const p={id:Date.now(),savedAt:new Date().toISOString(),number:t.details.number,details:t.details,items:t.items,total:t.total,totals:{total:t.total},customerName:a};let n=-1;t.sourceKey===r&&t.sourceIndex!==null?n=t.sourceIndex:n=i.quotations.findIndex(d=>d.number===t.details.number),n>=0&&n<i.quotations.length?i.quotations[n]=p:i.quotations.push(p),localStorage.setItem(r,JSON.stringify(i));const h={qo_code:t.details.number,created_date:t.details.date,customer_name:t.customer.company||"Unknown",customer_tax_id:t.customer.taxId||"",customer_address:t.customer.address||"",customer_email:t.customer.email||"",customer_phone:t.customer.telephone||"",customer_fax:t.customer.fax||"",cus_respon_attn:t.customer.attn||"",cus_respon_div:t.customer.div||"",cus_respon_mobile:t.customer.mobile||"",eit:t.details.eit,eit_name:t.details.salesPerson||"",eit_address:t.details.eitAddress||"",eit_mobile:t.details.eitMobile||"",eit_phone:t.details.eitTelephone||"",eit_fax:t.details.eitFax||"",trade_terms:t.details.tradeTerms||"",validity:t.details.validity||"",delivery:t.details.delivery||"",payment_terms:t.details.paymentTerms||"",shipment_location:t.details.shipmentLocation||"",invoice_date:t.details.invoiceDate&&t.details.invoiceDate!=="SAME AS DELIVERY DATE"?t.details.invoiceDate:null,remark:t.details.remark||"",items:t.items.map(d=>({item:d.item||"",model:d.model||"",description:d.description||"",qty:d.qty||1,price:d.price||0}))};h.invoice_date&&!/^\d{4}-\d{2}-\d{2}$/.test(h.invoice_date)&&(h.invoice_date=null),console.log("Saving to backend...",h);let j=`${_}/api/quotations/`,y="POST";t.sourceKey==="api"&&t.sourceIndex&&(j=`${_}/api/quotations/${t.sourceIndex}/`,y="PUT");const S=await fetch(j,{method:y,headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!S.ok){const d=await S.text();throw console.error("Backend save error:",d),new Error("Failed to save to database: "+d)}alert("Quotation saved successfully!"),g(!1),window.location.href="/admin.html"}catch(a){console.error(a),alert("Error saving quotation: "+a.message)}})()},children:"Save Changes"}),e.jsx("button",{className:"w-full px-4 py-2 rounded-md text-[#2D4485] underline underline-offset-2 hover:text-[#3D56A6] min-w-[140px] whitespace-nowrap text-center",onClick:()=>{g(!1),w()},children:"Download Form"})]})]})})})]})]})}H.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(le,{})}));
